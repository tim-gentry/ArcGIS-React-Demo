import{eB as w,hf as j,aT as v,hg as G}from"./index-DX0rcHuW.js";import{e as g}from"./CIMSymbolHelper-DvNaY2BT.js";import{CIMSymbolRasterizer as O}from"./CIMSymbolRasterizer-DrL3VN8H.js";import{t as b,l as R}from"./symbolUtils-d94wRD2Y.js";import"./BidiEngine-BwB1Df7c.js";import"./fontUtils-BN21lj56.js";import"./OptimizedGeometry-vU5jWBvU.js";import"./GeometryUtils-CGNDP0vy.js";import"./enums-BRXbslMp.js";import"./definitions-ByNBSgP9.js";import"./mat2d-CXMJJ9G6.js";import"./mat2df32-orApM5a3.js";import"./vec2-C-4tM9Uv.js";import"./vec2f32-BbH2jxlN.js";import"./Rect-CUzevAry.js";import"./BoundingBox-BhuXqU4L.js";import"./CIMResourceManager-DXkyYiyD.js";import"./imageUtils-BsB3EL45.js";import"./utils-BbU12Hvz.js";import"./cimSymbolUtils-DzDRYI6s.js";import"./jsxFactory-DmHi7Kb2.js";import"./uuid-fwrPAdZb.js";import"./webStyleSymbolUtils-CT_ZIx-N.js";import"./devEnvironmentUtils-D6qIi8Ky.js";const u=new O(null),c=w(b.size),S=w(b.maxSize),C=w(b.lineWidth),V=1;async function $(r,e,a){const i=e==null?void 0:e.size;let t=i!=null&&typeof i=="object"&&"width"in i?i.width:i,l=i!=null&&typeof i=="object"&&"height"in i?i.height:i;if(t==null||l==null)if(a==="esriGeometryPolygon")t=c,l=c;else{const o=await q(r,e,a);o&&(t=o.width,l=o.height),a==="esriGeometryPolyline"&&(t=C),t=t!=null&&isFinite(t)?Math.min(t,S):c,l=l!=null&&isFinite(l)?Math.max(Math.min(l,S),V):c}return e.style==="legend"&&a==="esriGeometryPolyline"&&(t=C),{width:t,height:l}}async function q(r,e,a){const{feature:i,fieldMap:t,viewParams:l}=e.cimOptions||e,o=await G.resolveSymbolOverrides(r.data,i,null,t,a,null,l);if(!o)return null;(r=r.clone()).data={type:"CIMSymbolReference",symbol:o},r.data.primitiveOverrides=void 0;const n=[];return g.fetchResources(o,u.resourceManager,n),g.fetchFonts(o,u.resourceManager,n),n.length>0&&await Promise.all(n),g.getEnvelope(o,null,u.resourceManager)}async function ne(r,e={}){var M;const{node:a,opacity:i,symbolConfig:t}=e,l=t!=null&&typeof t=="object"&&"isSquareFill"in t&&t.isSquareFill,o=e.cimOptions||e,n=o.geometryType||j((M=r==null?void 0:r.data)==null?void 0:M.symbol),h=await $(r,e,n),{feature:P,fieldMap:I}=o,L=l||n!=="esriGeometryPolygon"?"preview":"legend",f=await u.rasterizeCIMSymbolAsync(r,P,h,L,I,n,null,o.viewParams,o.allowScalingUp);if(!f)return null;const{width:x,height:z}=f,m=document.createElement("canvas");m.width=x,m.height=z,m.getContext("2d").putImageData(f,0,0);const y=v(h.width),d=v(h.height),s=new Image(y,d);s.src=m.toDataURL(),s.ariaLabel=e.ariaLabel??null,s.alt=e.ariaLabel??"",i!=null&&(s.style.opacity=`${i}`);let p=s;if(e.effectView!=null){const F={shape:{type:"image",x:0,y:0,width:y,height:d,src:s.src},fill:null,stroke:null,offset:[0,0]};p=R([[F]],[y,d],{effectView:e.effectView,ariaLabel:e.ariaLabel})}return a&&p&&a.appendChild(p),p}export{ne as previewCIMSymbol};
