import{ac as e,ad as i,ag as l,al as E,n4 as ne,dx as _,n5 as pe,a as I,n6 as le,el as K,ae as d,ak as $,n7 as ae,gU as Q,gT as X,n8 as W,n9 as Z,na as de,dw as O,gp as B,nb as ue,nc as ye,ge as ce,kr as he,aL as me,kq as ve,V as H,iF as fe,iG as ge,f as P,af as xe,nd as be,ne as U,km as Ee,kn as we,n as Fe,nf as Ie}from"./index-DX0rcHuW.js";import{c as je,p as Se}from"./inputs-Due4QVtL.js";import{p as $e,e as Oe,t as Te}from"./formUtils-Dni92j4V.js";import{v as Ue}from"./HeightModelInfo-DaJXTLDg.js";import{S as De,C as Me}from"./arcgisLayerUrl-BpJodxxk.js";import{p as Be}from"./LayerFloorInfo-D-bXPB8b.js";import{p as Ae}from"./Relationship-Clp_49iY.js";import{a as ke}from"./serviceCapabilitiesUtils-CIgEASrL.js";let g=class extends E{constructor(s){super(s),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};e([i({type:String,json:{write:!0}})],g.prototype,"description",void 0),e([i({type:String,json:{write:!0}})],g.prototype,"label",void 0),e([i()],g.prototype,"type",void 0),e([i({type:String,json:{write:!0}})],g.prototype,"visibilityExpression",void 0),g=e([l("esri.form.elements.Element")],g);const b=g;var A;let S=A=class extends E{constructor(s){super(s),this.type=null}clone(){return new A({type:this.type})}};e([i({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],S.prototype,"type",void 0),S=A=e([l("esri.form.elements.inputs.AttachmentInput")],S);const Ge=S;var k;let x=k=class extends b{constructor(s){super(s),this.attachmentKeyword=null,this.editableExpression=null,this.input=null,this.type="attachment"}clone(){return new k({attachmentKeyword:this.attachmentKeyword,description:this.description,editableExpression:this.editableExpression,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};e([i({type:String,json:{write:!0}})],x.prototype,"attachmentKeyword",void 0),e([i({type:String,json:{write:!0}})],x.prototype,"editableExpression",void 0),e([i({type:Ge,json:{read:{source:"inputType"},write:{target:"inputType"}}})],x.prototype,"input",void 0),e([i({type:["attachment"],json:{read:!1,write:!0}})],x.prototype,"type",void 0),x=k=e([l("esri.form.elements.AttachmentElement")],x);const q=x;var G;let a=G=class extends b{constructor(s){super(s),this.domain=null,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}get editable(){return this._get("editable")??!0}set editable(s){this._set("editable",s)}clone(){return new G({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};e([i({types:ne,json:{read:{reader:_},write:!0}})],a.prototype,"domain",void 0),e([i({type:Boolean,json:{write:!0}})],a.prototype,"editable",null),e([i({type:String,json:{write:!0}})],a.prototype,"editableExpression",void 0),e([i({type:String,json:{write:!0}})],a.prototype,"fieldName",void 0),e([i({type:String,json:{write:!0}})],a.prototype,"hint",void 0),e([i({types:je,json:{read:{source:"inputType"},write:{target:"inputType"}}})],a.prototype,"input",void 0),e([i({type:String,json:{write:!0}})],a.prototype,"requiredExpression",void 0),e([i({type:String,json:{read:!1,write:!0}})],a.prototype,"type",void 0),e([i({type:String,json:{write:!0}})],a.prototype,"valueExpression",void 0),a=G=e([l("esri.form.elements.FieldElement")],a);const z=a;var R;let h=R=class extends b{constructor(s){super(s),this.displayCount=null,this.displayType="list",this.editableExpression=null,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new R({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editableExpression:this.editableExpression,label:this.label,orderByFields:I(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};e([i({type:Number,json:{write:!0}})],h.prototype,"displayCount",void 0),e([i({type:["list"],json:{write:!0}})],h.prototype,"displayType",void 0),e([i({type:String,json:{write:!0}})],h.prototype,"editableExpression",void 0),e([i({type:[pe],json:{write:!0}})],h.prototype,"orderByFields",void 0),e([i({type:Number,json:{write:!0}})],h.prototype,"relationshipId",void 0),e([i({type:["relationship"],json:{read:!1,write:!0}})],h.prototype,"type",void 0),h=R=e([l("esri.form.elements.RelationshipElement")],h);const L=h;var C;let w=C=class extends b{constructor(s){super(s),this.text=null,this.textFormat="plain-text",this.type="text"}clone(){return new C({text:this.text,textFormat:this.textFormat,visibilityExpression:this.visibilityExpression})}};e([i({type:String,json:{write:!0}})],w.prototype,"text",void 0),e([i({type:String,json:{write:!0}})],w.prototype,"textFormat",void 0),e([i({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],w.prototype,"type",void 0),w=C=e([l("esri.form.elements.TextElement")],w);const J=w;function Y(s){return{typesWithGroup:{base:b,key:"type",typeMap:{attachment:q,field:z,group:s,relationship:L,text:J}},typesWithoutGroup:{base:b,key:"type",typeMap:{attachment:q,field:z,relationship:L,text:J}}}}function ee(s,t,o=!0){if(!s)return null;const r=o?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return s.filter(n=>r[n.type]).map(n=>r[n.type].fromJSON(n))}function te(s,t,o=!0){if(!s)return null;const r=o?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return s.filter(n=>r[n.type]).map(n=>n.toJSON())}function ie(s,t,o=!0){return s?s.map(r=>le(o?t.typesWithGroup:t.typesWithoutGroup,r)):null}var N;let y=N=class extends b{constructor(s){super(s),this.elements=null,this.initialState="expanded",this.type="group"}castElements(s){return ie(s,D,!1)}readElements(s,t){return ee(t.formElements,D,!1)}writeElements(s,t){t.formElements=te(s,D,!1)}clone(){return new N({description:this.description,elements:I(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};e([i({json:{write:!0}})],y.prototype,"elements",void 0),e([K("elements")],y.prototype,"castElements",null),e([d("elements",["formElements"])],y.prototype,"readElements",null),e([$("elements")],y.prototype,"writeElements",null),e([i({type:["collapsed","expanded"],json:{write:!0}})],y.prototype,"initialState",void 0),e([i({type:String,json:{read:!1,write:!0}})],y.prototype,"type",void 0),y=N=e([l("esri.form.elements.GroupElement")],y);const D=Y(y),Re=y;var V;const M=Y(Re);let u=V=class extends E{constructor(s){super(s),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(s){return ie(s,M)}readElements(s,t){return ee(t.formElements,M)}writeElements(s,t){t.formElements=te(s,M)}clone(){return new V({description:this.description,expressionInfos:I(this.expressionInfos),elements:I(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}async getFieldsUsed(s,t){const o=new Set,{description:r,elements:n,expressionInfos:p,title:f}=this;if(j(o,s,r),j(o,s,f),!n)return[];const oe=Ce(n,p).map(T=>ae(o,s,T));await Promise.all(oe);for(const T of n)se(o,{fieldsIndex:s,relationships:t},T);return Array.from(o).sort()}};function se(s,t,o){var n;const{fieldsIndex:r}=t;if(!r||r.fields.length!==s.size)switch(j(s,r,o.label),j(s,r,o.description),o.type){case"field":Q(s,r,o.fieldName);break;case"group":o.elements.forEach(p=>se(s,t,p));break;case"relationship":if(t.relationships){const p=t.relationships.find(f=>f.id===o.relationshipId);p&&Q(s,r,p.keyField)}X(s,r,(n=o.orderByFields)==null?void 0:n.map(p=>p.field));break;case"text":j(s,r,o.text)}}function Ce(s,t){if(!t||t.length===0)return[];const o=re(s),r=[];for(const n of t)o.has(n.name)&&r.push(n.expression);return r}function re(s){const t=new Set;for(const o of s)if(W(t,o.visibilityExpression),!$e(o)){if(Oe(o))Z(t,re(o.elements));else if(W(t,o.editableExpression),Te(o)){const{requiredExpression:r,valueExpression:n}=o;Z(t,[r,n])}}return t}function j(s,t,o){X(s,t,de(o))}e([i({type:String,json:{write:!0}})],u.prototype,"description",void 0),e([i({json:{write:!0}})],u.prototype,"elements",void 0),e([K("elements")],u.prototype,"castElements",null),e([d("elements",["formElements"])],u.prototype,"readElements",null),e([$("elements")],u.prototype,"writeElements",null),e([i({type:[Se],json:{write:!0}})],u.prototype,"expressionInfos",void 0),e([i({type:Boolean,json:{default:!1,write:!0}})],u.prototype,"preserveFieldValuesWhenHidden",void 0),e([i({type:String,json:{write:!0}})],u.prototype,"title",void 0),u=V=e([l("esri.form.FormTemplate")],u);const _e=u;let m=class extends O(E){constructor(s){super(s),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.timeZone=null}};e([i()],m.prototype,"creatorField",void 0),e([i()],m.prototype,"creationDateField",void 0),e([i()],m.prototype,"editorField",void 0),e([i()],m.prototype,"editDateField",void 0),e([i()],m.prototype,"realm",void 0),e([i(B("dateFieldsTimeReference",!0))],m.prototype,"timeZone",void 0),m=e([l("esri.layers.support.EditFieldsInfo")],m);const Ne=m;let c=class extends O(E){constructor(s){super(s)}};e([i({constructOnly:!0,json:{write:!0}})],c.prototype,"name",void 0),e([i({constructOnly:!0,json:{write:!0}})],c.prototype,"fields",void 0),e([i({constructOnly:!0,json:{write:!0}})],c.prototype,"isAscending",void 0),e([i({constructOnly:!0,json:{write:!0}})],c.prototype,"indexType",void 0),e([i({constructOnly:!0,json:{write:!0}})],c.prototype,"isUnique",void 0),e([i({constructOnly:!0,json:{write:!0}})],c.prototype,"description",void 0),c=e([l("esri.layers.support.FeatureIndex")],c);let F=class extends O(E){constructor(s){super(s),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};e([i({type:String,json:{read:{source:"shapeAreaFieldName"}}})],F.prototype,"shapeAreaField",void 0),e([i({type:String,json:{read:{source:"shapeLengthFieldName"}}})],F.prototype,"shapeLengthField",void 0),e([i({type:String,json:{read:s=>ue.read(s)||ye.read(s)}})],F.prototype,"units",void 0),F=e([l("esri.layers.support.GeometryFieldsInfo")],F);const Ve=F;let v=class extends O(E){constructor(s){super(s),this.code=null,this.defaultValues={},this.domains=null,this.name=null}readDomains(s){if(!s)return null;const t={};for(const o of Object.keys(s))t[o]=_(s[o]);return t}writeDomains(s,t){var r;if(!s)return;const o={};for(const n of Object.keys(s))s[n]&&(o[n]=(r=s[n])==null?void 0:r.toJSON());t.domains=o}};e([i({type:Number,json:{write:!0}})],v.prototype,"code",void 0),e([i({type:Object,json:{write:!0}})],v.prototype,"defaultValues",void 0),e([i({json:{write:!0}})],v.prototype,"domains",void 0),e([d("domains")],v.prototype,"readDomains",null),e([$("domains")],v.prototype,"writeDomains",null),e([i({type:String,json:{write:!0}})],v.prototype,"name",void 0),v=e([l("esri.layers.support.Subtype")],v);const Qe=v,Ke=s=>{let t=class extends s{constructor(){super(...arguments),this.copyright=null,this.capabilities=null,this.dateFieldsTimeZone=null,this.datesInUnknownTimezone=!1,this.definitionExpression=null,this.displayField=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.globalIdField=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.indexes=new(H.ofType(c)),this.isTable=!1,this.layerId=void 0,this.maxScale=0,this.minScale=0,this.objectIdField=null,this.preferredTimeZone=null,this.relationships=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.sourceJSON=null,this.spatialReference=P.WGS84,this.subtypeField=null,this.subtypes=null,this.trackIdField=null,this.version=void 0}get authenticationTriggerEvent(){if(!this.url)return null;const{capabilities:o}=this;if(o){const{query:n,operations:p,editing:f}=o;if(!n.supportsQueryByOthers||!n.supportsQueryByAnonymous||p.supportsEditing&&!(f.supportsUpdateByOthers&&f.supportsUpdateByAnonymous&&f.supportsDeleteByOthers&&f.supportsDeleteByAnonymous))return"load"}if(this.userHasUpdateItemPrivileges){if(be(this))return"load";if(this.hasUpdateItemRestrictions)return o.operations.supportsQuery?"editing":"load"}if(this.userHasFullEditingPrivileges&&this.hasFullEditingRestrictions)return"editing";const r=this.editFieldsInfo;return(r!=null&&r.creatorField||r!=null&&r.editorField)&&(o!=null&&o.operations.supportsEditing)?"editing":null}readCapabilitiesFromService(o,r){return ke(r,this.url)}readEditingInfo(o,r){const{editingInfo:n}=r;return n?{lastEditDate:n.lastEditDate!=null?new Date(n.lastEditDate):null}:null}get effectiveCapabilities(){const o=this.capabilities;if(!o)return null;const r=I(o),{operations:n,editing:p}=r;return U(this)?(this.userHasUpdateItemPrivileges&&(n.supportsQuery=!0),r):this.userHasUpdateItemPrivileges?(n.supportsAdd=n.supportsDelete=n.supportsEditing=n.supportsQuery=n.supportsUpdate=p.supportsDeleteByOthers=p.supportsGeometryUpdate=p.supportsUpdateByOthers=!0,r):(this.userHasFullEditingPrivileges&&n.supportsEditing&&(n.supportsAdd=n.supportsDelete=n.supportsUpdate=p.supportsGeometryUpdate=!0),r)}readGlobalIdFieldFromService(o,r){return Ee(r)}get hasFullEditingRestrictions(){const o=this.capabilities;if(!o||U(this))return!1;const{operations:r,editing:n}=o;return r.supportsEditing&&!(r.supportsAdd&&r.supportsDelete&&r.supportsUpdate&&n.supportsGeometryUpdate)}get hasUpdateItemRestrictions(){const o=this.capabilities;if(!o)return!1;const{operations:r,editing:n}=o;return U(this)?!r.supportsQuery:!(r.supportsAdd&&r.supportsDelete&&r.supportsEditing&&r.supportsQuery&&r.supportsUpdate&&n.supportsDeleteByOthers&&n.supportsGeometryUpdate&&n.supportsUpdateByOthers)}readIsTableFromService(o,r){return r.type==="Table"}readMaxScale(o,r){return r.effectiveMaxScale||o||0}readMinScale(o,r){return r.effectiveMinScale||o||0}readObjectIdFieldFromService(o,r){return we(r)}readServiceDefinitionExpression(o,r){return r.definitionQuery||r.definitionExpression}set url(o){if(o==null)return void this._set("url",o);const r=De({layer:this,url:o,nonStandardUrlAllowed:!0,logger:Fe.getLogger(this)});this._set("url",r.url),r.layerId!=null&&this._set("layerId",r.layerId)}writeUrl(o,r,n,p){Me(this,o,null,r,p)}readVersion(o,r){return Ie(r)}};return e([i({readOnly:!0})],t.prototype,"authenticationTriggerEvent",null),e([i({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],t.prototype,"copyright",void 0),e([i({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],t.prototype,"capabilities",void 0),e([d("service","capabilities")],t.prototype,"readCapabilitiesFromService",null),e([i(B("dateFieldsTimeReference"))],t.prototype,"dateFieldsTimeZone",void 0),e([i({type:Boolean})],t.prototype,"datesInUnknownTimezone",void 0),e([i({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],t.prototype,"definitionExpression",void 0),e([i({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],t.prototype,"displayField",void 0),e([i({readOnly:!0,type:Ne})],t.prototype,"editFieldsInfo",void 0),e([i({readOnly:!0})],t.prototype,"editingInfo",void 0),e([d("editingInfo")],t.prototype,"readEditingInfo",null),e([i({readOnly:!0})],t.prototype,"effectiveCapabilities",null),e([i((()=>{const o=I(ce),r=o.json.origins;return r["web-map"]={read:!1,write:!1},r["portal-item"]={read:!1,write:!1},o})())],t.prototype,"elevationInfo",void 0),e([i({type:Be,json:{name:"layerDefinition.floorInfo",write:!0,origins:{"web-scene":{name:"layerDefinition.floorInfo",write:{enabled:!0,layerContainerTypes:he}}}}})],t.prototype,"floorInfo",void 0),e([i({type:me,json:{origins:{service:{read:{source:"extent"}}}}})],t.prototype,"fullExtent",void 0),e([i()],t.prototype,"gdbVersion",void 0),e([i({readOnly:!0,type:Ve,json:{read:{source:"geometryProperties"}}})],t.prototype,"geometryFieldsInfo",void 0),e([i({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:ve.read}}}})],t.prototype,"geometryType",void 0),e([i({type:String})],t.prototype,"globalIdField",void 0),e([d("service","globalIdField",["globalIdField","fields"])],t.prototype,"readGlobalIdFieldFromService",null),e([i({readOnly:!0})],t.prototype,"hasFullEditingRestrictions",null),e([i({type:Boolean,json:{origins:{service:{read:!0}}}})],t.prototype,"hasM",void 0),e([i({readOnly:!0})],t.prototype,"hasUpdateItemRestrictions",null),e([i({type:Boolean,json:{origins:{service:{read:!0}}}})],t.prototype,"hasZ",void 0),e([i({readOnly:!0,type:Ue})],t.prototype,"heightModelInfo",void 0),e([i({type:Date})],t.prototype,"historicMoment",void 0),e([i({type:H.ofType(c),readOnly:!0})],t.prototype,"indexes",void 0),e([i({readOnly:!0})],t.prototype,"isTable",void 0),e([d("service","isTable",["type"])],t.prototype,"readIsTableFromService",null),e([i({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],t.prototype,"layerId",void 0),e([i(fe)],t.prototype,"maxScale",void 0),e([d("service","maxScale",["maxScale","effectiveMaxScale"])],t.prototype,"readMaxScale",null),e([i(ge)],t.prototype,"minScale",void 0),e([d("service","minScale",["minScale","effectiveMinScale"])],t.prototype,"readMinScale",null),e([i({type:String})],t.prototype,"objectIdField",void 0),e([d("service","objectIdField",["objectIdField","fields"])],t.prototype,"readObjectIdFieldFromService",null),e([i(B("preferredTimeReference"))],t.prototype,"preferredTimeZone",void 0),e([i({type:[Ae],readOnly:!0})],t.prototype,"relationships",void 0),e([i({type:Boolean})],t.prototype,"returnM",void 0),e([i({type:Boolean})],t.prototype,"returnZ",void 0),e([i({readOnly:!0,json:{write:!1}})],t.prototype,"serverGens",void 0),e([i({readOnly:!0})],t.prototype,"serviceDefinitionExpression",void 0),e([d("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],t.prototype,"readServiceDefinitionExpression",null),e([i({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],t.prototype,"serviceItemId",void 0),e([i()],t.prototype,"sourceJSON",void 0),e([i({type:P,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],t.prototype,"spatialReference",void 0),e([i({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],t.prototype,"subtypeField",void 0),e([i({type:[Qe],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],t.prototype,"subtypes",void 0),e([i({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],t.prototype,"trackIdField",void 0),e([i(xe)],t.prototype,"url",null),e([$("url")],t.prototype,"writeUrl",null),e([i({json:{origins:{service:{read:!0}},read:!1}})],t.prototype,"version",void 0),e([d("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],t.prototype,"readVersion",null),t=e([l("esri.layers.mixins.FeatureLayerBase")],t),t};export{Ke as R,_e as V,Qe as n};
