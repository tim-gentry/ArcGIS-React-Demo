import{eE as y,cx as _,cb as E,M as $,bY as n,i0 as D,eH as R,ac as u,ad as f,ag as b,bh as H,dN as l,jf as L,cC as P,m as T,j6 as k,dI as c}from"./index-DX0rcHuW.js";import{r as O,t as v}from"./ElevationProfile-CRUPn4HG.js";import{a as S}from"./HoveredPoints-CXMCOW6Z.js";import{a as V}from"./elevationInfoUtils-JmMUMmCn.js";import{j as I}from"./settings-gcMFavfO.js";import{w}from"./OutlineVisualElement-BSh2jMZu.js";import{e as M}from"./GraphicState-8Z_F1at3.js";import{h as j}from"./Material-BfvzXcva.js";import{n as x}from"./layerViewUtils-D2JqIDZ8.js";import{e as z}from"./throttle-jjSnxk80.js";import"./memoize-DsJmrG76.js";import"./jsxFactory-DmHi7Kb2.js";import"./uuid-fwrPAdZb.js";import"./ByteSizeUnit-BsxeN7wM.js";import"./ElevationQueryTileCache-ByGSevWc.js";import"./projectVectorToVector-DjKO2tJh.js";import"./projectPointToVector-6lqiVL77.js";import"./LayerConstants-B33OP6sh.js";import"./ElevationProvider-Xg9LKEp7.js";import"./mat4f64-Dk4dwAN8.js";import"./sphere-COyqsaGw.js";import"./plane-BL9J6YX0.js";import"./mat3f64-BBpwCtoL.js";import"./quatf64-BrpT0VRp.js";import"./vec2f64-Diu2Kaa8.js";import"./mathUtils-BsqbT0oM.js";import"./ViewingMode-Dodu7ZZk.js";import"./boundedPlane-MAPkm7Yi.js";import"./lineSegment-C2OVzbAD.js";import"./verticalOffsetUtils-Bq_pVrum.js";import"./mat3-Ck4GO2qT.js";import"./orientedBoundingBox-BTwqkknQ.js";import"./quat-DrJsq_-D.js";import"./spatialReferenceEllipsoidUtils-Bv0mQCFg.js";import"./computeTranslationToOriginAndRotation-B9BchKSd.js";import"./Intersector-CG5xfiNM.js";import"./Intersector-ENyKy7_L.js";import"./defaultUnit-CeSgMfuW.js";import"./getDefaultUnitForView-Cl7rPtCt.js";import"./vec2-C-4tM9Uv.js";import"./geodesicUtils-BPlO99Nt.js";import"./QueueProcessor-01Ee2ByR.js";import"./ReactiveMap-r-vujrh9.js";import"./signal-CpmfLcHB.js";import"./Scheduler-Bg_fxWwI.js";import"./debugFlags-Cr0sx6r_.js";import"./traversalUtils-DmE6QkgJ.js";import"./Ground-dhRLerDt.js";import"./loadAll-8MiqgLTH.js";import"./ElevationQuery-DaGOvBJY.js";import"./ElevationSamplerData-CFwzCheb.js";import"./ElevationTile-MIg3DBTc.js";import"./TileKey-DZd6gJy7.js";import"./GraphicsLayer-SBXo_p0G.js";import"./GraphicsCollection-BjA_qBYu.js";import"./InputManager-abOXR3ru.js";import"./SketchViewModel-CW2OqW_5.js";import"./isSupportedObject-DZrOSWxn.js";import"./SketchLabelOptions-zVB6yjLA.js";import"./SnappingManager-C8RCylzd.js";import"./UpdatingHandles-CERUeL1P.js";import"./geometry2dUtils-D5ud2BJg.js";import"./floorFilterUtils-DZ5C6FQv.js";import"./keybindings-RFI4I3n4.js";import"./utils-CXgSw6Sd.js";import"./geodesicLengthMeasurementUtils-1VjlYqtL.js";import"./quantityUtils-DSpmykXR.js";import"./geometryEngine-C92iiwvG.js";import"./geometryEngineBase-RmbNeFm7.js";import"./_commonjsHelpers-DCkdB7M8.js";import"./hydrated-CEL7VY_R.js";import"./Cyclical-CEj-eenM.js";import"./layerUtils-BS1Di3Pm.js";import"./hitTestSelectUtils-UXJPjatw.js";import"./screenUtils-BcEL8jIe.js";import"./unitFormatUtils-BYvkXWcg.js";import"./substitute-e0S7rtIE.js";import"./UnitSelect-Cjf2PU8k.js";import"./globalCss-CZa70j6i.js";import"./AnchorElementViewModel-tkNzekRS.js";import"./ExtendedLineVisualElement-BOr1bkvb.js";import"./vec4f32-CjrfB-0a.js";import"./frustum-Tc8kkw3_.js";import"./EngineVisualElement-DinfBZ8X.js";import"./RenderGeometry-CQQOC_nW.js";import"./vec3f32-Cw9Q6TO_.js";import"./DoubleArray-tnpOy9RK.js";import"./Texture-0jciB86n.js";import"./Matrix4PassUniform-CTNrzJ6Q.js";import"./interfaces-B8ge7Jg9.js";import"./BindType-BmZEZMMh.js";import"./VertexAttribute-BnAa5VW0.js";import"./Util-HYkJg9Vp.js";import"./enums-BlUEVwJR.js";import"./Texture-BF0Xf23l.js";import"./basicInterfaces-wONHx_SN.js";import"./ShaderTechniqueConfiguration-D3UbJ2mX.js";import"./doublePrecisionUtils-B0owpBza.js";import"./Indices-BZu2O98k.js";import"./triangle-CGr49R4x.js";import"./renderState-yUi34s5A.js";import"./requestImageUtils-Cd7mPI4y.js";import"./hydratedFeatures-DcIGyuBL.js";import"./axisAngleDegrees-jEN9n05M.js";import"./weather-CSMUgeU9.js";import"./Float4DrawUniform-X0Lc1Ix0.js";import"./NestedMap-DgiGbX8E.js";import"./Octree-lrGXb_0y.js";import"./InterleavedLayout-ZKuAjCiK.js";import"./BufferView-XrMc2vJu.js";import"./types-D0PSWh4d.js";import"./floatRGBA-DZ6CgOhi.js";import"./glUtil-C6KhMg1m.js";import"./VertexElementDescriptor-BOD-G50G.js";import"./VertexArrayObject-9V6uZ6_q.js";import"./BufferObject-CWTeBz1x.js";import"./VisualElement-B9pa0AX0.js";import"./Laserlines.glsl-DcZ83Cyr.js";import"./lineStippleUtils-Cu2kwDBg.js";import"./triangulationUtils-BSy4A0L9.js";import"./earcut-BqgeR2O3.js";import"./deduplicate-CREmZpKM.js";let C=class{constructor(t){this._params=t,this._highlightTask=null,this._highlightHandle=null,this._visualElementHandle=null,this._settings=new I({getTheme:()=>this._params.view.effectiveTheme})}destroy(){this.remove()}remove(){this._highlightTask=y(this._highlightTask),this._highlightHandle=_(this._highlightHandle),this._visualElementHandle=_(this._visualElementHandle)}showHighlight(t){if(this.remove(),t==null||!g(t))return;const e=t.layer;this._highlightTask=E(async i=>{const s=await this._params.view.whenLayerView(e);$(i),x(s)&&(this._highlightHandle=s.highlight(t))})}showReshaping(t){if(this.remove(),t==null)return;const e=this._params.view,i=new w({view:e,geometry:g(t)?t.geometry:null,attached:!1,elevationInfo:V(t),renderOccluded:j.OccludeAndTransparentStencil,isDecoration:!0}),s=new M({graphic:t}),o=[n(()=>s.isDraped,m=>{i.isDraped=m}),s.on("changed",()=>{i.geometry=g(t)?t.geometry:null}),e.trackGraphicState(s),e.maskOccludee(t),D(i)];this._settings.visualElements.lineObjects.outline.apply(i),i.attached=!0,this._visualElementHandle=R(o)}};function g(r){return r.geometry!=null&&r.geometry.type==="polyline"}const G=100;let h=class extends H{constructor(r){super(r),this._chartData=null,this._visualElements=[]}initialize(){const r=z(t=>{this._update(t)},G);this.addHandles([n(()=>({spatialReference:this.view.spatialReference,chartData:this._chartData}),r,l),r])}destroy(){this._destroyVisualElements()}remove(){this._destroyVisualElements()}update(r){this._chartData=r}_update(r){const{chartData:t}=r;if(t==null)return this.remove();if(!t.refined)return;const e=this._visualElements,i=t.lines.filter(p=>p.viewVisualizationEnabled),s=i.length;for(;e.length>s;)e.pop().destroy();const o=O().profileLinesStyle3D;for(;e.length<s;){const p=new w({view:this.view,elevationInfo:{mode:"absolute-height",offset:0},innerWidth:o.width-o.outlineSize,width:o.width,falloff:o.falloff,color:o.outlineColor,renderOccluded:o.renderOccluded,isDecoration:!0});e.push(p)}const m=r.spatialReference;for(let p=0;p<s;++p){const d=e[p],a=i[s-1-p];d.geometry=this._createLineGeometry(a,m),d.innerColor=L(P.toUnitRGBA(a.color))}}_createLineGeometry(r,t){const e=r.samples??[],i=e.length-1,s=[];let o=[];for(let m=0;m<=i;m++){const{x:p,y:d,z:a}=e[m];a!=null&&o.push([p,d,a]),m!==i&&a!=null||!o.length||(s.push(o),o=[])}return new T({paths:s,hasZ:!0,spatialReference:t})}_destroyVisualElements(){this._visualElements.forEach(r=>r.destroy()),this._visualElements.length=0}};u([f()],h.prototype,"view",void 0),u([f()],h.prototype,"_chartData",void 0),h=u([b("esri.widgets.ElevationProfile.support.ProfileLines3D")],h);class ee{constructor(t,e){this._handles=new k,this._inputRepresentation=new C({view:t}),this._hoveredPoints=new S({view:t}),this._profileLines=new h({view:t}),this._handles.add([n(()=>e.viewModel.hoveredPoints,i=>this._hoveredPoints.update(i),l),n(()=>{const{state:i,editable:s,highlightEnabled:o,viewModel:m}=e,p=m.input;return p&&(p.commitProperty("geometry"),p.commitProperty("layer")),{input:p,state:i,editable:s,highlightEnabled:o}},i=>this._updateInputRepresentation(i),l),n(()=>e.viewModel.chartData,i=>this._profileLines.update(i),l),n(()=>{var i;return(i=e.viewModel.input)==null?void 0:i.geometry},()=>{this._profileLines.remove()},l)])}destroy(){this._handles=c(this._handles),this._inputRepresentation=c(this._inputRepresentation),this._hoveredPoints=c(this._hoveredPoints),this._profileLines=c(this._profileLines)}_updateInputRepresentation({input:t,state:e,editable:i,highlightEnabled:s}){const o=this._inputRepresentation;if(!s)return o.remove();e===v.Selected?o.showHighlight(t):e!==v.Created||i?o.remove():o.showReshaping(t)}}export{ee as ElevationProfileView3D};
