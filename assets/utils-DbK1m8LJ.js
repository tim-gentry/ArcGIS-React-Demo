const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DX0rcHuW.js","assets/index-B2yzeq1w.css"])))=>i.map(i=>d[i]);
import{aF as I,_ as h,eD as C,aR as E,aQ as x,cC as A,kO as V,aZ as $,kP as N,eI as R}from"./index-DX0rcHuW.js";import"./Basemap-CjElSnyL.js";import{h as p}from"./utils-BbU12Hvz.js";import{Z as O,N as U}from"./utils-CZ12wTZ2.js";const k=/^-?(\d+)(\.(\d+))?$/i;function q(e,t){return e-t}function B(e,t){let n,a;return n=Number(e.toFixed(t)),n<e?a=n+1/10**t:(a=n,n-=1/10**t),n=Number(n.toFixed(t)),a=Number(a.toFixed(t)),[n,a]}function M(e,t,n,a,o){const l=_(e,t,n,a),r=l.previous==null||l.previous<=o,i=l.next==null||l.next<=o;return r&&i||l.previous+l.next<=2*o}function v(e){const t=String(e),n=t.match(k);if(n!=null&&n[1])return{integer:n[1].split("").length,fractional:n[3]?n[3].split("").length:0};if(t.toLowerCase().includes("e")){const a=t.split("e"),o=a[0],l=a[1];if(o&&l){const r=Number(o);let i=Number(l);const u=i>0;u||(i=Math.abs(i));const s=v(r);return u?(s.integer+=i,i>s.fractional?s.fractional=0:s.fractional-=i):(s.fractional+=i,i>s.integer?s.integer=1:s.integer-=i),s}}return{integer:0,fractional:0}}function _(e,t,n,a){const o={previous:null,next:null};if(n!=null){const l=e-n,r=t-n-l;o.previous=Math.floor(Math.abs(100*r/l))}if(a!=null){const l=a-e,r=a-t-l;o.next=Math.floor(Math.abs(100*r/l))}return o}function te(e,t={}){const n=e.slice(0),{tolerance:a=2,strictBounds:o=!1,indexes:l=n.map((r,i)=>i)}=t;l.sort(q);for(let r=0;r<l.length;r++){const i=l[r],u=n[i],s=i===0?null:n[i-1],c=i===n.length-1?null:n[i+1],d=v(u).fractional;if(d){let m,w=0,g=!1;for(;w<=d&&!g;){const b=B(u,w);m=o&&r===0?b[1]:b[0],g=M(u,m,s,c,a),w++}g&&(n[i]=m)}}return n}const S={maximumFractionDigits:20};function F(e){return I(e,S)}const L="<",Q=">";function T(e,t,n,a){let o="";return t===0?o=`${L} `:t===n&&(o=`${Q} `),o+(a?U(e,a):F(e))}const ne=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="];async function D(e){if(!("visualVariables"in e)||!e.visualVariables)return null;const t=e.visualVariables.find(r=>r.type==="color");if(!t)return null;let n=null,a=null;if(t.stops){if(t.stops.length===1)return t.stops[0].color;n=t.stops[0].value,a=t.stops[t.stops.length-1].value}const o=n!=null&&a!=null?n+(a-n)/2:0,{getColor:l}=await h(async()=>{const{getColor:r}=await import("./index-DX0rcHuW.js").then(i=>i.qL);return{getColor:r}},__vite__mapDeps([0,1]));return l(t,o)??null}async function oe(e,t){const n=e.trailCap,a=e.trailWidth||1,o=t||await D(e)||e.color;return new C({cap:n,color:o,width:a})}function ae(e){return e!=null&&typeof e=="object"&&"min"in e&&"max"in e}function j(e,t){var n,a;if(!t.field)return null;if("featureReduction"in e)switch((n=e.featureReduction)==null?void 0:n.type){case"cluster":case"binning":{const o=e.featureReduction.fields.find(({name:l})=>l.toLowerCase()===t.field.toLowerCase());return o&&"getField"in e?e.getField(o.onStatisticField):null}}return"getField"in e?(a=e.getField)==null?void 0:a.call(e,t.field):null}function K(e,t){var a,o,l;const n="popupTemplate"in e?(a=e.popupTemplate)==null?void 0:a.fieldInfos:null;if(n!=null&&n.length&&t)return(l=(o=n.find(r=>{var i;return((i=r.fieldName)==null?void 0:i.toLowerCase())===t.toLowerCase()}))==null?void 0:o.format)==null?void 0:l.dateFormat}function le(e,t,n){var l,r,i,u;const a=j(e,t);if(!a||!O(a)&&!E(a))return null;let o=K(e,a.name);if(!o&&a.type==="date"){let s=0,c=0;t.stops?(s=((r=(l=t.stops)==null?void 0:l.at(0))==null?void 0:r.value)??s,c=((u=(i=t.stops)==null?void 0:i.at(-1))==null?void 0:u.value)??c):"minDataValue"in t&&"maxDataValue"in t&&(s=t.minDataValue??s,c=t.maxDataValue??c),o=c-s>2*x.days?"short-date":"short-date-short-time"}return{fieldType:a.type,format:o,timeZoneOptions:{layerTimeZone:"preferredTimeZone"in e?e.preferredTimeZone:null,viewTimeZone:n,datesInUnknownTimezone:"datesInUnknownTimezone"in e&&e.datesInUnknownTimezone}}}function ie(e){var t,n;if("authoringInfo"in e)return(n=(t=e.authoringInfo)==null?void 0:t.visualVariables)==null?void 0:n.find(({theme:a})=>a==="reference-size")}const P=new A([64,64,64]);function y(e,t){const n=[],a=e.length-1;return e.length===5?n.push(0,2,4):n.push(0,a),e.map((o,l)=>n.includes(l)?T(o,l,a,t):null)}async function W(e,t,n){let a=!1,o=[],l=[];if(e.stops){const s=e.stops;o=s.map(c=>c.value),a=s.some(c=>!!c.label),a&&(l=s.map(c=>c.label))}const r=o[0],i=o[o.length-1];if(r==null&&i==null)return null;const u=a?null:y(o,n);return(await Promise.all(o.map(async(s,c)=>({value:s,color:e.type==="opacity"?await Z(s,e,t):(await h(async()=>{const{getColor:d}=await import("./index-DX0rcHuW.js").then(m=>m.qL);return{getColor:d}},__vite__mapDeps([0,1]))).getColor(e,s),label:a?l[c]:(u==null?void 0:u[c])??""})))).reverse()}async function Z(e,t,n){const a=new A(n??P),o=(await h(async()=>{const{getOpacity:l}=await import("./index-DX0rcHuW.js").then(r=>r.qL);return{getOpacity:l}},__vite__mapDeps([0,1]))).getOpacity(t,e);return o!=null&&(a.a=o),a}function re(e){let t=!1,n=[],a=[];n=e.map(i=>i.value),t=e.some(i=>!!i.label),t&&(a=e.map(i=>i.label??""));const o=n[0],l=n[n.length-1];if(o==null&&l==null)return null;const r=t?null:y(n);return n.map((i,u)=>({value:i,color:G(i,e),label:t?a[u]:(r==null?void 0:r[u])??""})).reverse()}function G(e,t){const{startIndex:n,endIndex:a,weight:o}=z(e,t);if(n===a)return t[n].color;const l=A.blendColors(t[n].color,t[a].color,o);return new A(l)}function z(e,t){let n=0,a=t.length-1;return t.some((o,l)=>e<o.value?(a=l,!0):(n=l,!1)),{startIndex:n,endIndex:a,weight:(e-t[n].value)/(t[a].value-t[n].value)}}function se(e,t){let n=[];if(e&&e.type==="multipart")e.colorRamps.reverse().forEach((a,o)=>{o===0?n.push({value:t.max,color:new A(a.toColor),label:"high"}):n.push({value:null,color:new A(a.toColor),label:""}),o===e.colorRamps.length-1?n.push({value:t.min,color:new A(a.fromColor),label:"low"}):n.push({value:null,color:new A(a.fromColor),label:""})});else{let a,o;e&&e.type==="algorithmic"?(a=e.fromColor,o=e.toColor):(a=[0,0,0,1],o=[255,255,255,1]),n=[{value:t.max,color:new A(o),label:"high"},{value:t.min,color:new A(a),label:"low"}]}return n}function H(e){if(!e.colorStops)return[];const t=[...e.colorStops].filter(a=>{var o;return((o=a.color)==null?void 0:o.a)>0});let n=t.length-1;if(t&&t[0]){const a=t[n];a&&a.ratio!==1&&(t.push(new V({ratio:1,color:a.color})),n++)}return t.map((a,o)=>{var r,i;let l="";return o===0?l=((r=e.legendOptions)==null?void 0:r.minLabel)||"low":o===n&&(l=((i=e.legendOptions)==null?void 0:i.maxLabel)||"high"),{color:a.color,label:l,ratio:a.ratio}}).reverse()}const ue=$("short-date");async function f(e,t,n){R(e,t,()=>[]).push(...n)}async function ce(e){var n,a;const t=new Map;if(!e)return t;if("visualVariables"in e&&e.visualVariables){const o=e.visualVariables.filter(l=>l.type==="color");for(const l of o){const r=(await W(l)??[]).map(i=>i.color);await f(t,l.field||l.valueExpression,r)}}if(e.type==="heatmap"){const o=H(e).map(l=>l.color);await f(t,e.field||e.valueExpression,o)}else if(e.type==="pie-chart"){for(const o of e.attributes)await f(t,o.field||o.valueExpression,[o.color]);await f(t,"default",[(n=e==null?void 0:e.othersCategory)==null?void 0:n.color,p(e.backgroundFillSymbol,null)])}else if(e.type==="dot-density"){for(const o of e.attributes)await f(t,o.field||o.valueExpression,[o.color]);await f(t,"default",[e.backgroundColor])}else if(e.type==="unique-value")if(((a=e.authoringInfo)==null?void 0:a.type)==="predominance")for(const o of e.uniqueValueInfos??[])await f(t,o.value.toString(),[p(o.symbol,null)]);else{const o=(e.uniqueValueInfos??[]).map(s=>p(s.symbol,null)),{field:l,field2:r,field3:i,valueExpression:u}=e;(l||u)&&await f(t,l||u,o),r&&await f(t,r,o),i&&await f(t,i,o)}else if(e.type==="class-breaks"){const o=e.classBreakInfos.map(i=>p(i.symbol,null)),{field:l,valueExpression:r}=e;await f(t,l??r,o)}else e.type==="simple"&&await f(t,"default",[p(e.symbol,null)]);return"defaultSymbol"in e&&e.defaultSymbol&&await f(t,"default",[p(e.defaultSymbol,null)]),t.forEach((o,l)=>{const r=N(o.filter(Boolean),(i,u)=>JSON.stringify(i)===JSON.stringify(u));t.set(l,r)}),t}export{L as a,Q as b,G as c,re as d,H as e,ae as f,se as g,D as h,v as i,le as j,W as k,_ as l,oe as p,T as r,ne as s,te as u,ue as v,ie as w,ce as x};
