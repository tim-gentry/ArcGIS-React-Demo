import{ac as r,ad as s,ag as P,s as V,d as L}from"./index-DX0rcHuW.js";import{i as S}from"./timeSupport-BW78MsMT.js";import{v as _,s as E}from"./rasterProjectionHelper-ByWCXlzR.js";import{p as O}from"./popupUtils-DV44wDbq.js";const M=R=>{let t=class extends R{constructor(){super(...arguments),this._rasterFieldPrefix="Raster.",this.layer=null,this.view=null,this.tileInfo=null}get fullExtent(){return this._getfullExtent()}get timeExtent(){var a;return S(this.layer,(a=this.view)==null?void 0:a.timeExtent,this._get("timeExtent"))}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){return _(this.layer.fullExtent,this.view.spatialReference,!0)}supportsSpatialReference(a){return!!E(this.layer.serviceRasterInfo,a)}async fetchPopupFeaturesAtLocation(a,f){var g;const{layer:e}=this;if(!a)throw new V("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:e});const{popupEnabled:T}=e,b=O(e,f);if(!T||b==null)return[];const h=[],{value:l,magdirValue:o,processedValue:y}=await e.identify(a,{timeExtent:this.timeExtent,signal:f==null?void 0:f.signal});let c="";if(l!=null&&l.length){c=e.type==="imagery-tile"&&e.hasStandardTime()&&l[0]!=null?l.map(d=>e.getStandardTimeValue(d)).join(", "):l.join(", ");const i={ObjectId:0},m="Raster.ServicePixelValue";i[m]=e.type==="imagery-tile"&&e.raster.datasetFormat==="Function"?y==null?void 0:y.join(", "):c,i[m+".Raw"]=c;const u=((g=e.raster)==null?void 0:g.rasterInfo)??e.serviceRasterInfo,v=u==null?void 0:u.attributeTable;if(v!=null){const{fields:d,features:j}=v,w=d.find(({name:n})=>n.toLowerCase()==="value"),F=i[m],p=w?j.find(n=>String(n.attributes[w.name])===F):null;if(p)for(const n in p.attributes)p.attributes.hasOwnProperty(n)&&(i[this._rasterFieldPrefix+n]=p.attributes[n])}const x=u==null?void 0:u.dataType;x!=="vector-magdir"&&x!=="vector-uv"||(i["Raster.Magnitude"]=o==null?void 0:o[0],i["Raster.Direction"]=o==null?void 0:o[1]);const I=new L({geometry:this.fullExtent.clone(),attributes:i,layer:e,sourceLayer:e});h.push(I)}return h}_getfullExtent(){return E(this.layer.serviceRasterInfo,this.view.spatialReference)}};return r([s()],t.prototype,"fullExtent",null),r([s()],t.prototype,"layer",void 0),r([s({readOnly:!0})],t.prototype,"timeExtent",null),r([s()],t.prototype,"view",void 0),r([s()],t.prototype,"tileInfo",void 0),r([s({readOnly:!0})],t.prototype,"hasTilingEffects",null),r([s()],t.prototype,"datumTransformation",null),t=r([P("esri.views.layers.ImageryTileLayerView")],t),t};export{M as u};
