const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Popup-z4L90_L_.js","assets/index-DX0rcHuW.js","assets/index-B2yzeq1w.css","assets/Features-uxaEfcU_.js","assets/throttle-jjSnxk80.js","assets/geometryUtils-BuUXQqUb.js","assets/scaleUtils-ClqQrarK.js","assets/actionUtils-Ciirz51Y.js","assets/substitute-e0S7rtIE.js","assets/Feature-CC07TEfF.js","assets/jsxFactory-DmHi7Kb2.js","assets/uuid-fwrPAdZb.js","assets/Attachments-DXLBKqC7.js","assets/unitFormatUtils-BYvkXWcg.js","assets/ByteSizeUnit-BsxeN7wM.js","assets/Cyclical-CEj-eenM.js","assets/quantityUtils-DSpmykXR.js","assets/AttachmentInfo-CypukXoR.js","assets/featureUtils-5jWDUftn.js","assets/utils-CZ12wTZ2.js","assets/Basemap-CjElSnyL.js","assets/loadAll-8MiqgLTH.js","assets/writeUtils-RiCb1SCd.js","assets/globalCss-CZa70j6i.js","assets/legacyIcon-CtsJ0OTG.js","assets/Heading-BI51LCyX.js","assets/widget-Co0CQfZ6.js","assets/uriUtils-BPtCS-W9.js","assets/a11yUtils-BcOnuh2m.js","assets/utils-DbK1m8LJ.js","assets/utils-BbU12Hvz.js","assets/cimSymbolUtils-DzDRYI6s.js","assets/executeQueryJSON-_Gsxb9pi.js","assets/utils-nzDIu46v.js","assets/query-95tcIPsI.js","assets/normalizeUtils-CzEkgn6d.js","assets/normalizeUtilsCommon-DXRtgGFh.js","assets/utils-D67OULxu.js","assets/pbfQueryUtils-B33F7Io8.js","assets/pbf-9I_px9lQ.js","assets/OptimizedGeometry-vU5jWBvU.js","assets/OptimizedFeature-7juV2tZm.js","assets/OptimizedFeatureSet-Blu9Ckm7.js","assets/queryZScale-B1r3mH-Y.js","assets/TopFeaturesQuery-B-wHLSqs.js","assets/themeUtils-C3zvZbsE.js","assets/FeatureLayer-Bb5mf85J.js","assets/FeatureLayerBase-uK0oK06Z.js","assets/inputs-Due4QVtL.js","assets/formUtils-Dni92j4V.js","assets/HeightModelInfo-DaJXTLDg.js","assets/arcgisLayerUrl-BpJodxxk.js","assets/LayerFloorInfo-D-bXPB8b.js","assets/Relationship-Clp_49iY.js","assets/serviceCapabilitiesUtils-CIgEASrL.js","assets/editsZScale-BDLbHb5e.js","assets/APIKeyMixin-DSbft86T.js","assets/ArcGISService-CVVnFG2B.js","assets/EditBusLayer-Brt5ASt_.js","assets/FeatureType-Bb4KOLCq.js","assets/versionUtils-DlHqsQBg.js","assets/styleUtils-CxRaW7Jr.js","assets/interfaces-CL2NbQte.js","assets/FeatureRelationshipViewModel-Ce0Hgjfu.js","assets/featureFormUtils-CYPLvOWh.js","assets/Spinner-D82_54Uv.js","assets/AnchorElementViewModel-tkNzekRS.js","assets/ReactiveSet-BcQY7AxE.js","assets/LayerConstants-B33OP6sh.js","assets/symbolUtils-d94wRD2Y.js","assets/mat2df32-orApM5a3.js","assets/mat2d-CXMJJ9G6.js","assets/webStyleSymbolUtils-CT_ZIx-N.js","assets/devEnvironmentUtils-D6qIi8Ky.js","assets/layerViewUtils-D2JqIDZ8.js","assets/actions-xqsAfqzZ.js","assets/GoTo-Bv8U0vYJ.js","assets/vmEvent-D4Ubqkbq.js","assets/geometryServiceUtils-zF1xOQ4Y.js","assets/project-BQyPiext.js","assets/Lyr3DWasmPerSceneView-C2UJE6LO.js","assets/ILyr3DWasmPerSceneView-vPx4somd.js","assets/WorkerHandle-DkXs_4ea.js","assets/Lyr3DModule-DYfNkg0p.js","assets/elevationInfoUtils-JmMUMmCn.js","assets/makeScheduleFunction-CggzEh3c.js"])))=>i.map(i=>d[i]);
import{ac as l,ad as c,ag as b,bY as w,fa as Z,jm as De,bh as M,V as x,dI as W,n as I,j7 as yt,cx as ie,hn as nn,bN as qt,eJ as bi,_ as Ue,s as L,cb as Tt,M as fe,pw as sn,b9 as $e,hm as on,L as Ye,c0 as an,i1 as it,b_ as Je,dN as _t,cA as Mi,jZ as $t,ap as xi,cy as nt,dG as re,b5 as Ct,m5 as rn,px as se,fr as ln,eI as hn,gB as jt,py as cn,b6 as ki,ff as Ut,dw as dn,cC as Be,ar as Xe,d_ as pn,bn as Ge,dt as un,kW as Qe,d9 as mn,bJ as gn,db as fn,da as yn,eE as vt,eK as _n,gK as vn,j6 as wn,b$ as Bt,g2 as bn,a3 as Gt,G as Mn,jW as Kt,jV as xn,bZ as Pi,aL as Ti,f as $i,g1 as kn,pz as Pn,cB as Tn,gJ as te,bs as st,jh as Y,bX as $n,jg as Cn,d6 as Sn,el as Ci,a0 as En,ib as In,K as Dn,f0 as Ln,cN as Vn,lB as An}from"./index-DX0rcHuW.js";import{t as Yt,x as Si,y as Jt,z as Ei,q as Rn,E as Xt,e as Fn,B as On,n as Le}from"./jsxFactory-DmHi7Kb2.js";import{h as et}from"./UpdatingHandles-CERUeL1P.js";import{_ as St,a as _e}from"./InputManager-abOXR3ru.js";import{L as zn}from"./Map-BcseqEdU.js";import{l as Nn}from"./CollectionFlattener-Be8YW6oV.js";import{n as Hn,c as Ii,l as Qt}from"./GraphicsCollection-BjA_qBYu.js";import{v as Wn}from"./HeightModelInfo-DaJXTLDg.js";import{a as ot}from"./TablesMixin-CcZZ6esO.js";import{s as Zn}from"./ReactiveMap-r-vujrh9.js";import{e as Ve}from"./selectionUtils-DYi6daQO.js";import"./IViewEvents-Bci6PjlS.js";import{o as wt}from"./interfaces-D6pIddIh.js";import{n as j,i as qn}from"./screenUtils-BcEL8jIe.js";import{o as jn}from"./a11yUtils-BcOnuh2m.js";import{g as Un,l as Bn}from"./heightModelInfoUtils-CTi_JiJC.js";import{l as ei}from"./ViewingMode-Dodu7ZZk.js";import{a as Gn}from"./capabilities-C84AMSCg.js";import{n as Kn}from"./themeUtils-C3zvZbsE.js";import{e as ti}from"./globalCss-CZa70j6i.js";import{t as Yn}from"./accessibleHandler-CjDcv_he.js";import Jn from"./Compass-S4M9NML1.js";import Xn from"./NavigationToggle-Da_EVApx.js";import{a as Qn}from"./Zoom-OTCbJYcz.js";const ze={widthBreakpoint:{getValue(t){const e=t.viewSize[0],i=t.breakpoints,n=this.values;return e<=i.xsmall?n.xsmall:e<=i.small?n.small:e<=i.medium?n.medium:e<=i.large?n.large:n.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],i=t.breakpoints,n=this.values;return e<=i.xsmall?n.xsmall:e<=i.small?n.small:e<=i.medium?n.medium:e<=i.large?n.large:n.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,i=e[0],n=e[1],s=this.values;return n>=i?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},at={xsmall:544,small:768,medium:992,large:1200};function es(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function rt(t,e){return e?ze[t].valueToClassName[e].split(" "):[]}const qa=t=>{let e=class extends t{constructor(...i){super(...i),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=at}initialize(){this.addHandles(w(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Z))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(i){if(i!==this._get("breakpoints")){if(!es(i)){const n=JSON.stringify(at,null,2);console.warn("provided breakpoints are not valid, using defaults:"+n),i=at}this._set("breakpoints",{...i})}}_updateClassNames(){if(!this.container)return;const i=De.acquire(),n=De.acquire();let s,o=!1;for(s in ze){const a=this[s],r=ze[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});a!==r&&(o=!0,this[s]=r,rt(s,a).forEach(h=>n.push(h)),rt(s,r).forEach(h=>i.push(h)))}o&&(this._applyClassNameChanges(i,n),De.release(i),De.release(n))}_applyClassNameChanges(i,n){const s=this.container;s&&(n.forEach(o=>s.classList.remove(o)),i.forEach(o=>s.classList.add(o)))}_removeActiveClassNames(){const i=this.container;if(!i)return;let n;for(n in ze)rt(n,this[n]).forEach(s=>i.classList.remove(s))}};return l([c()],e.prototype,"breakpoints",null),l([c()],e.prototype,"orientation",void 0),l([c()],e.prototype,"widthBreakpoint",void 0),l([c()],e.prototype,"heightBreakpoint",void 0),e=l([b("esri.views.BreakpointsOwner")],e),e};let J=class extends M{constructor(){super(...arguments),this.items=new x,this._watchUpdatingTracking=new et,this._callbacks=new Map,this._projector=Yt(),this._hiddenProjector=Yt()}get needsRender(){return this.items.length>0}get updating(){var e;return((e=this._watchUpdatingTracking)==null?void 0:e.updating)??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,i=>{for(const n of i.added){const s=()=>n.render();this._callbacks.set(n,s),this._projector.append(this.surface,s)}for(const n of i.removed){const s=this._projector.detach(this._callbacks.get(n));this.surface.removeChild(s.domNode),this._callbacks.delete(n)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const i=this._hiddenSurface,n=this._hiddenProjector;let s;const o=()=>(s=e.render(),s);n.append(i,o),n.renderNow();const a={left:0,top:0,right:0,bottom:0};if(s!=null&&s.domNode){const r=s.domNode.getBoundingClientRect();a.left=r.left,a.top=r.top,a.right=r.right,a.bottom=r.bottom}for(n.detach(o);i.firstChild;)i.removeChild(i.firstChild);return a}overlaps(e,i){const n=this.computeBoundingRect(e),s=this.computeBoundingRect(i);return Math.max(n.left,s.left)<=Math.min(n.right,s.right)&&Math.max(n.top,s.top)<=Math.min(n.bottom,s.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e,i){const n=!!(i!=null&&i.disableDecorations);if(!this.items.some(o=>o.visible&&!(n&&o.isDecoration)))return;const s=e.getContext("2d");s.save(),s.font=this._fontString(),this.items.forEach(o=>{n&&o.isDecoration||(s.save(),o.renderCanvas(s),s.restore())}),s.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};l([c({readOnly:!0})],J.prototype,"surface",void 0),l([c({readOnly:!0})],J.prototype,"items",void 0),l([c({readOnly:!0})],J.prototype,"needsRender",null),l([c({readOnly:!0})],J.prototype,"_watchUpdatingTracking",void 0),l([c({readOnly:!0})],J.prototype,"updating",null),J=l([b("esri.views.overlay.ViewOverlay")],J);const ii=J,lt=[0,0];function ts(t){const e=(t.ownerDocument||window.document).defaultView,i=t.getBoundingClientRect();return lt[0]=i.left+((e==null?void 0:e.pageXOffset)??0),lt[1]=i.top+((e==null?void 0:e.pageYOffset)??0),lt}function ni(t){t&&(Ei(t),t.parentNode&&t.parentNode.removeChild(t))}function is(t){const e=document.createElement("div");return t.appendChild(e),e}const ve=16,Ae=750,ns=512,ss=2,Ua=t=>{let e=class extends t{constructor(...i){super(...i),this._freqInfo={freq:ve,time:Ae},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([w(()=>this.cursor,n=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",n)}),w(()=>this.navigating,n=>{const{surface:s}=this;s&&s.setAttribute("data-navigating",n.toString())})])}initialize(){this.addHandles([w(()=>this.ui,(i,n)=>this._handleUIChange(i,n),Z),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=W(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(i){const n=this._get("container"),s=Si(i);if(s||typeof i!="string"||I.getLogger(this).error("#container",`element with id '${i}' not found`),n===s)return;if(this._stopMeasuring(),n&&(n.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(ni(this.root),this._set("root",null)),this.userContent&&(Jt(this.userContent,n),ni(this.userContent),this._set("userContent",null))),!s)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);s.classList.add("esri-view");const o=document.createElement("div");o.className="esri-view-user-storage",Jt(s,o),s.appendChild(o),this._set("userContent",o);const a=document.createElement("div");a.className="esri-view-root",s.insertBefore(a,s.firstChild),this._set("root",a);const r=document.createElement("div");r.className="esri-view-surface",r.setAttribute("role","application"),r.tabIndex=0,a.appendChild(r),this._set("surface",r);const h=new ii;a.appendChild(h.surface),this._set("overlay",h),this.addHandles(w(()=>h.needsRender,d=>{d&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=yt({render:()=>{var p;return(p=this.overlay)==null?void 0:p.render()}}):this._overlayRenderTaskHandle=ie(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",s),this._startMeasuring()}get focused(){const i=document.activeElement===this.surface;return document.hasFocus()&&i}get size(){return[this.width,this.height]}blur(){var i;(i=this.surface)==null||i.blur()}focus(){var i;(i=this.surface)==null||i.focus()}pageToContainer(i,n,s){const o=this.position;return i-=o?o[0]:0,n-=o?o[1]:0,s?(s[0]=i,s[1]=n):s=[i,n],s}containerToPage(i,n,s){const o=this.position;return i+=o?o[0]:0,n+=o?o[1]:0,s?(s[0]=i,s[1]=n):s=[i,n],s}_handleUIChange(i,n){this.removeHandles("ui"),n&&n!==i&&n.destroy(),i&&(i.view=this,this.addHandles(w(()=>this.root,s=>{i.container=s?is(s):null},Z),"ui")),this._set("ui",i)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const i=this._freqInfo;i.freq=ve,i.time=Ae,this.addHandles([nn(window,"resize",()=>{i.freq=ve,i.time=Ae}),yt({prepare:n=>{const s=this._measure(),o=this._freqInfo;if(o.time+=n.deltaTime,s&&(o.freq=ve,this._get("resizing")||this._set("resizing",!0)),o.time<o.freq)return;o.time=0;const a=this._position();o.freq=a||s?ve:Math.min(Ae,o.freq*ss),!s&&o.freq>=ns&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const i=this.container,n=i?i.clientWidth:0,s=i?i.clientHeight:0;if(n===0||s===0)return this.suspended||this._set("suspended",!0),!1;const o=this.width,a=this.height;return n===o&&s===a?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",n),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:o,oldHeight:a,width:n,height:s}),!0)}_position(){const i=this.container,n=this.position,s=i&&ts(i);return!!s&&(!n||s[0]!==n[0]||s[1]!==n[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return l([c()],e.prototype,"container",null),l([c({readOnly:!0})],e.prototype,"focused",null),l([c({readOnly:!0})],e.prototype,"height",void 0),l([c()],e.prototype,"messagesCommon",void 0),l([c({type:ii})],e.prototype,"overlay",void 0),l([c({readOnly:!0})],e.prototype,"position",void 0),l([c({readOnly:!0})],e.prototype,"resizing",void 0),l([c({readOnly:!0})],e.prototype,"root",void 0),l([c({value:null,readOnly:!0})],e.prototype,"size",null),l([c({readOnly:!0})],e.prototype,"surface",void 0),l([c({readOnly:!0})],e.prototype,"suspended",void 0),l([c()],e.prototype,"ui",void 0),l([c({readOnly:!0})],e.prototype,"userContent",void 0),l([c({readOnly:!0})],e.prototype,"width",void 0),l([c()],e.prototype,"widthBreakpoint",void 0),e=l([b("esri.views.DOMContainer")],e),e};function U(t){return t!=null&&"open"in t&&"declaredClass"in t}function si(t){return t!=null&&"declaredClass"in t&&"dockOptions"in t}const Ba=t=>{let e=class extends t{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([w(()=>[this.ui,this.popup],([i,n],s)=>{const o="popup",a="manual";if(s){const[r,h]=s;r&&U(h)&&(h.view=null,si(h)&&r.remove(h,o))}i&&U(n)&&(n.view=this,si(n)&&i.add(n,{key:o,position:a,internal:!0}))},Z),this.on("click",i=>{this.popup&&this.popupEnabled&&(i.pointerType!=="mouse"||i.button===0)&&(U(this.popup)?this.popup.viewModel.handleViewClick(i):i.async(async()=>{await this.setupPopup(),U(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(i)}))},St.WIDGET)]),bi(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{Ue(()=>import("./Popup-z4L90_L_.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77]))})}destroy(){this.destroyed||this.closePopup()}async openPopup(i){if(U(this.popup))return this.popup.open(i);try{if(await this.setupPopup(),!this.popup)return void I.getLogger(this).error(new L("view:null-popup","Popup is null and can't be opened"));this.popup.open(i)}catch{}}closePopup(){var i;(i=this._popupSetupTask)==null||i.abort(),U(this.popup)&&this.popup.close()}async fetchPopupFeatures(i,n){return await this.when(),this._popupHitsToFeatures(await this._getPopupHits(i,n),n)}async setupPopup(){var i;if((i=this._popupSetupTask)==null||i.abort(),this.popup&&!U(this.popup))return this._popupSetupTask=Tt(async n=>{const{default:s}=await Ue(()=>import("./Popup-z4L90_L_.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77]));if(fe(n),!this.popup||U(this.popup))return;const o=this.popup;delete o.open,delete o.close,this.popup=new s(o)}),this._popupSetupTask.promise}async _popupHitsToFeatures({location:i,hits:n},s){const o=[],a=[];let r=!1;const h=sn(s,$e("popup-view-fetch-timeout")??as),d=u=>{const f=new os(u);return a.push(f),o.push(f.promise),f},p=u=>{const f=a.at(-1);return f&&f.layerView===u&&!r?f:d(u)};for(const u of n)"graphic"in u?(p(u.layerView).graphics.push(u.graphic),r=!1):(o.push(u.layerView.fetchPopupFeaturesAtLocation(u.mapPoint,h)),r=!0);a.map(u=>u.resolve(h));const m=on(o).then(u=>u.filter(f=>!!f).flat());return{pendingFeatures:o,allGraphicsPromise:m,location:i}}async _getPopupHits(i,n){const{hits:s,location:o}=await this.popupHitTest(i);fe(n);const a=[];for(const r of s)if("graphic"in r){if(this._isValidPopupGraphic(r.graphic,n)){const h=this._isValidPopupGraphicsLayerView(r.layerView)?r.layerView:void 0;a.push({graphic:r.graphic,layerView:h})}}else this._isValidPopupLocationLayerView(r.layerView)&&a.push({mapPoint:r.mapPoint,layerView:r.layerView});return{hits:a,location:o}}_isValidPopupGraphic(i,n){return i&&!!i.getEffectivePopupTemplate(n==null?void 0:n.defaultPopupTemplateEnabled)}_isValidPopupGraphicsLayerView(i){return!i||(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesFromGraphics"in i}_isValidPopupLocationLayerView(i){return(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesAtLocation"in i}};return l([c({cast(i){return!i||U(i)||typeof i=="object"&&(i.open=n=>(qt(I.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"}),this.openPopup(n)),i.close=()=>(qt(I.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"}),this.closePopup())),i}})],e.prototype,"popup",void 0),l([c()],e.prototype,"popupEnabled",void 0),e=l([b("esri.views.PopupView")],e),e};let os=class{constructor(e){this.layerView=e,this._resolver=Ye(),this.graphics=[]}get promise(){return this._resolver.promise}resolve(e){const{layerView:i,graphics:n,_resolver:s}=this;if(!i)return s.resolve(n),s.promise;let o;return i.fetchPopupFeaturesFromGraphics(n,e).catch(a=>(o=a,null)).then(a=>{a?s.resolve(a):s.reject(o)}),s.promise}};const as=5e3;let Ke=class extends Hn{constructor(e){super(e),this.addHandles(this.on("before-add",i=>{i.item!=null&&i.item.parent===this.owner&&(I.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),i.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};Ke=l([b("esri.support.AnalysesCollection")],Ke);let X=class extends M{constructor(e){super(e),this.view=null,this.baseLayerViews=new x,this.referenceLayerViews=new x,this._loadingHandle=w(()=>{var i,n;return(n=(i=this.view)==null?void 0:i.map)==null?void 0:n.basemap},i=>{i&&i.load().catch(()=>{})},Z)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){var i,n,s;if((i=this.view)!=null&&i.suspended)return!1;const e=(s=(n=this.view)==null?void 0:n.map)==null?void 0:s.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(o=>o.updating)||this.referenceLayerViews.some(o=>o.updating))}};l([c({constructOnly:!0})],X.prototype,"view",void 0),l([c({readOnly:!0})],X.prototype,"baseLayerViews",void 0),l([c({readOnly:!0})],X.prototype,"referenceLayerViews",void 0),l([c({readOnly:!0})],X.prototype,"suspended",null),l([c({type:Boolean,readOnly:!0})],X.prototype,"updating",null),X=l([b("esri.views.BasemapView")],X);function rs(t){return"tryRecycleWith"in t}function ls(t){return t!=null&&typeof t=="object"&&"layerViews"in t}let hs=class{constructor(e,i,n){this.layer=e,this.view=i,this.layerViewImporter=n,this._controller=new AbortController,this._deferred=Ye(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,nt(this._controller.signal,()=>{const s=new L("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(s)})}tryRecycle(e){if(!this.done||!this.layerView||!rs(this.layerView))return null;const i=this.layer.type,n=this._controller.signal;for(let s=0;s<e.length;s++){const o=e[s];if(o.type!==i)continue;const a=this.layerView.tryRecycleWith(o,{signal:n});if(a){e.splice(s,1),this.layer=o;const r=this.layerView,h=r.view;return this.promise=Promise.race([a.then(()=>(fe(this._controller.signal),o.emit("layerview-destroy",{view:h,layerView:r}),h.emit("layerview-destroy",{view:h,layerView:r}),o.emit("layerview-create",{view:h,layerView:r}),h.emit("layerview-create",{view:h,layerView:r}),r)),new Promise((d,p)=>nt(this._controller.signal,()=>p(Mi())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:i,view:n}=this;i.emit("layerview-destroy",{view:n,layerView:e}),n.emit("layerview-destroy",{layer:i,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){var s,o;if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:i,view:n}=this;this._map=n.map;try{let a,r;if(await i.load({signal:e}),i.prefetchResources&&await i.prefetchResources({signal:e}),ds(i))a=await i.createLayerView(n,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new L("layer:view-not-supported","No layerview implementation was found");const p=await this.layerViewImporter.importLayerView(i);fe(e),a="default"in p?new p.default({layer:i,view:n}):new p({layer:i,view:n})}const h=()=>{r=ie(r),a.destroyed||a.destroy(),a.layer=null,a.parent=null,a.view=null,this.done=!0};r=nt(e,h),fe(e);try{await a.when()}catch(p){throw h(),p}if(!((o=(s=this._map)==null?void 0:s.allLayers)==null?void 0:o.includes(i)))return h(),void this._deferred.reject(new L("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=a,i.emit("layerview-create",{view:n,layerView:a}),n.emit("layerview-create",{layer:i,layerView:a}),this.done=!0,this._deferred.resolve(a)}catch(a){i.emit("layerview-create-error",{view:n,error:a}),n.emit("layerview-create-error",{layer:i,error:a}),this.done=!0,this._deferred.reject(new L("layerview:create-error","layerview creation failed",{layer:i,error:a}))}}},V=class extends M{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new et,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var n;const i=(n=this.view.map)==null?void 0:n.allLayers;if(i)for(const s of i)this.layerViewImporter.hasLayerViewModule(s)&&this.layerViewImporter.importLayerView(s)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=Ye(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(an(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var h,d,p;if(this.destroyed)return;const i=this.view.map;if(this._map!==i&&(this.clear(),this._map=i),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const n=new Set,s=[],o=this.view.ready,a=m=>{if(m!=null){for(const u of m)if(u){n.add(u);const f=this._layerLayerViewInfoMap.get(u);f&&o?f.start():f||this._recyclingInfoMap.has(u)||s.push(u),"layers"in u&&u.layers&&a(u.layers)}}};for(const m of this._rootCollectionNames)a(it(this,m));for(const[m,u]of this._layerLayerViewInfoMap)if(!n.has(m)){this._layerLayerViewInfoMap.delete(u.layer);const f=u.tryRecycle(s);f?(this.notifyChange("updating"),this._recyclingInfoMap.set(u.layer,u),f.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(u.layer),this._layerLayerViewInfoMap.set(u.layer,u),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(u.layer),u.destroy(),this._reschedule()})):u.destroy()}for(const[m,u]of this._recyclingInfoMap)n.has(m)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(u.layer),u.destroy());for(const m of s)this._createLayerView(m);this._refreshCollections();const r=[(h=i==null?void 0:i.ground)==null?void 0:h.layers,(d=i==null?void 0:i.basemap)==null?void 0:d.baseLayers,(p=i==null?void 0:i.basemap)==null?void 0:p.referenceLayers,i==null?void 0:i.layers].filter(m=>!!m);n.forEach(m=>"layers"in m&&r.push(m.layers)),this.addHandles(r.map(m=>this._watchUpdatingTracking.addOnCollectionChange(()=>m,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.addHandles([Je(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),w(()=>{const e=this.view,i=e==null?void 0:e.map;return[i==null?void 0:i.basemap,i==null?void 0:i.ground,i==null?void 0:i.layers,e==null?void 0:e.ready]},()=>this._reschedule(),_t)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),ot(this._recyclingInfoMap),ot(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(Mi()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||$t(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const i of this._layerLayerViewInfoMap.values())i.done||++e;return e}clear(){this.destroyed||(ot(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new L("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}isCreatingLayerViewsForLayer(e,i){var o;this.commitProperty("updatingRemaining");const n=this._layerLayerViewInfoMap.get(e);if(!(n!=null&&n.done))return!0;const s=n.layerView;return!(!s||!i||s.parent===i)||!!(n.done&&s&&"layers"in e&&((o=e.layers)!=null&&o.length))&&e.layers.some(a=>this.isCreatingLayerViewsForLayer(a,s))}_refreshCollections(){for(const[e,i]of this._layersToLayerViews)this._populateLayerViewsOwners(it(this,e),it(this,i),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,i,n){if(!e||!i)return void(i&&i.removeAll());let s=0;for(const o of e){const a=this._layerLayerViewInfoMap.get(o);if(!(a!=null&&a.layerView))continue;const r=a.layerView;r.layer=o,r.parent=n,i.at(s)!==r&&i.splice(s,0,r),"layers"in o&&ls(r)&&this._populateLayerViewsOwners(o.layers,r.layerViews,r),s+=1}s<i.length&&i.splice(s,i.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const i=new hs(e,this.view,this.layerViewImporter);i.promise.then(()=>this._refreshCollections(),n=>{n&&(xi(n)||n.name==="cancelled:layerview-create")||I.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:n}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,i),this.view.ready&&i.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};l([c()],V.prototype,"_workPromise",void 0),l([c({readOnly:!0})],V.prototype,"_watchUpdatingTracking",void 0),l([c({readOnly:!0})],V.prototype,"_layersToLayerViews",null),l([c({readOnly:!0})],V.prototype,"_rootCollectionNames",null),l([c()],V.prototype,"layerViewImporter",void 0),l([c()],V.prototype,"supportsGround",void 0),l([c({readOnly:!0})],V.prototype,"updating",null),l([c({readOnly:!0})],V.prototype,"updatingRemaining",null),l([c({constructOnly:!0})],V.prototype,"view",void 0),V=l([b("esri.views.LayerViewManager")],V);const cs=V;function ds(t){return"createLayerView"in t&&t.createLayerView!=null}let E=class extends M{constructor(e){super(e),this.factor=1.5,this.offset=re(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};l([c({type:Number})],E.prototype,"factor",void 0),l([c({nonNullable:!0})],E.prototype,"offset",void 0),l([c()],E.prototype,"position",void 0),l([c({type:Number,range:{min:0}})],E.prototype,"size",void 0),l([c()],E.prototype,"maskUrl",void 0),l([c()],E.prototype,"maskEnabled",void 0),l([c()],E.prototype,"overlayUrl",void 0),l([c()],E.prototype,"overlayEnabled",void 0),l([c({readOnly:!0})],E.prototype,"version",null),l([c({type:Boolean})],E.prototype,"visible",void 0),E=l([b("esri.views.Magnifier")],E);const Di=E;let K=class extends Ct.EventedAccessor{constructor(e){super(e),this._selectionMap=new Zn,this._sources=new x,this._trashCan=[],this._layerEditHandles=new x,this._vizTaskId=0,this.showHighlight=!0}initialize(){this.addHandles([w(()=>[this.view,this.showHighlight],()=>this._refreshVisualization()),Je(()=>this.sources,"change",i=>{const n=this._selectionMap;for(const s of i.removed)n.delete(s);this._refreshListeners(),this._refreshVisualization()},{onListenerAdd:()=>this._refreshListeners()})]);const e=new x;this.view.when().then(()=>{this.view.map&&(this.view.map.allLayers.flatten(i=>"sublayers"in i&&i.sublayers?i.sublayers:null).forEach(i=>{(Ve(i)&&!rn(i)||se(i))&&e.add(i)}),this.sources=e)})}destroy(){this._layerEditHandles.drain(ie)}get selections(){return Array.from(this._selectionMap.entries()).map(e=>{const[i,n]=e;return{layer:i,selection:[...n.selection]}})}get count(){let e=0;for(const i of this._selectionMap.values())e+=i.selection.length;return e}get hasSelection(){return this.count>0}get sources(){return this._sources}set sources(e){ln(e,this._sources)}async getSelectedFeatures(e,i={},n="layerView"){const{view:s,selections:o}=this,a=(e!==void 0?o.filter(r=>e.includes(r.layer)):o).filter(r=>r.selection.length>0).map(async r=>{const{layer:h,selection:d}=r,p=se(h)?h.parent:h;if(p==null||!ai(p))return null;if(n==="layer")return ri(p,d,i);if(oi(p))return null;const m=await s.whenLayerView(p).catch(()=>null);return m?ri(m,d,i):null});return(await Promise.all(a)).filter(r=>r!=null)}updateSelection(e){const i=new Map;for(const[o,a]of this._selectionMap)i.set(o,[...a.selection]);let n=!1;const s=e.current.concat(e.added);for(const o of s){const a=o.sourceLayer,r=o.getObjectId();if(this.sources.includes(a)&&(Ve(a)||se(a))&&r!==null){const h=hn(i,a,()=>[]);h.includes(r)||(h.push(r),n=!0)}}for(const o of e.removed){const a=o.sourceLayer,r=o.getObjectId();if(this.sources.includes(a)&&(Ve(a)||se(a))&&r!==null){const h=i.get(a),d=h==null?void 0:h.indexOf(r);d!==void 0&&d>=0&&(h==null||h.splice(d,1),n=!0)}}if(n){const{_selectionMap:o,_trashCan:a}=this,r=[];for(const[h,d]of i){const p=o.get(h);p!==void 0&&a.push(p),o.set(h,{selection:d}),r.push({layer:h,selection:d,...jt(p!==void 0?p.selection:[],d)})}this._onSelectionChange(r)}}setSelection(e,i){this._setSelection(e,i)}getSelection(e){const i=this._selectionMap.get(e);return i==null?void 0:i.selection}appendToSelection(e,i){const n=this._selectionMap.get(e),s=n!==void 0?[...n.selection]:[];for(const o of i)s.includes(o)||s.push(o);this._setSelection(e,s)}removeFromSelection(e,i){const n=this._selectionMap.get(e);if(!n)return;const s=[];for(const o of n.selection)i.includes(o)||s.push(o);this._setSelection(e,s)}toggleInSelection(e,i){const n=this._selectionMap.get(e);if(!n||n.selection.length===0)return void this._setSelection(e,i);const s=new Set(n.selection),o=new Set(i),a=cn(s,o);this._setSelection(e,Array.from(a))}clear(){const e=this._selectionMap.values();this._trashCan.push(...e);const i=[];for(const[n,s]of this._selectionMap.entries())i.push({layer:n,added:[],removed:[...s.selection],selection:[]});this._selectionMap.clear(),this._onSelectionChange(i)}_onSelectionChange(e){this._refreshVisualization(),this.emit("selection-change",{view:this.view,changes:e})}_refreshVisualization(){var a;if(this.view==null||this.sources==null)return;for(this._vizTaskId++;this._trashCan.length>0;){const r=this._trashCan.pop();(a=r==null?void 0:r.highlightHandle)==null||a.remove()}const{sources:e,view:i,_selectionMap:n,showHighlight:s}=this,o=this._vizTaskId;for(const r of e){const h=n.get(r),d=se(r)?r.parent:r;if(d!=null&&ai(d)){if(oi(d))continue;i.whenLayerView(d).then(p=>{var m;(m=h==null?void 0:h.highlightHandle)==null||m.remove(),h!=null&&s&&o===this._vizTaskId&&"highlight"in p&&typeof p.highlight=="function"&&h.selection.length>0&&(h.highlightHandle=p.highlight(h.selection,"selection"))}).catch(()=>{var p;(p=h==null?void 0:h.highlightHandle)==null||p.remove()})}}}_refreshListeners(){this._layerEditHandles.drain(ie);for(const e of this.sources){const i=se(e)?e.parent:e;if(i!=null&&Ve(i)){const n=i.on("edits",s=>{this._handleEditChanges(s,e)});this._layerEditHandles.push(n)}}}_handleEditChanges(e,i){if(e.deletedFeatures!==void 0&&e.deletedFeatures.length>0&&this._selectionMap.has(i)){const n=e.deletedFeatures.filter(s=>s.error==null).map(s=>s.objectId).filter(ki);this.removeFromSelection(i,n)}}_setSelection(e,i){if(!this.sources.includes(e))throw new Error(`Cannot set selection on layer ${e.title} because it is not in 'sources'`);const n=this._selectionMap.get(e);if(n===void 0||!us(n,{selection:i})){n!==void 0&&this._trashCan.push(n),this._selectionMap.set(e,{selection:[...i]});const s={layer:e,selection:[...i],...jt(n!==void 0?n.selection:[],i)};this._onSelectionChange([s])}}};l([c({readOnly:!0,nonNullable:!0})],K.prototype,"selections",null),l([c({readOnly:!0,nonNullable:!0})],K.prototype,"count",null),l([c({constructOnly:!0,nonNullable:!0})],K.prototype,"view",void 0),l([c({readOnly:!0,nonNullable:!0})],K.prototype,"hasSelection",null),l([c()],K.prototype,"showHighlight",void 0),l([c()],K.prototype,"sources",null),K=l([b("esri.views.SelectionManager")],K);const oi=t=>{var e;return se(t)?((e=t.parent)==null?void 0:e.isTable)===!0:t.isTable},ps=t=>t.layer!==void 0,ai=t=>(t==null?void 0:t.when)!==void 0,us=(t,e)=>{if(t==null&&e==null)return!0;if(t!=null&&e==null||t==null&&e!=null)return!1;if(t!=null&&e!=null&&t.selection!=null&&e.selection!=null){const i=[...t.selection],n=[...e.selection];if(i.length!==n.length)return!1;i.sort(),n.sort();for(let s=0;s<i.length;s++)if(i[s]!==n[s])return!1}return!0},ri=async(t,e,i={})=>{let n;if(ps(t)){const s=t;n=s===void 0?null:await s.queryFeatures(new Ut({...i,objectIds:e})).then(o=>({data:o,layer:t.layer}))}else{const s=t;n=s===void 0?null:await s.queryFeatures(new Ut({...i,objectIds:e})).then(o=>({data:o,layer:s}))}return n},ms=K;let Me=class extends dn(M){constructor(e){super(e),this.accentColor=new Be([255,127,0]),this.textColor=new Be([255,255,255])}};l([c({type:Be,nonNullable:!0})],Me.prototype,"accentColor",void 0),l([c({type:Be,nonNullable:!0})],Me.prototype,"textColor",void 0),Me=l([b("esri.views.Theme")],Me);const bt=Me,Li=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],Vi={};function Ai(t){return!!Vi[t]}function gs(t){for(const e of t)if(!Ai(e))return!1;return!0}Li.forEach(t=>{Vi[t]=!0});let fs=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:i,priority:n},s)=>{var o;return(o=this.inputManager)==null?void 0:o.installHandlers(s,[i],n)})}disconnect(){this.inputManager&&this._handlers.forEach((e,i)=>{var n;return(n=this.inputManager)==null?void 0:n.uninstallHandlers(i)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,i,n,s){const o=Array.isArray(e)?e:e.split(",");if(!gs(o))return o.some(Ai)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let a,r;Array.isArray(i)?r=i:(a=i,r=[]),typeof n=="function"?a=n:s=n,s=s??St.DEFAULT;const h=this._createUniqueGroupName(),d=new ys(this.view,o,r,a);this._handlers.set(h,{handler:d,priority:s});for(const p of o){const m=this._handlerCounts.get(p)||0;this._handlerCounts.set(p,m+1)}return this.inputManager&&this.inputManager.installHandlers(h,[d],s),Xe(()=>this._removeHandler(h,o))}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,i){if(this._handlers.has(e)){this._handlers.delete(e);for(const n of i){const s=this._handlerCounts.get(n);s===void 0||(s===1?this._handlerCounts.delete(n):this._handlerCounts.set(n,s-1))}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},ys=class extends _e{constructor(e,i,n,s){super(!0),this._latestDragStart=void 0,this.view=e;for(const o of i)switch(o){case"click":this.registerIncoming("click",n,a=>s(ws(e,a)));break;case"double-click":this.registerIncoming("double-click",n,a=>s(bs(e,a)));break;case"immediate-click":this.registerIncoming("immediate-click",n,a=>s(Ms(e,a)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",n,a=>s(xs(e,a)));break;case"hold":this.registerIncoming("hold",n,a=>s(ks(e,a)));break;case"drag":this.registerIncoming("drag",n,a=>{const r=this._wrapDrag(a);r&&s(r)});break;case"key-down":this.registerIncoming("key-down",n,a=>s(Ps(a)));break;case"key-up":this.registerIncoming("key-up",n,a=>s(Ts(a)));break;case"pointer-down":this.registerIncoming("pointer-down",n,a=>s(we(a,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",n,a=>s(we(a,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",n,a=>s(we(a,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",n,a=>s($s(a)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",n,a=>s(Cs(a)));break;case"pointer-enter":this.registerIncoming("pointer-enter",n,a=>s(we(a,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",n,a=>s(we(a,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",n,a=>{s(Ss(a))});break;case"focus":this.registerIncoming("focus",n,a=>{s(_s(a))});break;case"blur":this.registerIncoming("blur",n,a=>{s(vs(a))})}}_wrapDrag(e){const i=e.data,{x:n,y:s}=i.center,{action:o,pointerType:a,button:r}=i;if(o==="start"&&(this._latestDragStart=i),!this._latestDragStart)return;const h=i.pointer.native,d=i.buttons,{cancelable:p,timestamp:m}=e,u={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return o==="end"&&(this._latestDragStart=void 0),{type:"drag",action:o,x:n,y:s,origin:u,pointerType:a,button:r,buttons:d,radius:i.radius,angle:pn(i.angle),native:h,timestamp:m,cancelable:p,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}};function _s(t){return{type:"focus",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function vs(t){return{type:"blur",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function ws(t,e){const{pointerType:i,button:n,buttons:s,x:o,y:a,native:r,eventId:h}=e.data,{cancelable:d,timestamp:p}=e;return{type:"click",pointerType:i,button:n,buttons:s,x:o,y:a,native:r,timestamp:p,screenPoint:re(o,a),mapPoint:Ce(t,o,a),eventId:h,cancelable:d,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}function bs(t,e){const{pointerType:i,button:n,buttons:s,x:o,y:a,native:r,eventId:h}=e.data,{cancelable:d,timestamp:p}=e;return{type:"double-click",pointerType:i,button:n,buttons:s,x:o,y:a,native:r,timestamp:p,mapPoint:Ce(t,o,a),eventId:h,cancelable:d,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}function Ms(t,e){const{pointerType:i,button:n,buttons:s,x:o,y:a,native:r,eventId:h}=e.data,d=r.pointerId,{cancelable:p,timestamp:m}=e;return{type:"immediate-click",pointerId:d,pointerType:i,button:n,buttons:s,x:o,y:a,native:r,timestamp:m,mapPoint:Ce(t,o,a),eventId:h,cancelable:p,stopPropagation:()=>e.stopPropagation(),async:u=>e.async(u),preventDefault:()=>e.preventDefault()}}function xs(t,e){const{pointerType:i,button:n,buttons:s,x:o,y:a,native:r,eventId:h}=e.data,d=r.pointerId,{cancelable:p,timestamp:m}=e;return{type:"immediate-double-click",pointerId:d,pointerType:i,button:n,buttons:s,x:o,y:a,native:r,timestamp:m,mapPoint:Ce(t,o,a),eventId:h,cancelable:p,stopPropagation:()=>e.stopPropagation(),async:u=>e.async(u),preventDefault:()=>e.preventDefault()}}function ks(t,e){const{pointerType:i,button:n,buttons:s,x:o,y:a,native:r}=e.data,{cancelable:h,timestamp:d}=e;return{type:"hold",pointerType:i,button:n,buttons:s,x:o,y:a,native:r,timestamp:d,mapPoint:Ce(t,o,a),cancelable:h,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}function Ce(t,e,i){return t.toMap(re(e,i),{exclude:[]})}function Ps(t){const{key:e,repeat:i,native:n}=t.data,{cancelable:s,timestamp:o}=t;return{type:"key-down",key:e,repeat:i,native:n,timestamp:o,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:a=>t.async(a),preventDefault:()=>t.preventDefault()}}function Ts(t){const{key:e,native:i}=t.data,{cancelable:n,timestamp:s}=t;return{type:"key-up",key:e,native:i,timestamp:s,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:o=>t.async(o),preventDefault:()=>t.preventDefault()}}function we(t,e){const{x:i,y:n,button:s,buttons:o,native:a,eventId:r}=t.data,h=a.pointerId,d=a.pointerType,{cancelable:p,timestamp:m}=t;return{type:e,x:i,y:n,pointerId:h,pointerType:d,button:s,buttons:o,native:a,timestamp:m,eventId:r,cancelable:p,stopPropagation:()=>t.stopPropagation(),async:u=>t.async(u),preventDefault:()=>t.preventDefault()}}function $s(t){const{x:e,y:i,buttons:n,native:s,eventId:o}=t.data.currentEvent,{button:a}=t.data.startEvent,r=t.data.startEvent.native.pointerId,h=t.data.startEvent.native.pointerType,d=t.data.action,p={x:t.data.startEvent.x,y:t.data.startEvent.y},{cancelable:m,timestamp:u}=t;return{type:"pointer-drag",x:e,y:i,pointerId:r,pointerType:h,button:a,buttons:n,action:d,origin:p,native:s,timestamp:u,eventId:o,cancelable:m,stopPropagation:()=>t.stopPropagation(),async:f=>t.async(f),preventDefault:()=>t.preventDefault()}}function Cs(t){const{cancelable:e,data:i,timestamp:n}=t,{x:s,y:o,deltaY:a,native:r}=i;return{type:"mouse-wheel",x:s,y:o,deltaY:a,native:r,timestamp:n,cancelable:e,stopPropagation:()=>t.stopPropagation(),async:h=>t.async(h),preventDefault:()=>t.preventDefault()}}function Ss(t){const{action:e,state:i,device:n}=t.data,{cancelable:s,timestamp:o}=t,{buttons:a,axes:r}=i;return{type:"gamepad",device:n,timestamp:o,action:e,buttons:a,axes:r,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:h=>t.async(h),preventDefault:()=>t.preventDefault()}}function Es(t){return[t.on("before-add",e=>{const i=e.item;if(i==null||t.includes(i))return I.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();i.onAdd()}),t.on("after-remove",e=>{const i=e.item;i.active&&(i.view.activeTool=null),i.destroy()})]}function Mt(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(wt.USER)&&t.getEditableFlag(wt.MANAGER)}let Is=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,i){const n=()=>e.stopPropagation();switch(e.type){case"pointer-move":hi(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(n(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!ci(e))break;const s=j(e),o=ce(s,e.pointerType,i.forEachTool);if(o==null)break;const a=o.manipulator,r=o.tool;a==null||r==null||!a.interactive||a.grabbable&&a.grabbableForEvent(e)||!a.grabbing||a.dragging||this._releaseManipulatorBeforeDragging(a,e,i),a!=null&&r!=null&&a.interactive&&a.grabbable&&a.grabbableForEvent(e)&&!a.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:a,tool:r,start:s,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&i.activeTool==null&&(this._revertToNullActiveTool=!0,i.setActiveTool(o.tool)),a.grabbing=!0,a.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:s}),n());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,i);break;case"pointer-drag":{if(!ci(e))break;const s=this._grabbedManipulators.get(e.pointerId),o=s==null?void 0:s.manipulator,a=s==null?void 0:s.tool;if(o==null||a==null)break;const r=j(e);r.x=Ge(r.x,0,i.view.width),r.y=Ge(r.y,0,i.view.height);const h=s.start,d=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(o.dragging=!0,d?o.events.emit("drag",{action:"update",start:h,screenPoint:r}):o.events.emit("drag",{action:"start",start:h,screenPoint:r,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:a,manipulator:o,start:h}));break;case"end":o.dragging=!1,d&&o.events.emit("drag",{action:"end",start:h,screenPoint:r}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,i)}n();break}case"immediate-click":{const s=j(e),o=ce(s,e.pointerType,i.forEachTool);if(Ds(e)||i.forEachTool(d=>{if((o==null||o.tool!==d||d.automaticManipulatorSelection)&&d.manipulators){let p=!1;d.manipulators.forEach(({manipulator:m})=>{m.selected&&(m.selected=!1,p=!0)}),p&&d.onManipulatorSelectionChanged&&d.onManipulatorSelectionChanged()}}),o==null)break;const{manipulator:a,tool:r}=o;if(!a.interactive)break;a.selectable&&r.automaticManipulatorSelection&&(a.selected=!a.selected,r.onManipulatorSelectionChanged&&r.onManipulatorSelectionChanged());const h=e.native.shiftKey;a.events.emit("immediate-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:h,stopPropagation:n}),ht(a,n);break}case"click":{const s=j(e),o=ce(s,e.pointerType,i.forEachTool),a=o==null?void 0:o.manipulator;if(a==null||!a.interactive)break;const r=e.native.shiftKey;a.events.emit(e.type,{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:r}),n();break}case"double-click":{const s=j(e),o=ce(s,e.pointerType,i.forEachTool),a=o!=null?o.manipulator:null;if(a==null||!a.interactive)break;const r=e.native.shiftKey;a.events.emit("double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:r,stopPropagation:n}),ht(a,n);break}case"immediate-double-click":{const s=j(e),o=ce(s,e.pointerType,i.forEachTool),a=o!=null?o.manipulator:null;if(a==null||!a.interactive)break;const r=e.native.shiftKey;a.events.emit("immediate-double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:r,stopPropagation:n}),ht(a,n);break}}this._onFocusChange(i.forEachTool)}_releaseManipulatorBeforeDragging(e,i,n){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:j(i)}),this._grabbedManipulators.forEach(({manipulator:s},o)=>{s===e&&this._grabbedManipulators.delete(o)}),this._afterManipulatorRelease(n.setActiveTool)}_handlePointerEnd(e,i){var s;const n=(s=this._grabbedManipulators.get(e.pointerId))==null?void 0:s.manipulator;n!=null&&n.grabbing&&(n.grabbing=!1,n.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:j(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorRelease(i.setActiveTool))}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=li(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=li(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const i=new Set,n=new Set;this._grabbedManipulators.forEach(({tool:s})=>{i.add(s)}),this._hoveredManipulators.forEach(({tool:s})=>{n.add(s)}),e(s=>{s.hasGrabbedManipulators=i.has(s),s.hasHoveredManipulators=n.has(s);const o=this._grabbedManipulators.values(),a=un(o,({tool:r})=>r===s);s.firstGrabbedManipulator=a!=null?a.manipulator:null})}clearPointers(e,{forEachTool:i,setActiveTool:n},s=!0,o){const a=(r,h)=>r===e&&(o==null||o===h);this._grabbedManipulators.forEach(({tool:r,manipulator:h,pointerType:d},p)=>{a(r,h)&&(this._grabbedManipulators.delete(p),h.grabbing=!1,h.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:d}))}),this._draggedManipulators.forEach(({tool:r,manipulator:h},d)=>{a(r,h)&&(this._draggedManipulators.delete(d),h.dragging=!1,h.events.emit("drag",{action:"cancel"}))}),s&&this._hoveredManipulators.forEach(({tool:r,manipulator:h},d)=>{a(r,h)&&(this._hoveredManipulators.delete(d),h.hovering=!1)}),this._afterManipulatorRelease(n),this._onFocusChange(i)}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((i,n)=>{this._updateHoveredStateForPointerAtScreenPosition(re(i.x,i.y),n,i.pointerType,e)})}handleHoverEvent(e,i){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!hi(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(j(e),e.pointerId,e.pointerType,i)}_updateHoveredStateForPointerAtScreenPosition(e,i,n,s){var r;let o=ce(e,n,s);const a=(r=this._hoveredManipulators.get(i))==null?void 0:r.manipulator;o==null||o.manipulator.interactive||(o=null),o!=null&&a===o.manipulator||(a!=null&&(a.hovering=!1),o!=null?(o.manipulator.hovering=!0,this._hoveredManipulators.set(i,o)):this._hoveredManipulators.delete(i),this._onFocusChange(s))}_afterManipulatorRelease(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function li(t){let e=null;return $t(t,({manipulator:i})=>!(i==null||!i.interactive)&&(i.grabbing&&i.grabCursor?(e=i.grabCursor,!0):!!i.cursor&&(e=i.cursor,!0))),e}function ce(t,e,i){let n=null;return i(s=>{if(s.manipulators==null||!Mt(s))return!1;const o=s.manipulators.intersect(t,e);return o!=null&&(n={tool:s,manipulator:o},!0)}),n}function hi(t){return t==="mouse"}function ci(t){return t.pointerType!=="mouse"||t.button===0}function Ds(t){return!!t.native.shiftKey}function ht(t,e){t!=null&&t.consumesClicks&&e()}const di="attached",ct="tools",Ls=1e3;let N=class extends M{constructor(e){super(e),this._updatingHandles=new et,this._clock=Qe,this._manipulatorState=new Is,this.tools=new x,this.cursor=null,this._interacting=!1,this._interactingTimeout=Ls,this._interactingTimeoutHandle=null,this._forEachTool=i=>{for(const n of this.tools.items)if(i(n))return}}initialize(){this.addHandles([this.view.on(Li,e=>{this._handleInputEvent(e)},St.TOOL),...Es(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.activeTool=null,this.tools.drain(e=>e.destroy()),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void I.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const i=this.activeTool;this._set("activeTool",e),i!=null&&i.deactivate(),e!=null&&e.activate(),this._removeIncompleteTools(e);for(const n of this.tools){this._updateToolEditableFlag(n);const s=Mt(n);this.activeTool!=null&&s||this._manipulatorState.clearPointers(n,this._manipulatorStateEventArgs,!s)}this._updateCursor()}get updating(){return this._updatingHandles.updating||this.tools.some(e=>e.updating)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=ie(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout(()=>this._interacting=!1,this._interactingTimeout)}attach(){var e;this.view.type==="3d"?this.addHandles([w(()=>{const{state:i}=this.view;return"camera"in i&&i.camera},()=>this._forEachManipulator(i=>i.onViewChange())),(e=this.view.elevationProvider)==null?void 0:e.on("elevation-change",i=>this._forEachManipulator(n=>n.onElevationChange(i)))],di):this.addHandles(w(()=>this.view.extent,()=>this._forEachManipulator(i=>i.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(di),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(i=>{i.manipulators&&i.manipulators.forEach(({manipulator:n})=>e(n,i))})}_handleInputEvent(e){let i=!1;const n={...e,stopPropagation:()=>{i=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(n):this._forEachTool(s=>{!i&&s.visible&&s.handleInputEvent(n)}),!i&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(n,this._manipulatorStateEventArgs),i||this.activeTool==null||this.activeTool.handleInputEventAfter(n),this._manipulatorState.handleHoverEvent(n,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles(ct),this._forEachTool(e=>{if(e instanceof M){const i=w(()=>[e.cursor,e.visible,e.editable],()=>{Mt(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.addHandles(i,ct)}e.manipulators&&this.addHandles([e.manipulators.on("after-remove",i=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,i.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],ct)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){var i;(i=e.setEditableFlag)==null||i.call(e,wt.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(i=>!(i.cursor==null||!i.visible)&&(e=i.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(i=>(e==null||i!==e)&&!i.created&&i.removeIncompleteOnCancel).forEach(i=>{this.tools.remove(i)})}get test(){}};l([c({constructOnly:!0,nonNullable:!0})],N.prototype,"view",void 0),l([c({value:null})],N.prototype,"activeTool",null),l([c({readOnly:!0,type:x})],N.prototype,"tools",void 0),l([c({readOnly:!0})],N.prototype,"cursor",void 0),l([c({readOnly:!0})],N.prototype,"updating",null),l([c()],N.prototype,"_interacting",void 0),l([c({readOnly:!0})],N.prototype,"interacting",null),N=l([b("esri.views.ToolViewManager")],N);let me=class extends M{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":Vs.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return As[this.deviceType]}};l([c({nonNullable:!0,readOnly:!0})],me.prototype,"nativeIndex",void 0),l([c({type:String,readOnly:!0})],me.prototype,"deviceType",null),l([c({type:Number,readOnly:!0})],me.prototype,"axisThreshold",null),me=l([b("esri.views.input.gamepad.GamepadInputDevice")],me);const Et=me,Vs=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),As={standard:.15,spacemouse:.025,unknown:0};let xe=class extends M{constructor(...e){super(...e),this.devices=new x,this.enabledFocusMode="document"}};l([c({type:x.ofType(Et),readOnly:!0})],xe.prototype,"devices",void 0),l([c({type:["document","view","none"]})],xe.prototype,"enabledFocusMode",void 0),xe=l([b("esri.views.input.gamepad.GamepadSettings")],xe);const Rs=xe;let Ne=class extends M{constructor(){super(...arguments),this.gamepad=new Rs}};l([c({readOnly:!0})],Ne.prototype,"gamepad",void 0),Ne=l([b("esri.views.input.Input")],Ne);const Fs=Ne;let Q=class extends M{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};l([c({type:Boolean,nonNullable:!0})],Q.prototype,"enabled",void 0),l([c({type:Et})],Q.prototype,"device",void 0),l([c({type:["pan","zoom"],nonNullable:!0})],Q.prototype,"mode",void 0),l([c({type:["forward-down","forward-up"],nonNullable:!0})],Q.prototype,"tiltDirection",void 0),l([c({type:Number,nonNullable:!0})],Q.prototype,"velocityFactor",void 0),Q=l([b("esri.views.navigation.gamepad.GamepadSettings")],Q);const Ri=Q;let oe=class extends M{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new Ri,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}get effectiveMomentumEnabled(){return this.momentumEnabled&&!jn()}};l([c({type:Boolean})],oe.prototype,"browserTouchPanEnabled",void 0),l([c({type:Ri,nonNullable:!0})],oe.prototype,"gamepad",void 0),l([c({type:Boolean})],oe.prototype,"momentumEnabled",void 0),l([c({type:Boolean})],oe.prototype,"mouseWheelZoomEnabled",void 0),oe=l([b("esri.views.navigation.Navigation")],oe);const Fi=oe;let xt,dt=null;async function Os(t){dt||(dt=Ue(()=>import("./geometryServiceUtils-zF1xOQ4Y.js"),__vite__mapDeps([78,1,2,79,33,37])).then(e=>xt=e)),await dt,fe(t)}async function Oi(t,e,i,n){if(!t)return null;const s=t.spatialReference;return mn()||gn(s,e)?fn(t,e):xt?xt.projectGeometry(t,e,i,n):(await Promise.race([Os(n),yn(n)]),Oi(t,e,i,n))}let _=class extends M{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=vt(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference??this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var n,s,o,a;const e=(n=this.map)==null?void 0:n.call(this),i=[];return this.priorityCollection!=null&&i.push(this.priorityCollection),i.push({parent:e==null?void 0:e.basemap,layers:(s=e==null?void 0:e.basemap)==null?void 0:s.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(o=e==null?void 0:e.ground)==null?void 0:o.layers},{parent:e==null?void 0:e.basemap,layers:(a=e==null?void 0:e.basemap)==null?void 0:a.referenceLayers}),i}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:i}=this._allLayers;let n=null;for(const o of e){const a=this._getSupportedSpatialReferences(o);if(a.length>0){const r=this._narrowDownSpatialReferenceCandidates(n,a);r!=null&&(n=r)}if(n!=null&&n.length===1)break}if(i&&(n==null||n.length!==1))return{updating:!0};const s=this._pickSpatialReferenceCandidate(n);return{spatialReference:(s==null?void 0:s.spatialReference)??null,viewingMode:(s==null?void 0:s.viewingMode)??null,updating:!1}}get _tileInfoTask(){var n,s,o,a,r,h,d;if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:i}=this._collectLayers([{parent:(s=(n=this.map)==null?void 0:n.call(this))==null?void 0:s.basemap,layers:(r=(a=(o=this.map)==null?void 0:o.call(this))==null?void 0:a.basemap)==null?void 0:r.baseLayers},{layers:(d=(h=this.map)==null?void 0:h.call(this))==null?void 0:d.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const p=e[0].tileInfo;return{tileInfo:p!=null&&p.spatialReference.equals(this.spatialReference)?p:null,updating:!1}}return{updating:i}}get _heightModelInfoTask(){var n,s,o;if(!this.required.heightModelInfo||this.suspended&&((n=this._get("_heightModelInfoTask"))!=null&&n.heightModelInfo))return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:i}=this._allLayers;for(const a of e)if(Un(a)){const r=Bn(a);if(r)return{heightModelInfo:r,vcsWkid:(s=a.spatialReference)==null?void 0:s.vcsWkid,latestVcsWkid:(o=a.spatialReference)==null?void 0:o.latestVcsWkid,updating:!1}}return{updating:i}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,i=e.updating,n=[];for(const s of e.layers){const o="fullExtents"in s&&s.fullExtents||(s.fullExtent!=null?[s.fullExtent]:[]),a=this.requiresExtentInSpatialReference?null:o[0],r=o.find(h=>h.spatialReference.equals(this.spatialReference))??a;if(r)return{candidates:[{extent:r,layer:s}],updating:!1};if(this._getSupportedSpatialReferences(s).length>0)for(const h of o)n.push({extent:h,layer:s})}return{candidates:n,updating:i}}get _extentTask(){const{candidates:e,updating:i}=this._extentCandidatesTask;if(i)return{updating:i};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const n=this._pickExtentCandidate(e),s=this.spatialReference;return n.extent.equals(this._projectExtentTask.input)&&s.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=vt(this._projectExtentTask.task)),this._projectExtentTask={input:n.extent.clone(),output:null,spatialReference:s.clone(),task:Tt(async o=>{try{const a=await Oi(n.extent,s,"portalItem"in n.layer?n.layer.portalItem:void 0,o);this._projectExtentTask={...this._projectExtentTask,task:null,output:a}}catch{if(_n(o))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,i){if(e==null)return i;const n=new Array;for(const s of e)for(const o of i){if(!s.spatialReference.equals(o.spatialReference))continue;const a=Ns(s.viewingMode,o.viewingMode);if(a!==!1){n.push({spatialReference:s.spatialReference,viewingMode:a});break}}return n.length>0?n:null}_pickSpatialReferenceCandidate(e){const i=this.defaultSpatialReference;return e==null||e.length<1?i?{spatialReference:i,viewingMode:null}:null:(i!=null&&e.length>1&&e.some(({spatialReference:n})=>n.equals(i))&&(e=e.filter(({spatialReference:n})=>n.equals(i))),e.length>1&&e.some(({viewingMode:n})=>n!==ei.Local)&&(e=e.filter(({viewingMode:n})=>n!==ei.Local)),e[0])}_getSupportedSpatialReferences(e){const i="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(i.length===0)return[];const n=[];for(const s of i){const o=this.getSpatialReferenceSupport(s,e);if(o!=null){const a=o.constraints??[{spatialReference:s,viewingMode:null}];for(const{spatialReference:r,viewingMode:h}of a)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!r.equals(this.userSpatialReference)||n.push({spatialReference:r,viewingMode:h})}}return n}_pickExtentCandidate(e){const i=this.spatialReference;return e.find(({extent:n})=>i.equals(n.spatialReference))||e[0]}_collectLayers(e){var n;if(this._loadMaybe((n=this.map)==null?void 0:n.call(this))!=="loaded")return{layers:[],updating:!0};const i=new zs;for(const s of e)if(this._collectCollection(s,i),i.preloading===this.sourcePreloadCount)break;return{layers:i.layers,updating:i.updating}}_collectCollection(e,i){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return i.updating=!0,void++i.preloading;case"failed":return}for(const n of e.layers){switch(this._loadMaybe(n)){case"failed":continue;case"loading":i.updating=!0,++i.preloading;break;case"loaded":i.updating||i.layers.push(n),"layers"in n&&this._collectCollection({layers:n.layers},i)}if(i.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(i=>{xi(i)||console.log(i)}),"loading"):e.loadStatus:"loaded"}};l([c()],_.prototype,"required",void 0),l([c({constructOnly:!0})],_.prototype,"map",void 0),l([c({constructOnly:!0})],_.prototype,"getSpatialReferenceSupport",void 0),l([c()],_.prototype,"defaultSpatialReference",void 0),l([c()],_.prototype,"userSpatialReference",void 0),l([c()],_.prototype,"sourcePreloadCount",void 0),l([c()],_.prototype,"priorityCollection",void 0),l([c()],_.prototype,"requiresExtentInSpatialReference",void 0),l([c()],_.prototype,"suspended",void 0),l([c({readOnly:!0})],_.prototype,"ready",null),l([c({readOnly:!0})],_.prototype,"heightModelInfoReady",null),l([c({readOnly:!0})],_.prototype,"spatialReference",null),l([c({readOnly:!0})],_.prototype,"extent",null),l([c({readOnly:!0})],_.prototype,"heightModelInfo",null),l([c({readOnly:!0})],_.prototype,"vcsWkid",null),l([c({readOnly:!0})],_.prototype,"latestVcsWkid",null),l([c({readOnly:!0})],_.prototype,"viewingMode",null),l([c({readOnly:!0})],_.prototype,"tileInfo",null),l([c({readOnly:!0})],_.prototype,"mapCollections",null),l([c({readOnly:!0})],_.prototype,"_allLayers",null),l([c({readOnly:!0})],_.prototype,"_spatialReferenceTask",null),l([c({readOnly:!0})],_.prototype,"_tileInfoTask",null),l([c({readOnly:!0})],_.prototype,"_heightModelInfoTask",null),l([c({readOnly:!0})],_.prototype,"_extentCandidatesTask",null),l([c()],_.prototype,"_extentTask",null),l([c()],_.prototype,"_projectExtentTask",void 0),_=l([b("esri.views.support.DefaultsFromMap")],_);let zs=class{constructor(){this.layers=new Array,this.preloading=-1,this.updating=!1}};function Ns(t,e){return t!=null?e!=null?t===e&&t:t:e}var ke;let g=ke=class extends Ct.EventedMixin(vn(M)){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.handles=new wn,this.updatingHandles=new et,this.allLayerViews=new Nn({getCollections:()=>{var e,i,n;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,(i=this.groundView)==null?void 0:i.layerViews,this.layerViews,(n=this.basemapView)==null?void 0:n.referenceLayerViews]},getChildrenFunction:Hs}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new Ii,this.analyses=new Ke,this.typeSpecificPreconditionsReady=!0,this.layerViews=new x,this.magnifier=new Di,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new Fs,this.navigation=new Fi,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new fs(this),this.persistableViewModels=new x,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this.theme=null,this.handles.add(w(()=>this.preconditionsReady,e=>{var n,s;const i=this.ready;if(e?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,ke.views.add(this)):(this._lockedSpatialReference=null,ke.views.remove(this)),this.notifyChange("spatialReference"),!e&&i)(n=this.toolViewManager)==null||n.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),(s=this.layerViewManager)==null||s.clear(),this._teardown();else if(e&&!i){try{this._startup()}catch(o){return void queueMicrotask(()=>{this.fatalError=new L("startup-error",null,o)})}this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach()}},Bt))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this.validate()]).then(()=>(this._isValid=!0,bi(()=>this.ready)))),this.basemapView=new X({view:this}),this.layerViewManager=new cs({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new N({view:this}),this._setupSpatialReferenceLogger(),this.selectionManager=new ms({view:this}),this.addHandles([w(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},_t),w(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},Bt),w(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},_t)])}_setupSpatialReferenceLogger(){let t=null;this.addHandles([w(()=>{var e;return(e=this.defaultsFromMap)==null?void 0:e.ready},e=>{var n;const i=((n=this.map)==null?void 0:n.allLayers.length)>0;if(e&&!this.spatialReference&&i){if(t!=null)return;const s=Xe(()=>t=vt(t));t=Tt(async o=>{try{await bn(this.spatialReferenceWarningDelay,null,o)}catch{return}finally{t=null}I.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.addHandles(s,"spatial-reference-logger-task")}else this.removeHandles("spatial-reference-logger-task")},{sync:!0})])}destroy(){var t,e;this.destroyed||(ke.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=W(this.graphics),this.analyses=W(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),W(this.analysisViewManager),this.toolViewManager=W(this.toolViewManager),this.layerViewManager=W(this.layerViewManager),this.selectionManager=W(this.selectionManager),this.basemapView=W(this.basemapView),(t=this.groundView)==null||t.destroy(),(e=this.layerViews)==null||e.forEach(i=>i.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.destroy(),this.map=W(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return I.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var t;return(t=this.toolViewManager)==null?void 0:t.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new _({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:(t,e)=>this.getSpatialReferenceSupport(t,e),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var t;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||Gt.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!((t=this.defaultsFromMap)!=null&&t.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t!=null&&t.destroyed&&(I.getLogger(this).warn("#map","The provided map is already destroyed",{map:t}),t=null),Gt.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",t))}get spatialReference(){var e,i;const t=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;if(t&&((i=(e=this.defaultsFromMap)==null?void 0:e.required)!=null&&i.heightModelInfo)){const n=t.clone();return n.vcsWkid=this.defaultsFromMap.vcsWkid,n.latestVcsWkid=this.defaultsFromMap.latestVcsWkid,n}return t}set spatialReference(t){const e=!Mn(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??Kt}set timeZone(t){const e=new Set(["etc/utc","etc/gmt","gmt"]),i=new Set(Intl.supportedValuesOf("timeZone").map(n=>n.toLowerCase()));this._userTimeZone=t,t===Kt||t===xn||e.has(t.toLowerCase())||i.has(t.toLowerCase())||I.getLogger(this).warn("#timeZone",`the parsed value '${t}' may not be a valid IANA time zone`)}get tools(){var t;return(t=this.toolViewManager)==null?void 0:t.tools}get initialExtent(){var t;return(t=this.defaultsFromMap)==null?void 0:t.extent}get cursor(){var t;return((t=this.toolViewManager)==null?void 0:t.cursor)??this._cursor??"default"}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new bt}whenLayerView(t){var e;return((e=this.layerViewManager)==null?void 0:e.whenLayerView(t))??Promise.reject()}getDefaultSpatialReference(){var t;return(t=this.defaultsFromMap)==null?void 0:t.spatialReference}getDefaultHeightModelInfo(){var t;return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??((t=this.defaultsFromMap)==null?void 0:t.heightModelInfo)??null}getDefaultTimeZone(){return null}importLayerView(t){throw new L("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}async loadAsyncDependencies(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return this.getSpatialReferenceSupport(t)!=null}when(t,e){return this.isResolved()&&!this.ready&&I.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(Pi(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};g.views=new x,l([c()],g.prototype,"_userSpatialReference",void 0),l([c()],g.prototype,"activeTool",null),l([c({readOnly:!0})],g.prototype,"allLayerViews",void 0),l([c()],g.prototype,"groundView",void 0),l([c()],g.prototype,"animation",null),l([c()],g.prototype,"basemapView",void 0),l([c()],g.prototype,"center",null),l([c({readOnly:!0})],g.prototype,"_defaultsFromMapSettings",null),l([c()],g.prototype,"defaultsFromMap",null),l([c()],g.prototype,"fatalError",void 0),l([c({type:Ti})],g.prototype,"extent",null),l([c(Qt(Ii,"graphics"))],g.prototype,"graphics",void 0),l([c(Qt(Ke,"analyses"))],g.prototype,"analyses",void 0),l([c({readOnly:!0,type:Wn})],g.prototype,"heightModelInfo",null),l([c({readOnly:!0})],g.prototype,"interacting",null),l([c({readOnly:!0})],g.prototype,"navigating",null),l([c({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],g.prototype,"preconditionsReady",null),l([c({readOnly:!0})],g.prototype,"typeSpecificPreconditionsReady",void 0),l([c({type:x,readOnly:!0})],g.prototype,"layerViews",void 0),l([c()],g.prototype,"resolution",null),l([c({type:Di})],g.prototype,"magnifier",void 0),l([c({value:null,type:zn})],g.prototype,"map",null),l([c()],g.prototype,"padding",void 0),l([c({readOnly:!0})],g.prototype,"ready",void 0),l([c({type:$i})],g.prototype,"spatialReference",null),l([c()],g.prototype,"spatialReferenceWarningDelay",void 0),l([c()],g.prototype,"stationary",null),l([c({readOnly:!0})],g.prototype,"supportsGround",void 0),l([c({type:kn})],g.prototype,"timeExtent",void 0),l([c({type:String,nonNullable:!0})],g.prototype,"timeZone",null),l([c()],g.prototype,"tools",null),l([c()],g.prototype,"toolViewManager",void 0),l([c({readOnly:!0})],g.prototype,"type",void 0),l([c({type:Number})],g.prototype,"scale",void 0),l([c({readOnly:!0})],g.prototype,"updating",void 0),l([c({readOnly:!0})],g.prototype,"initialExtentRequired",void 0),l([c({readOnly:!0})],g.prototype,"initialExtent",null),l([c()],g.prototype,"cursor",null),l([c({readOnly:!0})],g.prototype,"input",void 0),l([c({type:Fi,nonNullable:!0})],g.prototype,"navigation",void 0),l([c()],g.prototype,"layerViewManager",void 0),l([c()],g.prototype,"analysisViewManager",void 0),l([c()],g.prototype,"selectionManager",void 0),l([c()],g.prototype,"width",void 0),l([c()],g.prototype,"height",void 0),l([c({readOnly:!0})],g.prototype,"resizing",void 0),l([c({value:null,readOnly:!0})],g.prototype,"size",null),l([c({readOnly:!0})],g.prototype,"suspended",void 0),l([c({readOnly:!0})],g.prototype,"viewEvents",void 0),l([c({readOnly:!0})],g.prototype,"persistableViewModels",void 0),l([c()],g.prototype,"_isValid",void 0),l([c()],g.prototype,"_readyCycleForced",void 0),l([c()],g.prototype,"_lockedSpatialReference",void 0),l([c()],g.prototype,"_userTimeZone",void 0),l([c()],g.prototype,"_lockedTimeZone",void 0),l([c({type:bt})],g.prototype,"theme",void 0),l([c({readOnly:!0,type:bt})],g.prototype,"effectiveTheme",null),g=ke=l([b("esri.views.View")],g);const ur=g;function Hs(t){return t.layerViews}let ee=class extends Pn{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=Ye(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._resolver)==null||e.reject(new L("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._resolver)==null||e.resolve())}update(e,i){i||(i=Tn(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",i)}};l([c({readOnly:!0})],ee.prototype,"done",null),l([c({readOnly:!0,type:String})],ee.prototype,"state",void 0),l([c()],ee.prototype,"target",void 0),ee=l([b("esri.views.ViewAnimation")],ee),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(ee||(ee={}));const gr=ee;function Ws(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function Zs(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function qs(t,e,i,n,s,o,a,r,h){const d=new Float32Array(9);return d[0]=t,d[1]=e,d[2]=i,d[3]=n,d[4]=s,d[5]=o,d[6]=a,d[7]=r,d[8]=h,d}function js(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:Zs,create:Ws,createView:js,fromValues:qs},Symbol.toStringTag,{value:"Module"}));const Us=t=>t,tt=t=>t*t,It=t=>1-tt(1-t),Bs=t=>t<.5?tt(2*t)/2:(It(2*(t-.5))+1)/2,Dt=t=>t*t*t,zi=t=>1-Dt(1-t),Gs=t=>t<.5?Dt(2*t)/2:(zi(2*(t-.5))+1)/2,Lt=t=>t*t*t*t,Ni=t=>1-Lt(1-t),Ks=t=>t<.5?Lt(2*t)/2:(Ni(2*(t-.5))+1)/2,Vt=t=>t*t*t*t*t,Hi=t=>1-Vt(1-t),Ys=t=>t<.5?Vt(2*t)/2:(Hi(2*(t-.5))+1)/2,At=t=>1-Math.cos(t*Math.PI/2),Wi=t=>1-At(1-t),Js=t=>t<.5?At(2*t)/2:(Wi(2*(t-.5))+1)/2,Rt=t=>2**(10*(t-1)),Ft=t=>1-Rt(1-t),Xs=t=>t<.5?Rt(2*t)/2:(Ft(2*(t-.5))+1)/2,Ot=t=>-(Math.sqrt(1-t*t)-1),Zi=t=>1-Ot(1-t),Qs=t=>t<.5?Ot(2*t)/2:(Zi(2*(t-.5))+1)/2;function A(t){const e=2*(t-Math.sqrt((t-1)*t)),i=e/2/t;return n=>n<i?t*n*n:e*n-e+1}function R(t,e){return(i,n)=>i<e?e*t(i/e,n):1-t((1-i)/(1-e),n)*(1-e)}const eo=R(A(1),1),to=R(A(1),0),kt=R(A(1),.5),io=R(A(2),1),no=R(A(2),0),so=R(A(2),.5),oo=R(A(3),1),ao=R(A(3),0),ro=R(A(3),.5),lo=R(A(4),1),ho=R(A(4),0),co=R(A(4),.5),fr={linear:Us,"in-quad":tt,"out-quad":It,"in-out-quad":Bs,"in-coast-quad":eo,"out-coast-quad":to,"in-out-coast-quad":kt,"in-cubic":Dt,"out-cubic":zi,"in-out-cubic":Gs,"in-coast-cubic":io,"out-coast-cubic":no,"in-out-coast-cubic":so,"in-quart":Lt,"out-quart":Ni,"in-out-quart":Ks,"in-coast-quart":oo,"out-coast-quart":ao,"in-out-coast-quart":ro,"in-quint":Vt,"out-quint":Hi,"in-out-quint":Ys,"in-coast-quint":lo,"out-coast-quint":ho,"in-out-coast-quint":co,"in-sine":At,"out-sine":Wi,"in-out-sine":Js,"in-expo":Rt,"out-expo":Ft,"in-out-expo":Xs,"in-circ":Ot,"out-circ":Zi,"in-out-circ":Qs};let po=class{constructor(){this.pan=0,this.rotate=0,this.fov=0,this.sourceZoom=0,this.targetZoom=0}};const Te={desiredScreenFlow:2,minDuration:te(500),maxDuration:te(8e3)},_r={...Te,maxDuration:te(4e3)};let uo=class qi{constructor(e){this._createCamera=e,this.compared=new po,this.segmentStart=0,this.segmentEnd=1,this.settings={desiredScreenFlow:Te.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new qi(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,i,n){this.source!==e&&this.source.copyFrom(e),this.target!==i&&this.target.copyFrom(i),this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=n.desiredScreenFlow!=null?n.desiredScreenFlow:Te.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const i=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>st()}get hasFov(){return Math.abs(this.compared.fov)>st()}get hasRotate(){return this.compared.rotate>st()}},mo=class{constructor(){this.pan=0,this.rotate=0,this.zoom=0,this.fov=0,this.zoomOffset=0}},go=class{constructor(){this.segments=new Array}get time(){return this.segments.reduce((e,i)=>Y(e+i.time),Y(0))}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),e*=this.time;let n=0,s=0;const o=this.definition,a=this.segments.reduce((r,h)=>r||h.definition.hasZoom,!1);for(let r=0;r<this.segments.length;r++){const h=this.segments[r],d=h.definition;if(e<=h.time||r===this.segments.length-1){if(this.segmentInterpolateComponentsAt(h,h.time===0?0:e/h.time,i),o.hasPan&&!isNaN(i.pan)&&isFinite(o.compared.pan)?i.pan=(n+d.compared.pan*i.pan)/o.compared.pan:i.pan=1,o.hasRotate&&!isNaN(i.rotate)&&isFinite(o.compared.rotate)?i.rotate=(s+d.compared.rotate*i.rotate)/o.compared.rotate:i.rotate=1,a&&!isNaN(i.zoom)&&isFinite(d.compared.targetZoom)){const{sourceZoom:p,targetZoom:m}=d.compared,u=i.zoom*(m-p)+p,f=this.segments[0].definition.compared.sourceZoom,O=this.segments[this.segments.length-1].definition.compared.targetZoom,C=Math.abs(m-f)>Math.abs(p-f)?m:p;i.zoomOffset=C-O,i.zoom=(u-f)/(C-f)}else i.zoom=1;return i}e-=h.time,n+=d.compared.pan,s+=d.compared.rotate}}segmentInterpolateComponentsAt(e,i,n){e.interpolateComponentsAt(i,n)}},pt=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,i=e.compared,n=i.sourceZoom,s=i.targetZoom;this._zoomSign=n>s?1:-1,this._panPixelsAtSource=i.pan*e.source.pixelsPerPanAtZoom(n);const o=(e.source.pixelsPerRotateAtZoom(n)+e.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=i.rotate*o}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:n,hasPan:s,hasRotate:o}=this.definition;let a=0,r=0;n&&(s&&(a=(i/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),o&&(r=this._zoomSign*(Math.log(e/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const h=this.definition.desiredPixelFlow;if(n&&s&&o){const d=a+r+a*r;this._zoomPixelFlow=a*r/d*h,this._panPixelFlow=r/d*h,this._rotatePixelFlow=a/d*h}else if(n&&s){const d=1+a;this._zoomPixelFlow=a/d*h,this._panPixelFlow=1/d*h}else if(n&&o){const d=1+r;this._zoomPixelFlow=r/d*h,this._rotatePixelFlow=1/d*h}else if(s&&o){const d=this._panPixelsAtSource/this._rotatePixels,p=1+d;this._panPixelFlow=d/p*h,this._rotatePixelFlow=1/p*h}else s?this._panPixelFlow=h:n?this._zoomPixelFlow=h:o&&(this._rotatePixelFlow=h);this._time=this.rotateTime??this.zoomTime??this.panTime??this.fovTime??Y(0)}get rotateTime(){return this.definition.hasRotate?Y(this._rotatePixels/this._rotatePixelFlow):null}get zoomTime(){return this.definition.hasZoom?Y(this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow):null}get fovTime(){return this.definition.hasFov?Y(Math.abs(this.definition.compared.fov)/fo):null}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=e*this._panPixelsAtSource;return Y(Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow))}return Y(this._panPixelsAtSource/this._panPixelFlow)}}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const i=this.definition.compared.sourceZoom,n=this.definition.compared.targetZoom;return(i*(i/n)**-e-i)/(n-i)}return e}_interpolateComponentsFov(e){if(e===0)return this.definition.segmentStart;if(e===1)return this.definition.segmentEnd;if(this.definition.hasFov){const{segmentStart:i,segmentEnd:n}=this.definition;return i+e*(n-i)}return this.definition.segmentStart}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*e*this._time)-1))/(i*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),i.zoom=this._interpolateComponentsZoom(e),i.pan=this._interpolateComponentsPan(e),i.rotate=this._interpolateComponentsRotate(e),i.zoomOffset=0,i.fov=this._interpolateComponentsFov(e)}};const fo=$n(90);function yo(t,e,i){const n=e-t.compared.sourceZoom,s=t.halfWindowPanAtZoom(n);return-t.halfWindowSize*(i.ascensionFactor*Math.LN2*t.compared.pan+s)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*s)}function _o(t,e,i){const n=1/e,s=Math.log(t.compared.sourceZoom*n),o=1/t.desiredPixelFlow,a=1/Math.LN2,r=e-t.compared.sourceZoom,h=1/r,d=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(r))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*n*o*a*h*d-t.halfWindowSize*s*o*a*h+t.halfWindowSize*s*o*a*d/(r*r)}function vo(t,e,i){const n=e-t.compared.sourceZoom,s=1/n,o=1/e,a=Math.log(t.compared.sourceZoom*o),r=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(n))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*o*r+2*s*a+2*o-2*a*r/(n*n)-r/(e*e))/(t.desiredPixelFlow*Math.LN2)}function wo(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function bo(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function Mo(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function xo(t,e,i){return-t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function ko(t,e,i){return t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function Po(t,e,i){return-2*t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function To(t,e,i){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function $o(t,e,i){const n=Math.log(e/t.compared.targetZoom),s=1/t.desiredPixelFlow,o=1/Math.LN2,a=-e+t.compared.targetZoom,r=1/a,h=(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*n*s*o*r+t.halfWindowSize*n*s*o*h/(a*a)+t.halfWindowSize*s*o*r*h/e}function Co(t,e,i){const n=e-t.compared.targetZoom,s=1/n,o=1/e,a=Math.log(e/t.compared.targetZoom),r=(t.halfWindowPanAtZoom(e)+i.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*o*r-2*s*a+2*o+2*a*r/(n*n)-r/(e*e))/(t.desiredPixelFlow*Math.LN2)}function So(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function Eo(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function Io(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function Do(t){const e=t.compared.sourceZoom-t.compared.targetZoom;if(e===0)return t.compared.pan*t.halfWindowSize/(t.desiredPixelFlow*t.halfWindowPanAtZoom(t.compared.sourceZoom));const i=Math.LN2*t.compared.pan,n=e,s=t.halfWindowPanAtZoom(n),o=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*s);return t.compared.sourceZoom<=t.compared.targetZoom?o*(i-s):o*(i+s)}function Lo(t,e){let i=Vo(t,e);const n={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},s=n.ascensionFactor===0,o=n.descensionFactor===0,a=s?wo:yo,r=s?bo:_o,h=s?Mo:vo,d=o?So:To,p=o?Eo:$o,m=o?Io:Co,u=y=>a(t,y,n)+xo(t,y,n)+d(t,y,n),f=y=>r(t,y,n)+ko(t,y,n)+p(t,y,n),O=y=>h(t,y,n)+Po(t,y,n)+m(t,y,n);let C=u(i);const ne=Do(t);let k;const z=e.maximumIterations||20,v=e.maximumDistance!=null?e.maximumDistance:1/0;for(k=0;k<z;k++){const y=e.desiredSlope??1e-6;let P=f(i);Math.abs(P)>y&&(P+=y);const S=P/O(i);if(isNaN(S)||i>=v&&S<0){if(!isFinite(v))return null;i=v,C=u(i);break}if(i-=S,i<t.compared.sourceZoom||i<t.compared.targetZoom)return null;const q=u(i);if(Math.abs(q-C)/C<=.005)break;C=q}return C>ne*(1-.3)||i<t.compared.sourceZoom||i<t.compared.targetZoom?null:i}function Vo(t,e){const i=Math.max(t.compared.sourceZoom,t.compared.targetZoom),n=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return n<i?e.maximumDistance!=null?i+(e.maximumDistance-i)/2:1.5*i:e.maximumDistance?Math.min(e.maximumDistance,n):n}let Ao=class extends go{constructor(e,i){super(),this._preallocSegments=[new pt,new pt,new pt],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,i)}update(e,i){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();const n=i!=null&&i.apex?Lo(e,i.apex):null;this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,n?this._updateWithApex(n,i==null?void 0:i.apex):this._updateWithoutApex()}segmentInterpolateComponentsAt(e,i,n){e.interpolateComponentsAt(i,n),e===this._ascensionSegment?n.zoom=It(n.zoom):e===this._descensionSegment&&(n.zoom=tt(n.zoom))}_updateWithApex(e,i){const[n,s,o]=this._preallocSegments,a=(i==null?void 0:i.ascensionFactor)??.5,r=Math.min(1-a,(i==null?void 0:i.ascensionFactor)!=null&&i.descensionFactor!=null?i.descensionFactor:.5),h=1-a-r;n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.targetZoom=e,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.definition.segmentEnd=a,n.update(),this._ascensionSegment=n,this.segments.push(n),h>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=e,s.definition.compared.targetZoom=e,s.definition.compared.pan=this.definition.compared.pan*h,s.definition.compared.rotate=this.definition.compared.rotate*h,s.definition.segmentStart=n.definition.segmentEnd,s.definition.segmentEnd=n.definition.segmentEnd+h,s.update(),this.segments.push(s)),o.definition?o.definition.copyFrom(this.definition):o.definition=this.definition.clone(),o.definition.compared.sourceZoom=e,o.definition.compared.pan=this.definition.compared.pan*r,o.definition.compared.rotate=this.definition.compared.rotate*r,o.definition.segmentStart=a+h,o.update(),this._descensionSegment=o,this.segments.push(o)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const Ro=new mo;let xr=class{get time(){return this._time}get isLinear(){return this.path.segments.length===1}constructor(e){this._time=te(0),this._easing=kt,this.definition=new uo(e),this.path=new Ao}update(e,i,n){this.definition.update(e,i,n),this.path.update(this.definition,n),this._time=this._applyTimeSettings(Cn(isFinite(this.path.time)?this.path.time:Y(0)),n),this._easing=n.easing??(this._time>=1e3?kt:Ft)}cameraAt(e,i){e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const n=this.path.interpolateComponentsAt(e,Ro);i.interpolate(this.definition.source,this.definition.target,n)}_normalizedEasing(e){const i=this._easing(0,this._time),n=this._easing(1,this._time);return(this._easing(e,this._time)-i)/(n-i)}_applyTimeSettings(e,i){const n=i.speedFactor!=null?i.speedFactor:1,s=i.minDuration??Te.minDuration/n,o=i.maxDuration??Te.maxDuration/n;return e=i.duration!=null?i.duration:te(Math.min(Math.max(e/n,s),o))}};function Pr(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function Tr(t,e){if(t.pointerType==="touch")return!1;switch(e){case"primary":return t.button===0;case"secondary":return t.button===2;case"tertiary":return t.button===1}}let $r=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const i=e.data,n=i.pointers.size;switch(i.action){case"start":this._currentCount=n,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=n,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=n,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){var i,n;this._startEvent=e,(n=(i=this._callbacks).condition)!=null&&n.call(i,this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){var i,n;(n=(i=this._callbacks).condition)!=null&&n.call(i,this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){var i,n;(n=(i=this._callbacks).condition)!=null&&n.call(i,this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}};function F(t){let e=t*t;return t<0&&(e*=-1),e}function Sr(t){return t.translation[0]=0,t.translation[1]=0,t.translation[2]=0,t.heading=0,t.tilt=0,t}function Er(t,e,i){const n=i,s=t.state,o=t.device,a=e.tiltDirection==="forward-down"?1:-1,r=1;return o.deviceType==="standard"?(n.translation[0]=F(s.axes[0]),n.translation[1]=F(s.axes[1]),n.translation[2]=F(s.buttons[7])-F(s.buttons[6]),n.heading=F(s.axes[2]),n.tilt=F(s.axes[3])):o.deviceType==="spacemouse"&&(n.translation[0]=1.2*F(s.axes[0]),n.translation[1]=1.2*F(s.axes[1]),n.translation[2]=2*-F(s.axes[2]),n.heading=1.2*F(s.axes[5]),n.tilt=1.2*F(s.axes[3])),n.tilt*=a,Sn(n.translation,n.translation,r),n}function Ir(t,e){const i=e;return i.translation[0]=t[1]-t[0],i.translation[1]=t[3]-t[2],i.translation[2]=t[4]-t[5],i.heading=t[7]-t[6],i.tilt=t[8]-t[9],i.zoom=t[10]-t[11],i}function Dr(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}function Lr(t){const e=()=>t(document.visibilityState==="visible");return document.addEventListener("visibilitychange",e),Xe(()=>document.removeEventListener("visibilitychange",e))}function pi(t){const e=t.native;return e?{buttons:e.buttons.map(i=>i.pressed?i.value||1:0),axes:e.axes.map(i=>zo(i,t.axisThreshold))}:{buttons:[],axes:[]}}function Fo(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let i=0;i<t.axes.length;i++)if(t.axes[i]!==e.axes[i])return!1;for(let i=0;i<t.buttons.length;i++)if(t.buttons[i]!==e.buttons[i])return!1;return!0}function Oo(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function zo(t,e){const i=Math.abs(t);return i<e?0:Math.sign(t)*(i-e)/(1-e)}let No=class{constructor(e,i){this._element=e,this._input=i,this._hasEventListeners=!1,this._onConnectGamepad=o=>{this._connectGamepad(o.gamepad)},this._onDisconnectGamepad=o=>{const a=o.gamepad,r=a.index,h=this._inputDevices[r];h&&(this._emitGamepadEvent(a,pi(h),!1),this._inputDevices.splice(r,1),this._latestUpdate.splice(r,1),this._input.gamepad.devices.remove(h),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const n="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=n&&s,this.supported&&(ui(o=>this._connectGamepad(o)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const i=new Et(e);i.deviceType!=="unknown"&&(this._inputDevices[e.index]=i,this._input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=yt({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),i=this._element.contains(document.activeElement),n=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!i;ui(s=>{const o=this._inputDevices[s.index];if(!o)return;const a=this._latestUpdate[s.index],r=pi(o),h=n||Oo(r);a&&(a.timestamp===s.timestamp||!a.active&&h||Fo(a.state,r))||this._emitGamepadEvent(s,r,!h)})}_emitGamepadEvent(e,i,n){const s=this._latestUpdate[e.index],o=s&&s.active;if(!o&&!n)return;const a=!o&&n?"start":o&&n?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:i,active:n},this._callback&&this._callback({device:this._inputDevices[e.index],state:i,action:a})}};function Ho(t){if(!t||!t.connected)return!1;for(let e=0;e<t.axes.length;e++)if(isNaN(t.axes[e]))return!1;return!0}function ui(t){const e=window.navigator.getGamepads();for(let i=0;i<e.length;i++){const n=e[i];Ho(n)&&t(n)}}const mi=$e("edge"),Wo=$e("chrome"),Zo=$e("ff"),qo=$e("safari"),gi="esri-view-surface",de={touchNone:`${gi}--touch-none`,touchPan:`${gi}--touch-pan`};let jo=class ji{constructor(e,i){this._input=i,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new No(e,this._input),this._gamepadSource.onEvent=n=>this._callback("gamepad",n)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=W(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const i in this._active)if(!e||!e.has(i)){const n=this._active[i];this._element.removeEventListener(ut[i],n),delete this._active[i]}e&&e.forEach(i=>{if(!this._active[i]&&ut[i]){const n=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener(ut[i],n),this._active[i]=n}}),this._gamepadSource.hasEventListeners=(e==null?void 0:e.has("gamepad"))??!1}setPointerCapture(e,i){i?this._setPointerCatpureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?de.touchNone:de.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?de.touchPan:de.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(de.touchNone),this._element.classList.remove(de.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,i){const n=qn(this._element,e);return ji.test.disableSubpixelCoordinates&&(n.x=Math.round(n.x),n.y=Math.round(n.y)),i.x=n.x,i.y=n.y,i}_handleKey(e,i){const{key:n}=i;n&&e==="key-up"&&this._keyDownState.delete(n);const s={native:i,key:n,repeat:!!n&&this._keyDownState.has(n)};n&&e==="key-down"&&this._keyDownState.add(s.key),this._callback(e,s)}_handlePointer(e,i){const n=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(e,n)}_handlePointerPreventDefault(e,i){const n=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(e,n)}_handleMouseWheel(e,i){let n=i.deltaY;switch(i.deltaMode){case 0:mi&&(n=n/document.documentElement.clientHeight*600);break;case 1:n*=30;break;case 2:n*=900}mi?n*=.7:Wo||qo?n*=.6:Zo&&(n*=1.375);const s=100,o=Math.abs(n);o>s&&(n=n/o*200/(1+Math.exp(-.02*(o-s))));const a=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:n});this._callback(e,a)}_handlePointerCaptureLost(e,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(e,i)}_handleDefault(e,i){const n={native:i};i.preventDefault(),this._callback(e,n)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};jo.test={disableSubpixelCoordinates:!1};const ut={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let Ar=class extends _e{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};const D={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};function Pt(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function Uo(t,e){const i=e.x-t.x,n=e.y-t.y;return Math.sqrt(i*i+n*n)}function Bo(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:re()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[v,y]=t,[P,S]=[y.x-v.x,y.y-v.y];return e.radius=Math.sqrt(P*P+S*S)/2,e.center.x=(v.x+y.x)/2,e.center.y=(v.y+y.y)/2,e}let i=0,n=0;for(let v=0;v<t.length;v++)i+=t[v].x,n+=t[v].y;i/=t.length,n/=t.length;const s=t.map(v=>v.x-i),o=t.map(v=>v.y-n);let a=0,r=0,h=0,d=0,p=0,m=0,u=0;for(let v=0;v<s.length;v++){const y=s[v],P=o[v],S=y*y,q=P*P;a+=S,r+=q,h+=y*P,d+=S*y,p+=q*P,m+=y*q,u+=P*S}const f=.5*(d+m),O=.5*(p+u),C=a*r-h*h,ne=(f*r-O*h)/C,k=(a*O-h*f)/C,z=re(ne+i,k+n);return{radius:Math.sqrt(ne*ne+k*k+(a+r)/t.length),center:z}}function Pe(t){const{native:e}=t,{pointerId:i,button:n,pointerType:s}=e;return s==="mouse"?`${i}:${n}`:`${s}`}let Fr=class extends _e{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,i,n,s){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:i.buttons,timestamp:s,pointers:Go(this._activePointerMap),pointer:i,angle:n.angle,radius:n.radius,center:n.center}}_addPointer(e){const i=e.native.pointerId,n=Re(this._activePointerMap).angle,s={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(i,s);const o=He(s,Ui(this._activePointerMap));s.initialAngle=o,s.lastAngle=o,this._updatePointerAngles(n)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const i=e.native.pointerId,n=this._activePointerMap.get(i);n?n.event=e:this._addPointer(e)}_removePointer(e){const i=Re(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(i)}_updatePointerAngles(e){const i=Re(this._activePointerMap);this._activePointerMap.forEach(n=>{n.initialAngle=He(n,i)-e,n.lastAngle=He(n,i)-e})}_emitEvent(e,i,n){const s=Re(this._activePointerMap);this._drag.emit(this._createPayload(e,i,s,n),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const i=e.data.native.pointerId,n=te(e.timestamp);this._activePointerMap.get(i)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,n),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",e.data,te(e.timestamp))))}_handlePointerDrag(e){const i=e.data,n=i.currentEvent,s=te(e.timestamp);switch(i.action){case"start":case"update":this._isDragging?this._activePointerMap.has(n.native.pointerId)?(this._updatePointer(n),!this._isCurrentDragSuppressed&&this._emitEvent("update",n,s)):(this._addPointer(n),this._emitEvent("added",n,s),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(n),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",n,s))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function Ui(t){const e=[];return t.forEach(i=>{e.push(re(i.event.x,i.event.y))}),Bo(e)}function Re(t){const e=Ui(t);let i=0;return t.forEach(n=>{let s=He(n,e),o=s-n.lastAngle;for(;o>Math.PI;)o-=2*Math.PI;for(;o<-Math.PI;)o+=2*Math.PI;s=n.lastAngle+o,n.lastAngle=s;const a=s-n.initialAngle;i+=a}),i/=t.size||1,{angle:i,radius:e.radius,center:e.center}}function Go(t){const e=new Map;return t.forEach((i,n)=>e.set(n,i.event)),e}function He(t,e){const i=t.event,n=i.x-e.center.x,s=i.y-e.center.y;return Math.atan2(s,n)}var fi;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(fi||(fi={}));let zr=class extends _e{constructor(e=D.maximumDoubleClickDelay,i=D.maximumDoubleClickDistance,n=D.maximumDoubleTouchDelay,s=D.maximumDoubleTouchDistance,o=Qe){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=n,this._maximumDoubleTouchDistance=s,this._clock=o,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const i=e.data,n=Pe(i);if(!this._pointerState.has(n)){const s={downButton:i.native.button,x:i.x,y:i.y,immediateDoubleClick:null};this._pointerState.set(n,s),this.startCapturingPointer(i.native)}}_handlePointerUp(e){const i=e.data,n=Pe(i),s=this._pointerState.get(n);if(s&&s.downButton===i.native.button){const o=s.immediateDoubleClick,a=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;o?(o.timeoutHandle.remove(),Pt(o,e.data)>a?this._startImmediateDoubleClick(e,s):(this._immediateDoubleClick.emit(e.data,void 0,o.modifiers),this._removeState(i))):Pt(s,e.data)>a?this._removeState(i):this._startImmediateDoubleClick(e,s)}}_startImmediateDoubleClick(e,i){const n=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;i.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),n)}}_removeState(e){const i=Pe(e);this._pointerState.delete(i),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}},Hr=class extends _e{constructor(e=D.maximumClickDelay,i=D.movementUntilMouseDrag,n=D.movementUntilPenDrag,s=D.movementUntilTouchDrag,o=D.holdDelay,a=Qe){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=i,this._movementUntilPenDrag=n,this._movementUntilTouchDrag=s,this._holdDelay=o,this._clock=a,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",r=>{this._handlePointerLoss(r,"pointer-up")}),this.registerIncoming("pointer-capture-lost",r=>{this._handlePointerLoss(r,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",r=>{this._handlePointerLoss(r,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=ie(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const i=e.data,n=i.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const a=this._pointerState.get(n);if(a){if(!a.isDragging){const r=a.previousEvent;this._pointerHold.emit(r,void 0,e.modifiers),a.holdEmitted=!0}a.holdTimeout=null}},this._holdDelay));const o={startEvent:i,previousEvent:i,startTimestamp:e.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(n,o),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_handlePointerMove(e){const i=e.data,n=i.native.pointerId,s=this._pointerState.get(n);s&&(s.isDragging?this._pointerDrag.emit(Fe("update",s,i),void 0,s.modifiers):Uo(i,s.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(e),s.previousEvent=i)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const i=e.data,n=i.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=e.modifiers,s.isDragging=!0,n===s.startEvent.native.pointerId?this._pointerDrag.emit(Fe("start",s,i)):this._pointerDrag.emit(Fe("start",s,s.previousEvent),e.timestamp))})}_handlePointerLoss(e,i){const n=e.data,s=n.native.pointerId,o=this._pointerState.get(s);o&&(o.holdTimeout!=null&&(o.holdTimeout.remove(),o.holdTimeout=null),o.isDragging?this._pointerDrag.emit(Fe("end",o,i==="pointer-up"?n:o.previousEvent),void 0,o.modifiers):i==="pointer-up"&&o.downButton===n.native.button&&e.timestamp-o.startTimestamp<=this._maximumClickDelay&&!o.holdEmitted&&this._immediateClick.emit(n),this._pointerState.delete(s),this.stopCapturingPointer(n.native),this._pointerState.size===0&&this._moveHandle.pause())}};function Fe(t,e,i){return{action:t,startEvent:e.startEvent,previousEvent:e.previousEvent,currentEvent:i}}let Zr=class extends _e{constructor(e=D.maximumDoubleClickDelay,i=D.maximumDoubleClickDistance,n=D.maximumDoubleTouchDelay,s=D.maximumDoubleTouchDistance,o=Qe){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=n,this._maximumDoubleTouchDistance=s,this._clock=o,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=ie(e.doubleClickTimer))}get hasPendingInputs(){return $t(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,i){const n=this._pointerState.get(e);n&&(n.doubleClickTimer=ie(n.doubleClickTimer),i&&this._click.emit(n.event.data,void 0,n.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const i=this._pointerState.get(e);i.pointerDownCount===1&&this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_handleImmediateClick(e){const i=e.data,{pointerType:n}=i.native,s=Ko(i);if(!this._pointerState.has(s))return void this._startClick(e);const o=this._pointerState.get(s),{data:a,modifiers:r}=o.event,h=n==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;Pt(a,i)>h?(this._clearDoubleClickTimer(s,!0),this._startClick(e)):(this._clearDoubleClickTimer(s,!1),o.pointerDownCount===2&&this._doubleClick.emit(a,void 0,r))}_handlePointerDown(e){const i=Pe(e.data),n=this._pointerState.get(i);n&&(n.pointerDownCount+=1)}_startClick(e){const{data:i}=e,{native:{pointerType:n}}=i,s=Pe(i),o=n==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,a=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(s),o);this._pointerState.set(s,{event:e,doubleClickTimer:a,pointerDownCount:1}),this.refreshHasPendingInputs()}};function Ko(t){const{pointerId:e,pointerType:i,button:n}=t.native;return i==="mouse"?`${e}:${n}`:`${i}`}const yi=2048,Yo=1.5,Jo=8;function Xo(t,e){const{format:i,quality:n,rotation:s,disableDecorations:o}=t||{},a=zt(t,e.padding),r=ia(t,{width:e.width-a.left-a.right,height:e.height-a.top-a.bottom}),{width:h,height:d}=ta(t,r),p=Ki(i),m=Yi[p];return{format:p,quality:Ge(n??m,0,100),area:r,width:h,height:d,rotation:s,disableDecorations:!!o,ignoreBackground:!!(t!=null&&t.ignoreBackground),ignorePadding:!!(t!=null&&t.ignorePadding)}}function jr(t,e){const i=Xo(t,e),n=i.area,s=i.width/n.width,o=zt(i,e.padding),a=o.left+o.right,r=o.top+o.bottom,h=e.width-a,d=e.height-r,p=Math.floor(h*s+a),m=Math.floor(d*s+r),u=(t==null?void 0:t.layers)??[],f=i.ignoreBackground,O=i.ignorePadding;return{framebufferWidth:p,framebufferHeight:m,region:{x:Math.floor(n.x*s)+o.left,y:Math.floor(n.y*s)+o.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:s,layers:u,disableDecorations:i.disableDecorations,ignoreBackground:f,ignorePadding:O,objectAndLayerIdColor:!1}}function Ur(t,e,i){const{ctx:n,canvas:s}=Bi(t,i),o=n.getImageData(0,0,t.width,t.height),a=ea(s,e);return Gi(s),{dataUrl:a,data:o}}function Br(t,e){const{ctx:i,canvas:n}=Bi(t,e),s=i.getImageData(0,0,t.width,t.height);return Gi(n),s}function Bi(t,e){const i=Qo();e.premultipliedAlpha&&aa(t),i.width=t.width,i.height=t.height;const n=i.getContext("2d",{willReadFrequently:!0});return n.putImageData(t,0,0),e.flipY&&oa(n),{ctx:n,canvas:i}}function Gi(t){t.width=0,t.height=0}function Qo(){return mt==null&&(mt=document.createElement("canvas")),mt}let mt=null;function ea(t,e){const i=ra[e.format],n=e.quality/100;return t.toDataURL(i,n)}function Gr(t,e){const i=Ki(t),n=Yi[i];return{format:i,quality:Ge(e??n,0,100)}}function Kr(t,e){return e/Math.max(t[0],t[1])}function Yr(t,e,i,n=0,s=0,o=t.width-n,a=t.height-s,r=!1){const{data:h}=t,{width:d,height:p,data:m}=e,u=o/d,f=a/p,O=Math.ceil(u/2),C=Math.ceil(f/2),ne=t.width;for(let k=0;k<p;k++)for(let z=0;z<d;z++){const v=4*(z+(r?p-k-1:k)*d);let y=0,P=0,S=0,q=0,Nt=0,Ht=0;const Qi=(k+.5)*f;for(let Se=Math.floor(k*f);Se<(k+1)*f;Se++){const Wt=Math.abs(Qi-(Se+.5))/C,en=(z+.5)*u,tn=Wt*Wt;for(let Ee=Math.floor(z*u);Ee<(z+1)*u;Ee++){const Zt=Math.abs(en-(Ee+.5))/O,le=Math.sqrt(tn+Zt*Zt);if(le>=1)continue;let he=2*le*le*le-3*le*le+1;const Ie=4*(n+Ee+(s+Se)*ne);Ht+=he*h[Ie+3],P+=he,S+=he*h[Ie],q+=he*h[Ie+1],Nt+=he*h[Ie+2],y+=he}}m[v]=S/y,m[v+1]=q/y,m[v+2]=Nt/y,m[v+3]=Ht/P}return e}function Jr(t,e,i){if(!e)return t;const{framebufferWidth:n,framebufferHeight:s,pixelRatio:o,region:a}=t,r=zt(t,i),h=r.left+r.right,d=r.top+r.bottom,p=n-h,m=s-d,u=Math.min(Jo,Math.min((yi-h)/p,(yi-d)/m));return u<Yo?t:{...t,framebufferWidth:Math.round(p*u)+h,framebufferHeight:Math.round(m*u)+d,pixelRatio:o*u,resample:{region:{x:Math.round((a.x-r.left)*u)+r.left,y:Math.round((a.y-r.top)*u)+r.top,width:Math.round(a.width*u),height:Math.round(a.height*u)},width:n,height:s}}}function ta(t,e){if(!t)return e;const i=t.width,n=t.height;if(i!=null&&n!=null)return{width:Math.floor(i),height:Math.floor(n)};if(i==null&&n==null)return e;const s=e.width/e.height;return n==null?{width:Math.floor(i),height:Math.floor(i/s)}:{width:Math.floor(n*s),height:Math.floor(n)}}function ia(t,e){const i={x:0,y:0,width:e.width,height:e.height};if(t!=null&&t.area){t.area.x!=null&&(i.x=Math.floor(t.area.x)),t.area.y!=null&&(i.y=Math.floor(t.area.y));const n=t.area.width!=null?Math.floor(t.area.width):null,s=t.area.height!=null?Math.floor(t.area.height):null;if(i.width=e.width-i.x,i.height=e.height-i.y,n!=null&&s!=null)i.width=Math.min(i.width,n),i.height=Math.min(i.height,s);else if(n==null&&s!=null){const o=Math.min(i.width,n);i.height=o/i.width*i.height,i.width=o}else if(n!=null&&s==null){const o=Math.min(i.height,s);i.width=o/i.height*i.width,i.height=o}}return na(sa(i,t),e)}function na(t,e){const i=Math.floor(Math.max(t.x,0)),n=Math.floor(Math.max(t.y,0)),s={x:i,y:n,width:Math.floor(Math.min(t.width,e.width-i)),height:Math.floor(Math.min(t.height,e.height-n))},o=s.width/s.height,a=t.width/t.height;if(a===o)return s;if(a>o){const d=Math.floor(s.width/a),p=s.height-d;return{x:s.x,y:Math.floor(s.y+p/2),width:s.width,height:d}}const r=Math.floor(s.height*a),h=s.width-r;return{x:Math.floor(s.x+h/2),y:s.y,width:r,height:s.height}}function sa(t,e){if((e==null?void 0:e.width)==null||e.height==null)return t;const i=e.width/e.height,n=t.width/t.height;if(n===i)return t;if(n<i){const o=Math.floor(t.height*i);return t.x-=(o-t.width)/2,t.width=o,t}const s=Math.floor(t.width/i);return t.y-=(s-t.height)/2,t.height=s,t}function zt(t,e){return!e||t!=null&&t.ignorePadding?ha:e}function Ki(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return la}}function oa(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function aa(t){const e=t.data,i=e.length;for(let n=0;n<i;n+=4){const s=e[n+3];if(s!==255&&s>0){const o=255/s;e[n]=e[n]*o,e[n+1]=e[n+1]*o,e[n+2]=e[n+2]*o}}}const ra={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},_i=98,la="png",Yi={png:100,jpg:_i,jpeg:_i},ha={top:0,right:0,bottom:0,left:0};function Xr(t){const e=Gn();return e.available?t==="3d"&&e.majorPerformanceCaveat?new L("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):e.supportsHighPrecisionFragment?e.supportsVertexShaderSamplers?null:new L("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new L("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new L("webgl:required","WebGL2 is required but not supported.",new Error().stack)}function ca(t){return t&&"nodeType"in t}function da(t){return t&&typeof t.render=="function"}const vi={component:"esri-component"};let ae=class extends M{constructor(){super(...arguments),this.widget=null}destroy(){var t;this.node=null,(t=this.widget)==null||t.destroy()}get id(){var t,e;return this._get("id")??((t=this.widget)==null?void 0:t.id)??((e=this.node)==null?void 0:e.id)}set id(t){this._set("id",t)}set node(t){const e=this._get("node");t!==e&&(t&&t.classList.add(vi.component),e&&e.classList.remove(vi.component),this._set("node",t))}castNode(t){var e;return(e=this.widget)==null||e.destroy(),t?typeof t=="string"||ca(t)?(this._set("widget",null),Si(t)):(da(t)&&!t.domNode&&(t.domNode=document.createElement("div")),this._set("widget",t),t.domNode):(this._set("widget",null),null)}};l([c()],ae.prototype,"id",null),l([c()],ae.prototype,"node",null),l([Ci("node")],ae.prototype,"castNode",null),l([c({readOnly:!0})],ae.prototype,"widget",void 0),ae=l([b("esri.views.ui.Component")],ae);const We=ae,pa={left:0,top:0,bottom:0,right:0},Ji={bottom:30,top:15,right:15,left:15},B="esri-ui",$={ui:B,corner:`${B}-corner`,innerContainer:`${B}-inner-container`,manualContainer:`${B}-manual-container`,cornerContainer:`${B}-corner-container`,topLeft:`${B}-top-left`,topRight:`${B}-top-right`,bottomLeft:`${B}-bottom-left`,bottomRight:`${B}-bottom-right`};function ua(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function Oe(t){return t===0?"0":`${t}px`}function gt(t){const e=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(e===null||e===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function ft(t,{top:e,bottom:i,left:n,right:s}){t.style.top=e,t.style.bottom=i,t.style.left=n,t.style.right=s}let H=class extends Ct.EventedAccessor{constructor(t){super(t),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._removeWidgetHandleKey=Symbol("componentOnRemoveSymbol"),this._locale=En(),this.view=null,this._applyViewPadding=()=>{const e=this.container;e&&ft(e,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const e=this._innerContainer;e&&ft(e,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([w(()=>{var t;return[(t=this.view)==null?void 0:t.padding,this.container]},this._applyViewPadding,Z),w(()=>this.padding,this._applyUIPadding,Z),w(()=>[this.container,this._locale],([t,e])=>{t&&t.setAttribute("lang",e)},Z),In(t=>{this._locale=t})])}destroy(){this.container=null;for(const t of this._components)t.destroy();this._components.length=0,this._componentMap.clear()}set container(t){const e=this._get("container");t!==e&&(t&&(t.classList.add($.ui),Kn(t),this._attachContainers(t)),e&&(e.classList.remove($.ui),ft(e,{top:"",bottom:"",left:"",right:""}),Ei(e)),this._set("container",t))}get height(){var s;const t=((s=this.view)==null?void 0:s.height)??0;if(t===0)return t;const e=this._getViewPadding(),{top:i,bottom:n}=e;return Math.max(t-i-n,0)}get padding(){return this._get("padding")}set padding(t){this._overrideIfSome("padding",t)}castPadding(t){return typeof t=="number"?{bottom:t,top:t,right:t,left:t}:{...Ji,...t}}get width(){var s;const t=((s=this.view)==null?void 0:s.width)??0;if(t===0)return t;const e=this._getViewPadding(),{left:i,right:n}=e;return Math.max(t-i-n,0)}add(t,e){let i,n,s;if(Array.isArray(t))return void t.forEach(a=>this.add(a,e));const o=gt(t);o&&({index:i,position:e,component:t,key:n}=o),e&&typeof e=="object"&&({index:i,key:n,position:e,internal:s}=e),!t||e&&!this._isValidPosition(e)||this._add(t,e,i,n,s)}remove(t,e){var n,s;if(!t)return;if(Array.isArray(t))return t.map(o=>this.remove(o,e));const i=this._find(t);if(i){if(this._componentMap.has(i)&&((n=this._componentMap.get(i))==null?void 0:n.key)!==e)return;const o=this._components.indexOf(i),a=i.node.parentNode;return a==null||a.removeChild(i.node),this._componentMap.delete(i),(s=i.widget)==null||s.removeHandlesReference(this._removeWidgetHandleKey),this._components.splice(o,1)[0]}}empty(t,e={removeInternal:!1}){if(Array.isArray(t)){for(const s of t)this.empty(s,e);return}const i=this._positionNameToContainerLookup[t??"manual"],n=Array.prototype.slice.call(i.children).map(s=>this._findByNode(s)).filter(s=>{var o;return s==null?!1:!(((o=this._componentMap.get(s))==null?void 0:o.internal)??!1)||e.removeInternal});for(const s of n)this.remove(s)}move(t,e){if(Array.isArray(t)&&t.forEach(o=>this.move(o,e)),!t)return;let i;const n=gt(t)||gt(e);if(n&&(i=n.index,e=n.position,t=n.component||t),e&&!this._isValidPosition(e))return;const s=this.remove(t);s&&this.add(s,{position:e,index:i})}find(t){if(!t)return null;const e=this._findById(t);return e&&(e.widget||e.node)}getComponents(t,e={includeInternal:!1}){return t?Array.isArray(t)?t.flatMap(i=>this._getComponentsAtPosition(i,e)):this._getComponentsAtPosition(t,e):this._components.filter(i=>{var n;return e.includeInternal||!((n=this._componentMap.get(i))!=null&&n.internal)}).map(({widget:i,node:n})=>i??n)}getPosition(t){for(const e in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[e].contains(t))return e;return null}_add(t,e,i,n,s){t instanceof We||(t=new We({node:t}));const{widget:o}=t;o!=null&&o instanceof M&&o.addHandles(Xe(()=>{queueMicrotask(()=>this.remove(t))}),this._removeWidgetHandleKey),this._place({component:t,position:e,index:i}),this._components.push(t),this._componentMap.set(t,{key:n,internal:s})}_find(t){return t?t instanceof We?this._findByComponent(t):typeof t=="string"?this._findById(t):this._findByNode(t.domNode||t):null}_getViewPadding(){var t;return((t=this.view)==null?void 0:t.padding)??pa}_attachContainers(t){t.appendChild(this._innerContainer),t.appendChild(this._manualContainer)}_initContainers(){const t=document.createElement("div");t.classList.add($.innerContainer,$.cornerContainer);const e=document.createElement("div");e.classList.add($.innerContainer,$.manualContainer);const i=document.createElement("div");i.classList.add($.topLeft,$.corner),t.appendChild(i);const n=document.createElement("div");n.classList.add($.topRight,$.corner),t.appendChild(n);const s=document.createElement("div");s.classList.add($.bottomLeft,$.corner),t.appendChild(s);const o=document.createElement("div");o.classList.add($.bottomRight,$.corner),t.appendChild(o),this._innerContainer=t,this._manualContainer=e;const a=Rn();this._cornerNameToContainerLookup={"top-left":i,"top-right":n,"bottom-left":s,"bottom-right":o,"top-leading":a?n:i,"top-trailing":a?i:n,"bottom-leading":a?o:s,"bottom-trailing":a?s:o},this._positionNameToContainerLookup={manual:e,...this._cornerNameToContainerLookup}}_isValidPosition(t){return!!this._positionNameToContainerLookup[t]}_place(t){const e=t.position??"manual",{component:i,index:n}=t,s=this._positionNameToContainerLookup[e],o=n!=null&&n>-1;if(ua(i.widget)&&i.widget.startup(),!o)return void s.appendChild(i.node);const a=Array.from(s.children);if(n===0)return void(s.firstChild?Xt(i.node,s.firstChild):s.appendChild(i.node));n>=a.length?s.appendChild(i.node):Xt(i.node,a[n])}_toPixelPosition(t){return{top:Oe(t.top),left:Oe(t.left),right:Oe(t.right),bottom:Oe(t.bottom)}}_findByComponent(t){return this._components.find(e=>e===t)??null}_findById(t){return this._components.find(({id:e})=>e===t)??null}_findByNode(t){return this._components.find(({node:e})=>e===t)??null}_getComponentsAtPosition(t,e){const i=this._positionNameToContainerLookup[t];return Array.prototype.slice.call(i.children).map(n=>this._findByNode(n)).filter(ki).filter(n=>{var s;return e.includeInternal||!((s=this._componentMap.get(n))!=null&&s.internal)}).map(({widget:n,node:s})=>n??s)}};l([c()],H.prototype,"_locale",void 0),l([c()],H.prototype,"container",null),l([c()],H.prototype,"height",null),l([c({value:Ji})],H.prototype,"padding",null),l([Ci("padding")],H.prototype,"castPadding",null),l([c()],H.prototype,"view",void 0),l([c()],H.prototype,"width",null),H=l([b("esri.views.ui.UI")],H);const ma=H;let Ze,qe=null;const ye=new Map;async function Qr(t){qe==null&&(Ze==null&&(Ze=Ue(()=>import("./Lyr3DWasmPerSceneView-C2UJE6LO.js"),__vite__mapDeps([80,1,2,81,82,83,84,85]))),qe=await Ze);const e=t.view;let i=ye.get(e);return i||(i=new qe.default({view:e}),ye.set(e,i)),await i.initializeWasm(),i.add3DTilesLayerView(t)}function ga(t){return ye.get(t)}function el(t){const e=t.view,i=ye.get(e);i&&i.remove3DTilesLayerView(t)<1&&(ye.delete(e),ye.size===0&&(Ze=null,qe=null))}function wi(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function fa(t,e){return t.length!==e.length||t.some((i,n)=>i.text!==e[n].text)}function be(t,e,i){!i||!e||t.find(n=>n.layerView===e&&n.text===i)||t.push({text:i,layerView:e})}function ya(t){return t.type==="bing-maps"}const G=[];let ge=class extends M{constructor(t){super(t),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new x,this.view=null,this._allLayerViewsChange=e=>{var n;this.removeHandles("suspension"),this.removeHandles("visible-geometry-changed");const i=(n=this.view)==null?void 0:n.allLayerViews;i&&(this.addHandles(i.map(s=>w(()=>{var o;return[s.suspended,(o=s.layer)==null?void 0:o.attributionVisible]},()=>this._updateAttributionItems())).toArray(),"suspension"),i.forEach(s=>{s.declaredClass==="esri.views.3d.layers.Tiles3DLayerView3D"&&this.addHandles(s.on("visible-geometry-changed",()=>this._updateAttributionItems()),"visible-geometry-changed")})),e!=null&&e.removed&&e.removed.forEach(s=>{this._pendingAttributions.delete(s),this._fetchedAttributionData.delete(s)}),this._updateAttributionItems()},this.addHandles([Je(()=>{var e;return(e=this.view)==null?void 0:e.allLayerViews},"change",e=>this._allLayerViewsChange(e),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),Pi(()=>{var e;return((e=this.view)==null?void 0:e.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){var t;return(t=this.view)!=null&&t.ready?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const t=this.view,e=t==null?void 0:t.allLayerViews;if(G.length=0,!t||!e)return void this._clear();e.forEach(n=>{var a,r;if(n.suspended||!((a=n.layer)!=null&&a.attributionVisible))return;const s=n.layer;if(wi(s,"user"))return void be(G,n,s.copyright);if(s.hasAttributionData){if(this._fetchedAttributionData.has(n)){const h=this._fetchedAttributionData.get(n);return void(h?be(G,n,this._getDynamicAttribution(h,t,s)):wi(s)&&be(G,n,s.copyright))}return void this._fetchAttributionData(n)}const o="portalItem"in s?(r=s.portalItem)==null?void 0:r.accessInformation:void 0;be(G,n,o||s.copyright)});const i=e.find(n=>{var s;return((s=n.layer)==null?void 0:s.type)==="integrated-mesh-3dtiles"});if(this.view&&i){const n=ga(this.view);if(n){const s=n.getAttributionText();for(let o=0;o<s.length;++o)be(G,i,s[o])}}fa(this.items,G)&&(this.items.removeAll(),this.items.addMany(G)),G.length=0,this.notifyChange("state")}async _fetchAttributionData(t){if(this._pendingAttributions.has(t))return;this._pendingAttributions.add(t);const e=await Dn(t.layer.fetchAttributionData());if(this._pendingAttributions.has(t)){const i=e.ok?this._createContributionIndex(e.value,ya(t.layer)):null;this._pendingAttributions.delete(t),this._fetchedAttributionData.set(t,i)}this._updateAttributionItems()}_createContributionIndex(t,e){const i=t.contributors,n={};if(!i)return n;for(let s=0;s<i.length;s++){const o=i[s],a=o.coverageAreas;if(!a)return;for(const r of a){const h=r.bbox,d=r.zoomMin-(e&&r.zoomMin?1:0),p=r.zoomMax-(e&&r.zoomMax?1:0),m=new Ti({xmin:h[1],ymin:h[0],xmax:h[3],ymax:h[2],spatialReference:$i.WGS84}),u={extent:Ln(m),attribution:o.attribution||"",score:r.score!=null?r.score:100,id:s};for(let f=d;f<=p;f++)n[f]??(n[f]=[]),n[f].push(u)}}return n.maxKey=Math.max.apply(null,Object.keys(n)),n}_getDynamicAttribution(t,e,i){var d;const{extent:n,scale:s}=e;let o=((d=i.tileInfo)==null?void 0:d.scaleToZoom(s))??0;if(o=Math.min(t.maxKey??0,Math.round(o)),!n||o==null||o<=-1)return"";const a=t[o],r=Vn(n.center.clone().normalize(),e.spatialReference),h=new Set;return a?a.filter(p=>{const m=p.id,u=!h.has(m)&&r&&p.extent&&An(p.extent,r);return u&&h.add(m),u}).sort((p,m)=>m.score-p.score||p.objectId-m.objectId).map(p=>p.attribution).join(", "):""}};l([c({readOnly:!0,type:x})],ge.prototype,"items",void 0),l([c({readOnly:!0})],ge.prototype,"state",null),l([c()],ge.prototype,"view",void 0),ge=l([b("esri.widgets.Attribution.AttributionViewModel")],ge);const Xi=ge,pe="esri-attribution",ue={base:pe,poweredBy:`${pe}__powered-by`,sources:`${pe}__sources`,open:`${pe}--open`,sourcesOpen:`${pe}__sources--open`,link:`${pe}__link`};let T=class extends On{constructor(e,i){super(e,i),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(n=>n.forEach(({target:s})=>this._checkSourceTextOverflow(s))),this.itemDelimiter=" | ",this.messages=null,this.viewModel=new Xi}initialize(){this.addHandles(Je(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,i)=>(e.includes(i.text)||e.push(i.text),e),[]).join(this.itemDelimiter)}get icon(){return"description"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[ue.open]:this._isOpen};return Le("div",{bind:this,class:this.classes(ue.base,ti.widget,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return Le("div",{class:ue.poweredBy},"Powered by"," ",Le("a",{class:ue.link,href:"https://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const e=this._isOpen,i=this._isInteractive,n=i?0:void 0,{attributionText:s}=this,o={[ue.sourcesOpen]:e,[ti.interactive]:i};return Le("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(ue.sources,o),innerHTML:s,tabIndex:n})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let i=!1;const{clientHeight:n,clientWidth:s,scrollWidth:o}=e,a=o>s,r=this._attributionTextOverflowed!==a;if(this._attributionTextOverflowed=a,r&&(i=!0),this._isOpen){const h=n<this._prevSourceNodeHeight;this._prevSourceNodeHeight=n,h&&(this._isOpen=!1,i=!0)}i&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};l([c()],T.prototype,"_isOpen",void 0),l([c()],T.prototype,"_isInteractive",null),l([c()],T.prototype,"_attributionTextOverflowed",void 0),l([c()],T.prototype,"_prevSourceNodeHeight",void 0),l([c({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],T.prototype,"attributionText",null),l([c()],T.prototype,"icon",null),l([c()],T.prototype,"itemDelimiter",void 0),l([c()],T.prototype,"label",null),l([c(),Fn("esri/widgets/Attribution/t9n/Attribution")],T.prototype,"messages",void 0),l([c()],T.prototype,"view",null),l([c({type:Xi})],T.prototype,"viewModel",void 0),l([Yn()],T.prototype,"_toggleState",null),T=l([b("esri.widgets.Attribution")],T);const _a=T;function va(t){return(t==null?void 0:t.view)!==void 0}let je=class extends ma{constructor(t){super(t),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=e=>{this.components.forEach(i=>{const n=this._find(i),s=n==null?void 0:n.widget;va(s)&&(s.view=e)})},this._componentsWatcher=(e,i)=>{this._removeComponents(i),this._addComponents(e),this._adjustPadding(e)}}initialize(){this.addHandles([w(()=>this.components,this._componentsWatcher,Z),w(()=>this.view,this._updateViewAwareWidgets,Z)])}_add(t,e,i,n,s){let o=t;if(typeof t=="string"&&this._defaultPositionLookup[t]){if(this._find(t))return;o=this._createComponent(t)}super._add(o,e,i,n,s)}_removeComponents(t){t.forEach(e=>{const i=this._find(e);i&&(this.remove(i),i.destroy())})}_adjustPadding(t){if(!t.includes("attribution")&&!this._isOverridden("padding")){const{top:e}=this.padding;this.padding=e}}_addComponents(t){this.constructed&&t.forEach(e=>this.add(this._createComponent(e),this._defaultPositionLookup[e]))}_createComponent(t){const e=this._createWidget(t);return new We({id:t,node:e})}_createWidget(t){const e=this.view;switch(t){case"attribution":return new _a({view:e});case"compass":return new Jn({view:e});case"navigation-toggle":return new Xn({view:e});case"zoom":return new Qn({view:e})}}};l([c()],je.prototype,"components",void 0),je=l([b("esri.views.ui.DefaultUI")],je);const il=je;export{Br as A,Kr as B,il as C,qa as D,Ba as E,Xr as F,Yr as G,Ua as H,Gs as I,fr as J,Ft as K,Tr as L,Ir as M,ur as N,Ke as O,jr as P,Jr as Q,el as a,_r as b,gr as c,Pr as d,Ws as e,$r as f,Sr as g,Er as h,Qr as i,Lr as j,D as k,ga as l,jo as m,Pt as n,zr as o,xr as p,Hr as q,Zs as r,Dr as s,qs as t,Pe as u,Zr as v,Fr as w,Ar as x,Gr as y,Ur as z};
