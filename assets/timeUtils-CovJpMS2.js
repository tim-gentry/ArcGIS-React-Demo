import{g1 as s,b6 as y,j3 as E,n as b,i9 as f,a as h}from"./index-DX0rcHuW.js";import{e as S}from"./utils-CXgSw6Sd.js";import{e as F}from"./tagSymbols-BPcGfZon.js";function W(e){return e!=null&&typeof e=="object"&&F in e}function v(e){return e.timeInfo!==void 0}async function D(e,i){var t,r;return((r=(t=e.widgets)==null?void 0:t.timeSlider)==null?void 0:r.fullTimeExtent)??I(e.allLayers,i)}function O(e){const i=e.numThumbs??2,t=e.currentTimeExtent;if(t){const{start:r,end:l}=t;return r!=null&&l!=null&&r.getTime()===l.getTime()?"instant":i===2?"time-window":r==null||r.getTime()===0?"cumulative-from-start":"cumulative-from-end"}return i===2?"time-window":"cumulative-from-start"}function U(e){const{numStops:i,stopInterval:t,stops:r}=e;return r?{dates:h(r)}:t?{interval:t.clone()}:{count:i??5}}async function I(e,i){var T;if(e.length===0)return s.allTime;await Promise.all(e.map(n=>n.load({signal:i})));const t=e.filter(v),r=e.filter(n=>!v(n)&&n.visibilityTimeExtent!=null);if(t.length===0&&r.length===0)return s.allTime;const l=[],a=[];for(const n of t)(n==null?void 0:n.type)!=="feature"&&(n==null?void 0:n.type)!=="map-image"||!((T=n.timeInfo)!=null&&T.hasLiveData)?a.push(n):l.push(n);const m=n=>n==null||n.isAllTime,d=[...a.map(n=>{var c;const o=(c=n.timeInfo)==null?void 0:c.fullTimeExtent,{visibilityTimeExtent:u}=n;return(o==null?void 0:o.intersection(u))??u}),...r.map(n=>n.visibilityTimeExtent)];if(d.some(m))return s.allTime;const x=l.map(async n=>{var c,w;const o=((c=await n.fetchRecomputedExtents({signal:i}))==null?void 0:c.timeExtent)??((w=n.timeInfo)==null?void 0:w.fullTimeExtent),{visibilityTimeExtent:u}=n;return(o==null?void 0:o.intersection(u))??u}),p=(await Promise.allSettled(x)).map(n=>n.status==="fulfilled"?n.value:null);if(p.some(m))return s.allTime;const g=[...p,...d].filter(y);return g.length===0?s.allTime:g.reduce((n,o)=>n.union(o))}function L(e,i){const t=e.currentTimeExtent;if(!t)return null;const{start:r,end:l}=t,a=r??l??null;switch(i){case"time-window":return new s({start:r,end:l});case"cumulative-from-start":return new s({start:null,end:a});case"cumulative-from-end":return new s({start:a,end:null});case"instant":return new s({start:a,end:a})}}async function R(e,i){return E(b.getLogger("esri.support.timeUtils.getTimeSliderSettingsFromWebMap"),"`timeUtils.getTimeSliderSettingsFromWebMap` is deprecated in favor of 'timeUtils.getTimeSliderSettingsFromWebDocument'",{replacement:"timeUtils.getTimeSliderSettingsFromWebDocument",version:"4.30",see:"https://developers.arcgis.com/javascript/latest/api-reference/esri-support-timeUtils.html#getTimeSliderSettingsFromWebDocument",warnOnce:!0}),e!=null&&S(e)?await z(e,i):null}async function z(e,i){var m;if(!S(e)&&!W(e))return null;await e.load({signal:i});const t=(m=e==null?void 0:e.widgets)==null?void 0:m.timeSlider;if(!t)return null;const r=await D(e,i),l=t.loop,a=O(t);return{fullTimeExtent:r,loop:l,mode:a,playRate:t.stopDelay??2e3,stops:U(t),timeExtent:L(t,a)}}function A(e){if(!e)return e;const{start:i,end:t}=e;return new s({start:i!=null?f(i,-i.getTimezoneOffset(),"minutes"):i,end:t!=null?f(t,-t.getTimezoneOffset(),"minutes"):t})}function C(e){if(!e)return e;const{start:i,end:t}=e;return new s({start:i!=null?f(i,i.getTimezoneOffset(),"minutes"):i,end:t!=null?f(t,t.getTimezoneOffset(),"minutes"):t})}export{I as getTimeExtentFromLayers,z as getTimeSliderSettingsFromWebDocument,R as getTimeSliderSettingsFromWebMap,C as toLocalTimeExtent,A as toUTCTimeExtent};
