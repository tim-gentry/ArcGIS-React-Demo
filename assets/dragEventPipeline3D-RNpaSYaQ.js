import{e6 as m,eM as E,aI as S,bp as i,d7 as y,dk as H,dH as $,eN as I,d0 as T,bB as R,c$ as v,d6 as D,d5 as h}from"./index-DX0rcHuW.js";import{t as g,S as C,E as F,F as G,j as P,e as U}from"./plane-BL9J6YX0.js";import{m as k,h as A}from"./sphere-COyqsaGw.js";import{p as q}from"./elevationInfoUtils-JmMUMmCn.js";import{g as w}from"./ray-BtGY6UNr.js";import{T as B,e as _,i as j}from"./ElevationProvider-Xg9LKEp7.js";import{w as M}from"./verticalOffsetUtils-Bq_pVrum.js";import{w as z}from"./InteractiveToolBase-DBqJNRIA.js";function J(n,r){return N(n,()=>r)}function on(n){return N(n,r=>r.plane)}function N(n,r){const t=i(),l=i();let o=!1;return e=>{const a=r(e);if(e.action==="start"){const c=m(e.screenStart,E(g.get())),u=w(n.state.camera,c,x);u!=null&&(o=C(a,u,t))}if(!o)return null;const s=m(e.screenEnd,E(g.get())),d=w(n.state.camera,s,x);return d==null?null:C(a,d,l)?{...e,renderStart:t,renderEnd:l,plane:a,ray:d}:null}}function K(n,r,t=0,l=null,o=null){let e=null;return a=>{if(a.action==="start"&&(e=n.sceneIntersectionHelper.intersectElevationFromScreen($(a.screenStart.x,a.screenStart.y),r,t,o),e!=null&&l!=null&&!I(e,e,l))||e==null)return null;const s=n.sceneIntersectionHelper.intersectElevationFromScreen($(a.screenEnd.x,a.screenEnd.y),r,t,o);return s!=null&&(l==null||I(s,s,l))?{...a,mapStart:e,mapEnd:s}:null}}function L(n,r,t,l=null,o=null){return K(n,t,q(r,n,t),l,o)}function sn(n,r,t,l){const o=t.toMap(n.screenStart);return o!=null?L(r,o,t.elevationInfo,l):null}function Q(n,r){const t=O,l=b,o=F();n.renderCoordsHelper.worldUpAtPosition(r,t);const e=T(G(o),t,R(l,r,n.state.camera.eye));return T(e,e,t),P(r,e,o)}function an(n,r,t){let l=null;const o=new z;return o.next(J(n,Q(n,r))).next(V(n,r)).next(W(n,t)).next(e=>{e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,l=e}),e=>(l=null,o.execute(e),l)}function V(n,r){const t=i(),l=y(r);n.renderCoordsHelper.worldUpAtPosition(r,t);const o=i(),e=i(),a=s=>(R(s,s,r),U(t,s,s),n.viewingMode==="global"&&y(s)*Math.sign(v(t,s))<.001-l&&R(s,D(s,t,.001),r),h(s,s,r),s);return s=>(s.renderStart=a(H(o,s.renderStart)),s.renderEnd=a(H(e,s.renderEnd)),s)}function un(n,r){const t=l=>{const o=m(l,E(g.get())),e=w(n.state.camera,o,x);return e==null?null:A(r,e,O,b)[1]};return l=>{const o=t(l.screenStart);if(o==null)return null;const e=t(l.screenEnd);return e==null?null:{...l,renderStart:o,renderEnd:e}}}function W(n,r){const t=n.renderCoordsHelper;return l=>{const o=t.fromRenderCoords(l.renderStart,new S({spatialReference:r})),e=t.fromRenderCoords(l.renderEnd,new S({spatialReference:r}));return o!=null&&e!=null?{...l,mapStart:o,mapEnd:e}:null}}var f;function cn(n){let r=null;return t=>{switch(t.action){case"start":r=n.disableDisplay();break;case"end":case"cancel":r!=null&&(r.remove(),r=null)}return t}}function dn(n,r=null){const t=B(n.state.viewingMode);t.options.selectionMode=!0,t.options.store=_.MIN,t.options.hud=!1;const l=$(),o={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},e=i(),a=r??n.spatialReference,s=c=>{n.map.ground&&n.map.ground.opacity<1?o.exclude.add(M):o.exclude.delete(M),n.sceneIntersectionHelper.intersectIntersectorScreen(m(c,l),t,o);const u=t.results.min;let p;if(u.getIntersectionPoint(e))p=u.intersector===j.TERRAIN?f.GROUND:f.OTHER;else{if(!t.results.ground.getIntersectionPoint(e))return null;p=f.GROUND}return{location:n.renderCoordsHelper.fromRenderCoords(e,new S({spatialReference:a})),surfaceType:p}};let d;return c=>{if(c.action==="start"){const p=s(c.screenStart);d=p!=null?p.location:null}if(d==null)return null;const u=s(c.screenEnd);return(u==null?void 0:u.location)!=null?{...c,mapStart:d,mapEnd:u.location,surfaceType:u.surfaceType}:null}}(function(n){n[n.GROUND=0]="GROUND",n[n.OTHER=1]="OTHER"})(f||(f={}));const O=i(),b=i(),x=k();export{W as A,on as C,L as D,f as F,an as G,sn as M,J as O,un as k,cn as q,dn as z};
