import{s,F as c}from"./Basemap-CjElSnyL.js";import{dI as T,i as y,dJ as q,y as x,z as U,n as M,V as h,dK as k,dL as A,dM as K}from"./index-DX0rcHuW.js";const p=()=>M.getLogger("esri.support.basemapUtils");function z(){return{}}function D(e){for(const n in e){const a=e[n];T(a),delete e[n]}}function C(e,n){let a;if(typeof e=="string"){const r=e in s,t=!r&&e.includes("/");if(!r&&!t){const l=Object.entries(s).filter(([i,u])=>y.apiKey&&!u.classic||!y.apiKey&&(u.classic||u.is3d)).map(([i])=>`"${i}"`).sort().join(", ");return p().warn(`Unable to find basemap definition for: ${e}. Try one of these: ${l}`),null}n&&(a=n[e]),a||(a=r?c.fromId(e):new c({style:{id:e}}),n&&(n[e]=a))}else a=q(c,e);return a!=null&&a.destroyed&&(p().warn("The provided basemap is already destroyed",{basemap:a}),a=null),a}function F(e){var n;return((n=e.portalItem)==null?void 0:n.type)==="Web Scene"||e.referenceLayers.some(a=>a.type==="scene")}function J(e){var n,a;return!!((a=(n=e==null?void 0:e.portalItem)==null?void 0:n.tags)!=null&&a.some(r=>r.toLowerCase()==="beta"))}function W(e,n){var a,r,t,l;return((r=(a=e.basemap)==null?void 0:a.referenceLayers)==null?void 0:r.some(i=>i.uid===n))||((l=(t=e.basemap)==null?void 0:t.baseLayers)==null?void 0:l.some(i=>i.uid===n))}function _(e,n=null){const a=C(e);if(!a)return null;const r=a.clone();return n&&(r.baseLayers=d(r.baseLayers,n.baseLayers),r.referenceLayers=d(r.referenceLayers,n.referenceLayers)),r}function G(e){let n=null;const a=o(e),r=!(a!=null&&a.baseLayers.length);for(const t in s){const l=I(a,g(s[t]),{mustMatchReferences:r});if(l==="equal"){n=t;break}l==="base-layers-equal"&&(n=t)}return n}function H(e,n){var a,r;return e===n||((a=e==null?void 0:e.portalItem)==null?void 0:a.id)!=null&&e.portalItem.id===((r=n==null?void 0:n.portalItem)==null?void 0:r.id)?!0:I(o(e),o(n),{mustMatchReferences:!0})==="equal"}function d(e,n){const a=new h;return e.forEach(r=>{const t=n.find(l=>l.type!=="scene"&&R(f(r),f(l)))||r;a.includes(t)?a.push(r):a.push(t)}),a}function P(e){return!!(e!=null&&e.baseLayers.concat(e.referenceLayers).some(V))}function V(e){if(b(e.url))return!0;if(e.type==="vector-tile")for(const n in e.sourceNameToSource){const a=e.sourceNameToSource[n];if(b(a==null?void 0:a.sourceUrl))return!0}return!1}function Q(e,n){var l;if(n==null||e==null)return{spatialReference:null,updating:!1};if(n.loadStatus==="not-loaded")return n.load(),{spatialReference:null,updating:!0};if(n.spatialReference)return{spatialReference:n.spatialReference,updating:!1};if(n.baseLayers.length===0)return{spatialReference:null,updating:!1};const a=n.baseLayers.at(0);switch(a.loadStatus){case"not-loaded":a.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}const r=(("supportedSpatialReferences"in a?a.supportedSpatialReferences:null)||["tileInfo"in a?(l=a.tileInfo)==null?void 0:l.spatialReference:a.spatialReference]).filter(Boolean),t=e.spatialReference;return t?{spatialReference:r.find(i=>t.equals(i))??r[0]??null,updating:!1}:{spatialReference:r[0],updating:!1}}const j=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function b(e){if(!e)return!1;const n=new x(U(e));return!!n.authority&&j.test(n.authority)}function o(e){return e?!e.loaded&&e.resourceInfo?g(e.resourceInfo.data):{baseLayers:m(e.baseLayers),referenceLayers:m(e.referenceLayers)}:null}function m(e){return(h.isCollection(e)?e.toArray():e).map(f)}function f(e){var n,a;return{type:e.type,effect:"effect"in e?e.effect:void 0,url:w("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl||""),minScale:"minScale"in e&&e.minScale!=null?e.minScale:0,maxScale:"maxScale"in e&&e.maxScale!=null?e.maxScale:0,opacity:e.opacity!=null?e.opacity:1,visible:e.visible==null||!!e.visible,sublayers:e.type!=="map-image"&&e.type!=="wms"||e.sublayers==null||(n=e.sublayers)==null?void 0:n.map(r=>({id:r.id,visible:r.visible})),activeLayerId:e.type==="wmts"?(a=e.activeLayer)==null?void 0:a.id:void 0}}function L(e){return e.isReference||e.layerType==="ArcGISSceneServiceLayer"}function g(e){return e?{baseLayers:v((e.baseMapLayers??[]).filter(n=>!L(n))),referenceLayers:v((e.baseMapLayers??[]).filter(n=>L(n)))}:null}function v(e){return e.map(n=>N(n))}function N(e){let n;switch(e.layerType){case"VectorTileLayer":n="vector-tile";break;case"ArcGISTiledMapServiceLayer":n="tile";break;case"ArcGISSceneServiceLayer":n="scene";break;default:n="unknown"}return{type:n,effect:e.effect,url:w(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:e.minScale??0,maxScale:e.maxScale??0,opacity:e.opacity??1,visible:e.visibility==null||!!e.visibility,sublayers:void 0,activeLayerId:void 0}}function I(e,n,a){return e!=null!=(n!=null)?"not-equal":!e||!n?"equal":S(e.baseLayers,n.baseLayers)?S(e.referenceLayers,n.referenceLayers)?"equal":a.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal"}function S(e,n){if(e.length!==n.length)return!1;for(let a=0;a<e.length;a++)if(!R(e[a],n[a]))return!1;return!0}function R(e,n){if(e.type!==n.type||e.url!==n.url||e.minScale!==n.minScale||e.maxScale!==n.maxScale||e.visible!==n.visible||e.opacity!==n.opacity||!k(e.effect,n.effect))return!1;if(e.activeLayerId!=null||n.activeLayerId!=null)return e.activeLayerId===n.activeLayerId;if(e.sublayers!=null||n.sublayers!=null){if(e.sublayers==null||n.sublayers==null||e.sublayers.length!==n.sublayers.length)return!1;for(let a=0;a<e.sublayers.length;a++){const r=e.sublayers.at(a),t=n.sublayers.at(a);if((r==null?void 0:r.id)!==(t==null?void 0:t.id)||(r==null?void 0:r.visible)!==(t==null?void 0:t.visible))return!1}}return!0}function w(e){return e?A(e).replace(/^\s*https?:/i,"").toLowerCase():""}function X(e){if(!e)return null;const{thumbnailUrl:n}=e;if(n)return n;const a=G(e);return a?s[a].thumbnailUrl:K(e.baseLayers,B)}function B(e){var n;return"portalItem"in e?(n=e.portalItem)==null?void 0:n.thumbnailUrl:void 0}export{J as L,X as O,H as R,W as S,Q as U,C as b,F as d,V as j,D as m,_ as v,P as w,z as y};
