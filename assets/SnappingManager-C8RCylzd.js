const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FeatureServiceSnappingSource-B6rEpCAs.js","assets/index-DX0rcHuW.js","assets/index-B2yzeq1w.css","assets/memoize-DsJmrG76.js","assets/UpdatingHandles-CERUeL1P.js","assets/elevationInfoUtils-JmMUMmCn.js","assets/TileKey-DZd6gJy7.js","assets/boundedPlane-MAPkm7Yi.js","assets/sphere-COyqsaGw.js","assets/plane-BL9J6YX0.js","assets/mat3f64-BBpwCtoL.js","assets/mat4f64-Dk4dwAN8.js","assets/quatf64-BrpT0VRp.js","assets/vec2f64-Diu2Kaa8.js","assets/mathUtils-BsqbT0oM.js","assets/lineSegment-C2OVzbAD.js","assets/layerViewUtils-D2JqIDZ8.js","assets/FeatureTileDescriptor3D-CvT50Jkf.js","assets/queryEngineUtils-B1Z8IhWh.js","assets/VertexSnappingCandidate-HlPAcwSb.js","assets/PointSnappingHint-5GPoViz2.js","assets/TileTreeDebugger-BD-0r5wQ.js","assets/WorkerHandle-DkXs_4ea.js","assets/projectVectorToVector-DjKO2tJh.js","assets/projectPointToVector-6lqiVL77.js","assets/TileInfo-DuivnO5H.js","assets/debugFlags-Cr0sx6r_.js","assets/vec2-C-4tM9Uv.js","assets/geodesicUtils-BPlO99Nt.js","assets/geometry2dUtils-D5ud2BJg.js","assets/floorFilterUtils-DZ5C6FQv.js","assets/InputManager-abOXR3ru.js","assets/signal-CpmfLcHB.js","assets/keybindings-RFI4I3n4.js","assets/utils-CXgSw6Sd.js","assets/geodesicLengthMeasurementUtils-1VjlYqtL.js","assets/quantityUtils-DSpmykXR.js","assets/geometryEngine-C92iiwvG.js","assets/geometryEngineBase-RmbNeFm7.js","assets/_commonjsHelpers-DCkdB7M8.js","assets/hydrated-CEL7VY_R.js","assets/Cyclical-CEj-eenM.js","assets/FeatureCollectionSnappingSource-BBAUqTpn.js","assets/symbologySnappingCandidates-DFXyMu-9.js","assets/GraphicsSnappingSource-Dt-aiCHP.js","assets/normalizeUtilsSync--5Av753T.js","assets/normalizeUtilsCommon-DXRtgGFh.js","assets/featureConversionUtils-C8uvc1AG.js","assets/OptimizedFeature-7juV2tZm.js","assets/OptimizedGeometry-vU5jWBvU.js","assets/OptimizedFeatureSet-Blu9Ckm7.js","assets/FeatureStore-BRjii-6R.js","assets/BoundsStore-266MdP16.js","assets/PooledRBush-txtruiUM.js","assets/quickselect-D0_cvEX6.js","assets/timeSupport-BrCiU-ir.js","assets/normalizeUtils-CzEkgn6d.js","assets/utils-nzDIu46v.js","assets/utils-D67OULxu.js","assets/json-Wa8cmqdu.js","assets/optimizedFeatureQueryEngineAdapter-Buta7wlw.js","assets/centroid-DdLmOD72.js","assets/QueryEngine-SKHuQoIy.js","assets/WhereClause-C3Bpu3MP.js","assets/TimeOnly-DZBbU_oj.js","assets/utils-NIIWJwfl.js","assets/utils-CZ12wTZ2.js","assets/Basemap-CjElSnyL.js","assets/loadAll-8MiqgLTH.js","assets/writeUtils-RiCb1SCd.js","assets/utils-fmpzjX3M.js","assets/ClassBreaksDefinition-RQBfkmon.js","assets/SnappingCandidate-O5eRSE6e.js","assets/Scheduler-Bg_fxWwI.js","assets/utils-BbU12Hvz.js","assets/cimSymbolUtils-DzDRYI6s.js","assets/SceneLayerSnappingSource-BlAASW2P.js","assets/EdgeWorkerHandle-Krab2y4-.js","assets/workerHelper-DaWr0fN1.js","assets/InterleavedLayout-ZKuAjCiK.js","assets/BufferView-XrMc2vJu.js","assets/types-D0PSWh4d.js","assets/Util-HYkJg9Vp.js","assets/edgeProcessing-BO3TMEUB.js","assets/deduplicate-CREmZpKM.js","assets/Indices-BZu2O98k.js","assets/VertexAttribute-BnAa5VW0.js","assets/glUtil-C6KhMg1m.js","assets/enums-BlUEVwJR.js","assets/VertexElementDescriptor-BOD-G50G.js","assets/Normals-ClOhen2_.js"])))=>i.map(i=>d[i]);
import{d2 as Ue,ac as h,ad as f,ag as fe,cC as Ze,al as gn,bO as w,dO as yn,bp as y,dU as si,bs as be,d3 as U,gd as V,c$ as M,dV as T,dj as pe,dk as nt,bB as Ce,d0 as We,jq as St,b6 as vn,fP as oi,dm as Be,dl as ai,cR as li,cU as ci,bq as ui,m6 as di,bk as hi,d$ as pi,eb as fi,ex as gi,bA as Nt,G as yi,bY as ve,dN as Ye,ff as vi,fm as Mt,oM as mi,lg as _i,bh as Te,V as xe,n as mn,gB as Ei,m5 as qe,gM as He,ii as ht,oN as Si,i0 as wi,b$ as wt,hm as xi,M as pt,dc as _n,dz as bi,_ as je,d5 as Li,d8 as $i,b5 as Ti,db as Jt,bM as Pi,eK as Ri}from"./index-DX0rcHuW.js";import{m as Ni,j as b,x as Mi,E as Ai}from"./elevationInfoUtils-JmMUMmCn.js";import{a as En,e as it,n as Xe}from"./projectVectorToVector-DjKO2tJh.js";import{e as oe,p as Fe,j as Ie,d as Ae,B as Fi,q as Vi,_ as Sn,o as wn,b as me,E as Kt,L as Ci,m as At}from"./vec2-C-4tM9Uv.js";import{h as Ii}from"./UpdatingHandles-CERUeL1P.js";import{n as G,r as ke,a as Oi,_ as Di}from"./vec2f64-Diu2Kaa8.js";import{b as Je,j as Ft,z as Vt,A as xt}from"./geodesicUtils-BPlO99Nt.js";import{E as O,D as zi,j as rt,R as bt,w as xn,V as qi,J as bn,F as Ln,b as ji}from"./plane-BL9J6YX0.js";import{Y as Hi,d as ki,w as Gi,Q as Ui,V as Zi}from"./sphere-COyqsaGw.js";import{j as $n}from"./mathUtils-BsqbT0oM.js";import{j as P,d as Wi,I as Lt,N as Bi}from"./geometry2dUtils-D5ud2BJg.js";import{o as Yi}from"./floorFilterUtils-DZ5C6FQv.js";import{_ as Xi}from"./InputManager-abOXR3ru.js";import{c as Qt}from"./keybindings-RFI4I3n4.js";import{e as Ji}from"./utils-CXgSw6Sd.js";import{t as Ki}from"./layerViewUtils-D2JqIDZ8.js";import{d as N,u as Tn}from"./geodesicLengthMeasurementUtils-1VjlYqtL.js";import{a as Qi,n as er,s as tr,r as Pn}from"./Cyclical-CEj-eenM.js";import{o as _e,m as Ct,f as Rn}from"./quantityUtils-DSpmykXR.js";var Ee;function Nn(n,e,t){return I(n,e,t)}function I(n=0,e=0,t=0){return Ue(n,e,t)}function Is(n){return n}function Os(n){return n}function Z(n,e,t){return Ue(n,e,t)}function Le(n){const[e,t,i]=n;return n.length>3?[e,t,i,n[3]]:[e,t,i]}function de(n){return n[3]=((n.length>3?n[3]:void 0)??Ee.NONE)|Ee.TARGET,n}function Ds(n){return!!(((n.length>3?n[3]:void 0)??Ee.NONE)&Ee.TARGET)}function L(n,e,{coordinateHelper:t,elevationInfo:i},r){return n?Me(t.vectorToDehydratedPoint(n,nr),e,i,r):null}function Me(n,e,t,i=I()){return i[0]=n.x,i[1]=n.y,i[2]=n.z??0,e==null||(e.type==="2d"?i[2]=0:i[2]=Ni(e,n,t,b)??0),i}function zs(n,e,t){return t?(En(t,n[0],n[1],n[2],e),t):it(n[0],n[1],n[2],e)}function en(n,e,{z:t,m:i},r,s){const{spatialReference:a,elevationInfo:o}=r;let l;t==null&&i==null?l=void 0:e==null||e.type==="2d"?l=t??void 0:l=Mi(e,n,a,b,o)??0;const[c,u]=n;return s?En(s,c,u,l,a):s=it(c,u,l,a),i!=null&&(s.m=i,s.hasM=!0),s}function qs(n,e,t,i,r=I()){const[s,a]=n;return r[0]=s,r[1]=a,n.length>3&&(r[3]=n[3]??Ee.NONE),(t==null?void 0:t.type)!=="3d"?(r[2]=e.value,r):(r[2]=Ai(t,s,a,e.value,i,e.elevationInfo,b)??0,r)}(function(n){n[n.NONE=0]="NONE",n[n.TARGET=1]="TARGET"})(Ee||(Ee={}));const nr=it(0,0,0,null);let H=class extends gn{constructor(){super(...arguments),this.enabled=!0}};h([f({type:Boolean})],H.prototype,"enabled",void 0),H=h([fe("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],H);let S=class extends gn{constructor(e){super(e),this.lineSnapper=new H,this.parallelLineSnapper=new H,this.rightAngleSnapper=new H,this.rightAngleTriangleSnapper=new H,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new Ze([255,127,0]),this.orangeTransparent=new Ze([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};h([f({type:H,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"lineSnapper",void 0),h([f({type:H,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"parallelLineSnapper",void 0),h([f({type:H,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"rightAngleSnapper",void 0),h([f({type:H,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"rightAngleTriangleSnapper",void 0),h([f({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],S.prototype,"shortLineThreshold",void 0),h([f({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],S.prototype,"distance",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"pointThreshold",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"intersectionParallelLineThreshold",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"parallelLineThreshold",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],S.prototype,"verticalLineThresholdMeters",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"touchSensitivityMultiplier",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"pointOnLineThreshold",void 0),h([f({type:Ze,nonNullable:!0})],S.prototype,"orange",void 0),h([f({type:Ze,nonNullable:!0})],S.prototype,"orangeTransparent",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"lineHintWidthReference",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"lineHintWidthTarget",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],S.prototype,"lineHintFadedExtensions",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"parallelLineHintWidth",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],S.prototype,"parallelLineHintLength",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],S.prototype,"parallelLineHintOffset",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],S.prototype,"rightAngleHintSize",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],S.prototype,"rightAngleHintOutlineSize",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],S.prototype,"satisfiesConstraintScreenThreshold",void 0),S=h([fe("esri.views.interactive.snapping.Settings.Defaults")],S);const se=new S;var $;(function(n){n[n.FEATURE=1]="FEATURE",n[n.SELF=2]="SELF",n[n.ALL=3]="ALL"})($||($={}));let st=class{constructor(e,t){this.isDraped=e,this.domain=t}},ir=class Mn extends st{constructor(e,t,i=$.ALL){super(t,i),this.intersectionPoint=e}equals(e){return e instanceof Mn&&w(this.intersectionPoint,e.intersectionPoint)}},J=class An extends st{constructor(e,t,i,r,s=$.ALL,a=!0,o=!0){super(r,s),this.type=e,this.lineStart=t,this.lineEnd=i,this.fadeLeft=a,this.fadeRight=o}equals(e){return e instanceof An&&this.type===e.type&&w(this.lineStart,e.lineStart)&&w(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return yn(this.lineStart,this.lineEnd)}},rr=class Fn extends st{constructor(e,t,i,r=$.ALL){super(i,r),this.lineStart=e,this.lineEnd=t}equals(e){return e instanceof Fn&&w(this.lineStart,e.lineStart)&&w(this.lineEnd,e.lineEnd)}};class ot extends st{constructor(e,t,i,r,s=$.ALL){super(r,s),this.previousVertex=e,this.centerVertex=t,this.nextVertex=i}equals(e){return e instanceof ot&&w(this.previousVertex,e.previousVertex)&&w(this.centerVertex,e.centerVertex)&&w(this.nextVertex,e.nextVertex)}}function It({start:n,end:e,type:t},i,r){const s=[],a=oe(Oe,e,n),o=oe(at,n,i),l=Fe(a),c=2*Ie(a,o),u=c*c-4*l*(Fe(o)-r*r);if(u===0){const d=-c/(2*l);(t===C.PLANE||d>=0)&&s.push(Ae(G(),n,a,d))}else if(u>0){const d=Math.sqrt(u),p=(-c+d)/(2*l);(t===C.PLANE||p>=0)&&s.push(Ae(G(),n,a,p));const g=(-c-d)/(2*l);(t===C.PLANE||g>=0)&&s.push(Ae(G(),n,a,g))}return s}function Vn(n,e){const t=n.start,i=n.end,r=oe(Oe,i,t),s=U(ct,-r[1],r[0],0),a=e.start,o=e.end,l=V(zt,o,a),c=M(l,s),u=U(jn,t[0],t[1],0),d=V(Hn,u,a),p=M(d,s),g=be();if(Math.abs(c)<g)return[];const v=T(kn,a,l,p/c);if(e.type===P.RAY){const m=V($t,v,a);if(M(m,l)<-g)return[]}if(n.type===C.HALF_PLANE){const m=Fi(at,v,t);if(Ie(m,r)<-g)return[]}return[pe(v)]}function sr(n,e){return ar(Ke(qt,e[2],n),e)}function Cn(n,e){return zn(Ke(qt,0,n),Ke(dr,0,e)).map(([i,r])=>ke(i,r))}function In(n,e,t){return Ot(n,Ke(qt,n[2],e),t)}function On(n,e,t,i=y()){const r=oe(Oe,n,e),s=Vi(r);return Ae(i,e,r,s===0?1:t/s),i[2]=n[2],i}function Ot(n,{start:e,end:t,type:i},r=y()){const s=V(lt,n,e),a=V(ct,t,e),o=M(s,a)/M(a,a);return T(r,e,a,i===P.RAY?Math.max(o,0):o)}const or=(()=>{const n=y(),e=y(),t=y();return({start:i,end:r},{center:s,radius:a,normal:o,slicePlane:l})=>{const c=rt(s,o,ur);if(E(bt(c,i),0)&&E(bt(c,r),0)){$n(o,n,e);const d=(v,m)=>(Ce(t,m,s),wn(v,M(t,n),M(t,e)),v),p=Wi({start:d(Oe,i),end:d(at,r),type:P.LINE},Oi,a),g=[];for(const[v,m]of p){const _=nt(y(),s);T(_,_,n,v),T(_,_,e,m),l&&!he(l,_)||g.push(_)}return g}const u=y();return xn(c,i,r,u)?!E(yn(u,s),a)||l&&!he(l,u)?[]:[u]:[]}})();function Dn({start:n,end:e,type:t},i,r){const s=[],a=Ce(lt,e,n),o=oe(at,n,i),l=Fe(a),c=2*Ie(a,o),u=c*c-4*l*(Fe(o)-r*r);if(u===0){const d=-c/(2*l);(t===P.LINE||d>=0)&&s.push(T(y(),n,a,d))}else if(u>0){const d=Math.sqrt(u),p=(-c+d)/(2*l);(t===P.LINE||p>=0)&&s.push(T(y(),n,a,p));const g=(-c-d)/(2*l);(t===P.LINE||g>=0)&&s.push(T(y(),n,a,g))}return s}function zn(n,e){const t=n.start,i=n.end,r=e.start,s=e.end,a=V(lt,i,t),o=V(ct,s,r),l=V(zt,r,t),c=We(jn,a,o);if(!E(M(l,c),0))return[];const u=St(c);if(E(u,0))return[];const d=We(Hn,l,o),p=M(d,c)/u,g=T(kn,t,a,p);if(n.type===P.RAY){const v=V($t,g,t);if(M(a,v)<-be())return[]}if(e.type===P.RAY){const v=V($t,g,r);if(M(o,v)<-be())return[]}return[pe(g)]}function ar({start:n,end:e,type:t},i){const r=V(lt,i,n),s=V(ct,e,n),a=We(zt,s,r),o=St(a)/St(s),l=be();if(o<l)switch(t){case P.LINE:return[pe(i)];case P.RAY:return M(s,r)<-l?[]:[pe(i)]}return[]}function Dt(n,e,t,i){const[r,s]=n,[a,o]=t,l=a-r,c=o-s,u=l*l+c*c,d=Math.sqrt(u);if(d>e+i)return[];if(d<Math.abs(e-i))return[];if(E(d,0)&&E(e,i))return[];const p=(e*e-i*i+u)/(2*d),g=Math.sqrt(e*e-p*p),v=g*c/d,m=g*l/d,[_,x]=Sn(Oe,n,t,p/d);return E(v,m)?[ke(_,x)]:[ke(_+v,x-m),ke(_-v,x+m)]}function Ke(n,e,{start:t,end:i,type:r}){return U(n.start,t[0],t[1],e),U(n.end,i[0],i[1],e),n.type=cr[r],n}function qn(n,e){return E(n[2],e[2])}function E(n,e){return si(Math.abs(n-e),0,be())}function lr(n,e){return e.filter(t=>he(n,t))}function he(n,e){return zi(n,e)}var C;(function(n){n[n.PLANE=0]="PLANE",n[n.HALF_PLANE=1]="HALF_PLANE"})(C||(C={}));const cr={[C.PLANE]:P.LINE,[C.HALF_PLANE]:P.RAY},Oe=G(),at=G(),lt=y(),ct=y(),zt=y(),jn=y(),Hn=y(),kn=y(),$t=y(),ur=O(),qt={start:y(),end:y(),type:P.LINE},dr={start:y(),end:y(),type:P.LINE};class z{intersect(e){return ee(this,e)}closestPoints(e){return[this.closestTo(e)]}}class Pe extends z{constructor(e){super(),this.point=e}equals(e){return this===e||q(e)&&w(this.point,e.point)}closestTo(){return Le(this.point)}}class jt extends z{constructor(e,t,i){super(),this.start=e,this.end=t,this.lineLike={start:e,end:t,type:i}}equals(e){return this===e||B(e)&&this.lineLike.type===e.lineLike.type&&w(this.start,e.start)&&w(this.end,e.end)}closestTo(e){const t=I();return Ot(e,this.lineLike,t),t}}class Ht extends jt{constructor(e,t){super(e,t,P.LINE)}}class hr extends jt{constructor(e,t){super(e,t,P.RAY)}}class Gn extends z{constructor(e){super(),this.constraints=e}equals(e){return this===e||Tt(e)&&oi(this.constraints,e.constraints,(t,i)=>t.equals(i))}closestTo(e){let t,i=1/0;for(const r of this.constraints){const s=r.closestTo(e),a=Be(e,s);a<i&&(i=a,t=s)}return Le(t??e)}closestPoints(e){return this.constraints.flatMap(t=>t===this?[]:t.closestPoints(e))}}class Un extends z{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||X(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}closestTo(e){const t=I();return On(e,this.center,this.radius,t),t}}class kt extends z{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||ne(e)&&w(this.center,e.center)&&this.radius===e.radius}closestTo(e){const t=I();return On(e,this.center,this.radius,t),t[2]=this.center[2],t}asCircle(){return new Gt(Le(this.center),this.radius,Z(0,0,1))}}class Gt extends z{constructor(e,t,i,r=void 0){super(),this.center=e,this.radius=t,this.normal=i,this.slicePlane=r}equals(e){return this===e||ae(e)&&w(this.center,e.center)&&w(this.normal,e.normal)&&this.radius===e.radius}closestTo(e){const{center:t,radius:i}=this;bn(this.getPlane(pr),e,ft);const r=V(ft,ft,t),s=ai(r);if(E(s,0))return Le(e);const a=i/Math.sqrt(s),o=I();T(o,t,r,a);const{slicePlane:l}=this;if(l&&!he(l,o)){const c=Zt(l,this);return(c==null?void 0:c.closestTo(e))??Le(e)}return o}getPlane(e=O()){return rt(this.center,this.normal,e)}}const ft=y(),pr=O();class fr extends z{constructor(e){super(),this.z=e}equals(e){return this===e||te(e)&&this.z===e.z}closestTo(e){return Z(e[0],e[1],this.z)}getPlane(e=O()){return U(tn,0,0,this.z),rt(tn,fi,e)}}const tn=y();class Ut extends z{constructor(e,t,i){super(),this.start=e,this.end=t,this.planeLike={start:e,end:t,type:i}}equals(e){return this===e||Y(e)&&this.planeLike.type===e.planeLike.type&&w(this.start,e.start)&&w(this.end,e.end)}closestTo(e){const t=I();return In(e,this.planeLike,t),t}closestEndTo(e){const{start:t,end:i}=this.planeLike;return Math.sign(Ie(oe(gr,i,t),oe(yr,e,t)))>0?this.end:this.start}getPlane(e=O()){const t=nt(nn,this.end);return t[2]+=1,ji(this.start,this.end,t,e)}getSlicePlane(e=O()){const{start:t,end:i,type:r}=this.planeLike;if(r===C.PLANE)return;const s=U(nn,t[0],t[1],0),a=U(rn,i[0],i[1],0),o=Ce(rn,a,s);return rt(s,o,e),e}}const gr=G(),yr=G(),nn=y(),rn=y();class Zn extends Ut{constructor(e,t){super(e,t,C.HALF_PLANE)}}class Wn extends Ut{constructor(e,t){super(e,t,C.PLANE)}}class vr extends z{constructor(e,t){super(),this.sphere=ki(e,t)}equals(e){return this===e||ie(e)&&Gi(this.sphere,e.sphere)}closestTo(e){const t=I();return Ui(this.sphere,e,t),t}get center(){return Zi(this.sphere)}get radius(){return this.sphere[3]}}class Bn extends z{constructor(e,t,i){super(),this.start=e,this.end=t,this.getZ=i,this.planeLike={start:e,end:t,type:C.PLANE}}equals(e){return this===e||Qe(e)&&w(this.start,e.start)&&w(this.end,e.end)&&this.getZ===e.getZ}closestTo(e){return xr(this,e)}addIfOnTheGround(e,t){for(const i of t){const r=this.getZ(i[0],i[1])??0;E(i[2],r)&&(i[2]=r,e.push(i))}}}class mr extends z{constructor(e,t,i){super(),this._x=e,this._y=t,this._z=i}equals(e){return this===e||zr(e)&&this._x===e._x&&this._y===e._y&&this._z===e._z}closestTo([e,t,i]){return Nn(this._x??e,this._y??t,this._z??i)}}class _r extends z{constructor(e,t,i,r,s){super(),this._origin=e,this._spatialReference=t,this._distanceMeters=i,this._elevationMeters=r,this._directionDegrees=s}equals(e){return this===e||Dr(e)&&Kt(this._origin,e._origin)&&this._spatialReference===e._spatialReference&&this._distanceMeters===e._distanceMeters&&this._elevationMeters===e._elevationMeters&&this._directionDegrees===e._directionDegrees}closestTo([e,t,i]){return wn(Ne,e,t),Kt(Ne,this._origin)||this._applyDirectionAndDistance(Ne),Nn(Ne[0],Ne[1],this._elevationMeters??i)}_applyDirectionAndDistance(e){if(this._directionDegrees!=null&&this._distanceMeters!=null)Je(e,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(this._directionDegrees!=null)Sr(e,this._origin,this._directionDegrees,e,this._spatialReference);else if(this._distanceMeters!=null){const{azimuth:t}=Ft(Er,this._origin,e,this._spatialReference);Je(e,this._origin,t??0,this._distanceMeters,this._spatialReference)}}}const Ne=[0,0],Er=new Vt;function Sr(n,e,t,i,r){let{azimuth:s,distance:a}=Ft(wr,e,i,r);s??(s=0);let o=a*Math.cos((s-t)*gi);o=Math.max(0,o),Je(n,e,t,o,r)}const wr=new Vt;function xr(n,e){const t=I();return In(e,n.planeLike,t),t[2]=n.getZ(t[0],t[1])??Xn,t}function ee(n,e){if(Tt(n)){const t=[];for(const i of n.constraints){const r=i.intersect(e);r&&t.push(r)}return Wt(t)}if(Tt(e))return ee(e,n);if(Qe(n))return sn(n,e);if(Qe(e))return sn(e,n);if(q(n)){const{point:t}=n;if(q(e))return w(t,e.point)?n:void 0;const i=e.closestTo(t);return di(i,t)?n:void 0}if(B(n)){if(q(e))return ee(e,n);if(B(e))return k(zn(n.lineLike,e.lineLike));if(te(e))return br(n,e);if(Y(e))return k(Vn(e.planeLike,n.lineLike));if(X(e))return k(Dn(n.lineLike,e.center,e.radius));if(ae(e))return k(or(n.lineLike,e));if(ne(e))return Lr(n,e);if(ie(e))return $r(n,e)}else if(te(n)){if(q(e)||B(e))return ee(e,n);if(te(e))return Tr(n,e);if(Y(e))return Pr(n,e);if(X(e))return Rr(n,e);if(ae(e))return Mr(n,e);if(ne(e))return Nr(n,e);if(ie(e))return Ar(n,e)}else if(Y(n)){if(q(e)||B(e)||te(e))return ee(e,n);if(Y(e))return gt(Cn(n.planeLike,e.planeLike));if(X(e))return gt(It(n.planeLike,e.center,e.radius));if(ae(e))return Vr(n,e);if(ne(e))return Fr(n,e);if(ie(e))return Cr(n,e)}else if(X(n)){if(q(e)||B(e)||te(e)||Y(e))return ee(e,n);if(X(e))return gt(Dt(n.center,n.radius,e.center,e.radius));if(ae(e))return void 0;if(ne(e))return Ir(n,e);if(ie(e))return void 0}else if(ae(n)){if(q(e)||B(e)||te(e)||Y(e)||X(e))return ee(e,n);if(ae(e))return void 0;if(ne(e))return e.asCircle(),void 0;if(ie(e))return void 0}else if(ne(n)){if(q(e)||B(e)||te(e)||Y(e)||X(e)||ae(e))return ee(e,n);if(ne(e))return Or(e,n);if(ie(e))return void 0}else if(ie(n)){if(q(e)||B(e)||te(e)||Y(e)||X(e)||ne(e))return ee(e,n);if(ie(e))return void 0}}const br=(()=>{const n=O();return(e,t)=>{const{start:i,end:r}=e;if(qn(i,r)&&E(i[2],t.z))return e;const s=I();return xn(t.getPlane(n),i,r,s)?new Pe(s):void 0}})();function Lr({lineLike:n},{center:e,radius:t}){const i=e[2];return k(Dn(n,e,t).filter(r=>E(r[2],i)))}function $r({lineLike:n},{sphere:e}){return k(Hi(e,n.start,n.end))}const Zt=(()=>{const n=hi(),e=y(),t=y();return(i,r,s)=>{const{normal:a,center:o,radius:l}=r;$n(a,e,t);const c=Ln(i),u=l*M(c,e),d=l*M(c,t);li(n,o[0],o[1],o[2],1);const p=ci(i,n),g=Math.hypot(u,d),v=E(g,0);if(E(bt(i,o),0)){if(v)return r;if(E(l,0))return!s||he(s,o)?new Pe(Le(o)):void 0;We(e,c,a),ui(e,e);const dt=new Array,De=pe(o);T(De,De,e,l),s&&!he(s,De)||dt.push(De);const ze=pe(o);return T(ze,ze,e,-l),s&&!he(s,ze)||dt.push(ze),k(dt)}if(v)return;const m=-p/g;if(Math.abs(m)>1||E(m,1))return;const _=Math.atan(u/d),x=pi(m)-_,ge=Math.PI-x,A=new Array,K=y();T(K,o,e,l*Math.cos(x)),T(K,K,t,l*Math.sin(x)),A.push(K);const W=y();return T(W,o,e,l*Math.cos(ge)),T(W,W,t,l*Math.sin(ge)),A.push(W),k(s?lr(s,A):A)}})();function Tr(n,e){return E(n.z,e.z)?n:void 0}function Pr({z:n},{planeLike:e}){const[t,i]=e.start,[r,s]=e.end,a=Z(t,i,n),o=Z(r,s,n);return e.type===C.PLANE?new Ht(a,o):new hr(a,o)}function Rr(n,e){const[t,i]=e.center;return new kt(Z(t,i,n.z),e.radius)}function Nr(n,e){return E(e.center[2],n.z)?e:void 0}const Mr=(()=>{const n=O();return(e,t)=>Zt(e.getPlane(n),t,t.slicePlane)})();function Ar(n,{center:e,radius:t}){const i=Math.abs(e[2]-n.z);if(i>t&&!E(i,t))return;const r=Z(e[0],e[1],n.z),s=Math.sqrt(t**2-i**2);return E(s,0)?void 0:new kt(r,s)}const Fr=(()=>{const n=O();return(e,{center:t,radius:i})=>{const r=It(e.planeLike,t,i),s=t[2];e.getSlicePlane(n);const a=new Array;for(const[o,l]of r){const c=[o,l,s];he(n,c)&&a.push(c)}return k(a)}})(),Vr=(()=>{const n=O(),e=O();return(t,i)=>Zt(t.getPlane(n),i,t.getSlicePlane(e))})(),Cr=(()=>{const n=O();return(e,{center:t,radius:i})=>{const r=e.getPlane(n),s=qi(r,t),a=Math.abs(s);if(a>i&&!E(a,i))return;const o=Math.sqrt(i**2-s**2);if(E(o,0)){const u=I();return bn(r,t,u),new Pe(u)}const l=I(),c=pe(Ln(r));return T(l,t,c,s),new Gt(l,o,c,e.getSlicePlane())}})();function Ir(n,e){const t=me(n.center,e.center);return E(t,0)&&E(n.radius,e.radius)?e:Yn(Dt(n.center,n.radius,e.center,e.radius),e.center[2])}function Or(n,e){if(!qn(n.center,e.center))return;const t=me(n.center,e.center);return E(t,0)&&E(n.radius,e.radius)?n:Yn(Dt(n.center,n.radius,e.center,e.radius),n.center[2])}function sn(n,e){const{planeLike:t,getZ:i}=n,r=new Array;if(q(e))n.addIfOnTheGround(r,sr(t,e.point));else if(B(e))n.addIfOnTheGround(r,Vn(t,e.lineLike));else if(X(e))for(const[s,a]of It(t,e.center,e.radius)){const o=i(s,a);o!=null&&r.push(Ue(s,a,o))}else if(Y(e)||Qe(e))for(const[s,a]of Cn(t,e.planeLike)){const o=i(s,a)??Xn;r.push(Ue(s,a,o))}return k(r)}function gt(n){return Wt(n.map(([e,t])=>{const i=Z(e,t,0),r=Z(e,t,1);return new Ht(i,r)}))}function k(n){return Wt(n.map(e=>e?new Pe(e):void 0))}function Yn(n,e){return k(n.map(([t,i])=>[t,i,e]))}function Wt(n){if(n.length!==0)return n.length===1?n[0]??void 0:new Gn(n.filter(vn))}function Tt(n){return n instanceof Gn}function q(n){return n instanceof Pe}function B(n){return n instanceof jt}function te(n){return n instanceof fr}function Y(n){return n instanceof Ut}function X(n){return n instanceof Un}function ne(n){return n instanceof kt}function ae(n){return n instanceof Gt}function ie(n){return n instanceof vr}function Qe(n){return n instanceof Bn}function Dr(n){return n instanceof _r}function zr(n){return n instanceof mr}const Xn=0;var j;function qr(n,e){if(n==null||e==null)return;const t=Pt(n,e);return t!=null?_e(t,"radians","geographic"):void 0}(function(n){n.Absolute="absolute",n.Relative="relative",n.RelativeBilateral="relative-bilateral"})(j||(j={}));const Pt=(()=>{const n=y(),e=y();return(t,i)=>(U(n,t.x,t.y,t.z??0),U(e,i.x,i.y,i.z??0),Ve(n,e,t.spatialReference,i.spatialReference))})(),Ve=(()=>{const n=G(),e=y(),t=y();return(i,r,s,a)=>{if(w(i,r))return;const o=xt(s),l=xt(a);if(o&&l&&yi(o,l)&&Xe(i,s,e,o)&&Xe(r,a,t,l)){const{azimuth:u}=Ft(Hr,e,t,o);return u!=null?Nt(u,"degrees","radians"):void 0}n[0]=r[0]-i[0],n[1]=r[1]-i[1];let c=Ci(Di,n);return n[0]<0&&(c=kr-c),c}})();function Gs(n,e,t,i=j.Absolute){if(e&&t)switch(i){case j.Absolute:return qr(e,t);case j.Relative:return an(on(n,e,t),j.Relative);case j.RelativeBilateral:return an(on(n,e,t),j.RelativeBilateral)}}function on(n,e,t){if(!n||!e||!t)return;const i=Pt(n,e),r=Pt(e,t);return i!=null&&r!=null?_e(r-i,"radians","geographic"):void 0}function an(n,e){if(n!=null)switch(e){case j.Absolute:return jr(n);case j.Relative:{const t=et(n);let i=ln.normalize(t,0,!0);return i===-180&&(i=180),_e(i,"degrees","geographic")}case j.RelativeBilateral:{const t=et(n),i=Math.abs(ln.normalize(t,0,!0));return _e(i,"degrees","geographic")}}}function jr(n){const e=et(n),t=Gr.normalize(e,0,!0);return _e(t,"degrees","geographic")}const Jn=(()=>{const n=y();return(e,t,i,r,s,a="geodesic")=>{nt(n,t);const o=et(s);if(a==="geodesic"){const g=xt(i);if(g&&Xe(n,i,n,g))return Je(e,n,o,r,g),e[2]=t[2],!!Xe(e,g,e,i)}const l=Ct(o,"geographic","arithmetic"),c=Nt(l,"degrees","radians"),u=t[0]+r*Math.cos(c),d=t[1]+r*Math.sin(c),p=t[2];return U(e,u,d,p),!0}})();function et(n){if(n!=null)return Ct(Kn(n),n.rotationType,"geographic")}function Us(n){if(n!=null)return Ct(Kn(n),n.rotationType,"arithmetic")}function Kn(n){return Nt(n.value,n.unit,"degrees")}const Hr=new Vt,kr=2*Math.PI,Gr=Qi,ln=new er(-180,180);function Se(n,e){const t=n.x-e.x,i=n.y-e.y;return t*t+i*i}function Ur(n,e){return Math.sqrt(Se(n,e))}function Bt(n,e){e.sort((t,i)=>Be(t.targetPoint,n)-Be(i.targetPoint,n))}var D;function Zs({point:n,distance:e,returnEdge:t,vertexMode:i,coordinateHelper:{spatialReference:r},filter:s},a,o){return o=o!=null?o.clone():new vi({where:"1=1"}),s&&(o.geometry=s.geometry,o.distance=s.distance,o.spatialRelationship=s.spatialRelationship,o.where=Mt(o.where,s.where),o.timeExtent=mi(o.timeExtent,s.timeExtent),o.objectIds=Zr(o.objectIds,s.objectIds)),{point:it(n[0],n[1],n[2],r.toJSON()),mode:a,distance:e,returnEdge:t,vertexMode:i,query:o.toJSON()}}function Zr(n,e){return n||e?e?n?Array.from(_i(new Set(n),new Set(e))):e:n:null}function tt(n,e,t){return{left:L(n.leftVertex.pos,e,t),right:L(n.rightVertex.pos,e,t)}}function Ws(n){return n.createQuery()}(function(n){n[n.TARGET=0]="TARGET",n[n.REFERENCE=1]="REFERENCE",n[n.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"})(D||(D={}));const cn=Symbol("snapping-toggle");function Bs(n,e=()=>{}){const t=ve(()=>({view:n.view,snappingOptions:n.snappingOptions}),({view:i,snappingOptions:r})=>{if(n.removeHandles(cn),!i||!r)return;const s=Xi.TOOL,a=[i.on("key-down",o=>{o.key!==Qt.toggle||o.repeat||(r.enabledToggled=!0,e())},s),i.on("key-up",o=>{o.key===Qt.toggle&&(r.enabledToggled=!1,e())},s),i.on("pointer-move",o=>{const l=o.native.ctrlKey;r.enabledToggled!==l&&(r.enabledToggled=l,e())},s)];n.addHandles(a,cn)},Ye);n.addHandles(t)}function un(n){var e;return Ji(n)&&"utilityNetworks"in n&&!!((e=n.utilityNetworks)!=null&&e.length)}let le=class extends Te{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new xe}};h([f({constructOnly:!0})],le.prototype,"layer",void 0),h([f()],le.prototype,"enabled",void 0),h([f()],le.prototype,"updating",void 0),h([f()],le.prototype,"availability",void 0),h([f()],le.prototype,"sublayerSources",void 0),le=h([fe("esri.views.interactive.snapping.FeatureSnappingLayerSource")],le);const Qn=le;let R=class extends Te{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.attributeRulesEnabled=!1,this.featureSources=new xe,this.distance=se.distance,this.touchSensitivityMultiplier=se.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){var l;const e=this.featureSources;e.some(dn)&&mn.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const t=e.filter(Yr),i=((l=this._get("_effectiveFeatureSources"))==null?void 0:l.filter(dn))??new xe;for(const c of t){const u=i.find(d=>d.layer===c.layer.parent);if(u)u.sublayerSources.includes(c)||u.sublayerSources.add(c);else if(c.layer.parent){const d=new Qn({layer:c.layer.parent});d.sublayerSources.add(c),i.add(d)}}for(const c of i){const u=c.sublayerSources.filter(d=>!t.includes(d));c.sublayerSources.removeMany(u)}i.removeMany(i.filter(c=>c.sublayerSources.length===0));const r=e.filter(Br),s=this._get("_effectiveFeatureSources")??new xe,{added:a,removed:o}=Ei(s.toArray(),[...r,...i]);return s.removeMany(o),s.addMany(a),s}};h([f()],R.prototype,"enabled",void 0),h([f()],R.prototype,"enabledToggled",void 0),h([f()],R.prototype,"forceDisabled",void 0),h([f()],R.prototype,"selfEnabled",void 0),h([f()],R.prototype,"featureEnabled",void 0),h([f()],R.prototype,"attributeRulesEnabled",void 0),h([f({type:xe.ofType(Qn)})],R.prototype,"featureSources",void 0),h([f()],R.prototype,"distance",void 0),h([f()],R.prototype,"touchSensitivityMultiplier",void 0),h([f({readOnly:!0})],R.prototype,"effectiveEnabled",null),h([f({readOnly:!0})],R.prototype,"effectiveSelfEnabled",null),h([f({readOnly:!0})],R.prototype,"effectiveFeatureEnabled",null),h([f({readOnly:!0})],R.prototype,"_effectiveFeatureSources",null),R=h([fe("esri.views.interactive.snapping.SnappingOptions")],R);const Wr=R;function dn(n){return n.layer.type==="subtype-group"}function Br(n){return n.layer.type!=="subtype-group"}function Yr(n){return n.layer.type==="subtype-sublayer"}let F=class extends Te{set attributeRulesEnabled(e){this._set("attributeRulesEnabled",e),e&&this.loadRules()}get layerView(){var e,t;return(t=(e=this.view)==null?void 0:e.allLayerViews)==null?void 0:t.find(i=>i.layer===this.layer)}get valid(){const{_valid:e,snappingSource:t,layer:i}=this;return!(!t||!i)&&e}get subtypeFilter(){var s,a;const{layer:e,snappingSource:t}=this;if(!qe(e)||!((s=e.subtypes)!=null&&s.length)||!t)return{mode:"not-in-use",filter:null};const i=t.layerSource.sublayerSources.filter(o=>{var l;return o.enabled&&o.layer.visible&&Ki((l=this.view)==null?void 0:l.scale,o.layer.effectiveScaleRange.minScale,o.layer.effectiveScaleRange.maxScale)}).map(o=>o.layer.subtypeCode);if(!i.length)return{mode:"none-visible",filter:null};if(i.length===e.subtypes.length)return{mode:"all-visible",filter:null};const r=((a=e.fieldsIndex.get(e.subtypeField))==null?void 0:a.name)??e.subtypeField;return i.length===1?{mode:"in-use",filter:`${r} = ${i.getItemAt(0)}`}:{mode:"in-use",filter:`${r} IN (${i.join(", ")})`}}get floorFilter(){const{view:e,layer:t}=this;return e&&t?Yi({view:e,layer:t}):null}constructor(e){super(e),this.layer=null,this.snappingSource=null,this.rulesTable=null,this._valid=null}initialize(){if(!this.snappingSource||!this.layer)return void(this._valid=!1);const{layer:e,snappingSource:t}=this;if("refresh"in e){const i=e;this.addHandles(i.on("refresh",()=>t.refresh()))}this.loadRules(),this.addHandles([ve(()=>t.updating,i=>t.layerSource.updating=i,Ye),ve(()=>t.availability,i=>t.layerSource.availability=i,Ye)])}getFetchCandidatesParameters(e,t,i){var p,g,v,m,_;if(!this.valid)return[];const{layer:r,layerView:s,floorFilter:a,rulesTable:o,subtypeFilter:l}=this,c={distance:i,mode:((p=this.view)==null?void 0:p.type)??"2d",point:e,coordinateHelper:t.coordinateHelper,...Xr(),filter:s&&"filter"in s?s.filter:null};if(a&&(c.filter=yt(c.filter,a)),l.mode!=="not-in-use"&&l.mode!=="all-visible"){if(l.mode==="none-visible")return[];c.filter?c.filter.where=Mt(c.filter.where,l.mode):c.filter=new He({where:l.filter})}if(!this.attributeRulesEnabled)return[c];const u=t.feature,d=((g=u==null?void 0:u.sourceLayer)==null?void 0:g.type)==="subtype-sublayer"?u.sourceLayer.parent:u==null?void 0:u.sourceLayer;if(o&&u&&un((v=this.view)==null?void 0:v.map)&&(ht(r)||qe(r))&&r.layerId&&(ht(d)||qe(d))&&((m=this.view.map.utilityNetworks)!=null&&m.find(x=>x.isUtilityLayer(d)))){if(o.loadStatus!=="loaded")return[];const x=[],ge=r.layerId,A=(_=o.getFeatureSQL(d,u))==null?void 0:_[ge];if(!A)return[];const K=A.anyVertex;let W=A.endVertex;return W&&K&&W===K&&(W=""),W&&x.push({...c,returnEdge:!1,vertexMode:"ends",filter:yt(c.filter,W)}),K&&x.push({...c,returnEdge:!1,vertexMode:"all",filter:yt(c.filter,K)}),x}return[c]}async loadRules(){var r,s,a;this._valid=null;const{layer:e,view:t,attributeRulesEnabled:i}=this;if(i&&e&&t&&un(t==null?void 0:t.map)&&(ht(e)||qe(e)))try{await Promise.allSettled(((r=t.map.utilityNetworks)==null?void 0:r.map(l=>l.load()))??[]);const o=(s=t.map.utilityNetworks)==null?void 0:s.find(l=>l.isUtilityLayer(e));o&&(this.rulesTable=await o.getRulesTable(),await((a=this.rulesTable)==null?void 0:a.load()))}catch{return this._valid=!1,void mn.getLogger("esri.views.interactive.snapping.FeatureSnappingSourceInfo").error("Failed to load rules table for snapping source",e.title)}this._valid=!0}remove(){this.destroy()}destroy(){var e;(e=this.snappingSource)==null||e.destroy()}};function Xr(){return{returnEdge:!0,vertexMode:"all"}}function yt(n,e){return n==null?new He({where:e}):n.where?new He({where:Mt(n.where,e)}):new He({where:e})}h([f({constructOnly:!0})],F.prototype,"layer",void 0),h([f({constructOnly:!0})],F.prototype,"snappingSource",void 0),h([f({constructOnly:!0})],F.prototype,"view",void 0),h([f({value:!1})],F.prototype,"attributeRulesEnabled",null),h([f()],F.prototype,"layerView",null),h([f()],F.prototype,"rulesTable",void 0),h([f()],F.prototype,"valid",null),h([f()],F.prototype,"subtypeFilter",null),h([f()],F.prototype,"floorFilter",null),h([f()],F.prototype,"_valid",void 0),F=h([fe("esri.views.interactive.snapping.FeatureSnappingSourceInfo")],F);class Re{constructor(e,t,i,r){this.targetPoint=e,this.constraint=t,this.isDraped=i,this.domain=r}}let Yt=class extends Re{constructor({targetPoint:e,objectId:t,constraint:i,isDraped:r}){super(e,i,r,$.FEATURE),this.objectId=t}},ei=class extends Yt{constructor(e){super({...e,isDraped:!0,constraint:new Bn(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new J(D.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},ti=class extends Yt{constructor(e){super({...e,constraint:new Ht(e.edgeStart,e.edgeEnd)})}get hints(){return[new J(D.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}};class Xt extends Re{constructor({targetPoint:e,constraint:t,previousVertex:i,otherVertex:r,otherVertexType:s,isDraped:a,selfSnappingType:o,objectId:l,domain:c}){super(e,t,a,c??$.SELF),this.previousVertex=i,this.otherVertex=r,this.otherVertexType=s,this.selfSnappingType=o??ue.None,this.objectId=l??null}get hints(){const e=this.previousVertex,t=this.otherVertexType===$e.CENTER?this.otherVertex:this.targetPoint,i=this.otherVertexType===$e.CENTER?this.targetPoint:this.otherVertex;return[new J(D.TARGET,t,i,this.isDraped,this.domain),new J(D.REFERENCE,e,t,this.isDraped,this.domain),new ot(this.previousVertex,t,i,this.isDraped,this.domain)]}}var $e,ue;(function(n){n[n.NEXT=0]="NEXT",n[n.CENTER=1]="CENTER"})($e||($e={})),function(n){n[n.None=0]="None",n[n.LastVertex=1]="LastVertex",n[n.FirstVertex=2]="FirstVertex",n[n.ExistingEdge=3]="ExistingEdge"}(ue||(ue={}));let ce=class extends Te{get updating(){return this._snappingSources.some(e=>{var t;return(e==null?void 0:e.valid)==null||e.valid===!0&&((t=e.snappingSource)==null?void 0:t.updating)===!0})||this._updatingHandles.updating}constructor(e){super(e),this.options=null,this._domain=$.FEATURE,this._updatingHandles=new Ii,this._sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null},notes:{module:null,loader:null},scene:{module:null,loader:null}}}initialize(){const e=Si(()=>{var t;return(t=this.options)==null?void 0:t._effectiveFeatureSources},(t,i)=>this._createSourceInfo(t,i));this._snappingSources=e,this.addHandles([wi(e),ve(()=>{var t;return{rulesEnabled:!!((t=this.options)!=null&&t.attributeRulesEnabled),sources:this._snappingSources.filter(vn)}},({rulesEnabled:t,sources:i})=>{for(const r of i)r.attributeRulesEnabled=t},wt)])}destroy(){this._set("options",null),this._updatingHandles.destroy()}async fetchCandidates(e,t,i,r){var l,c,u;if(!(t&this._domain&&this.options!=null&&this.options.effectiveFeatureEnabled))return[];const s=[],a=this._computeScreenSizeDistanceParameters(e,i);for(const d of this._snappingSources){if(!(d!=null&&d.valid)||!((c=(l=d.snappingSource)==null?void 0:l.layerSource)!=null&&c.enabled)||(u=d.layerView)!=null&&u.suspended)continue;const p=d.getFetchCandidatesParameters(e,i,a);for(const g of p)s.push(d.snappingSource.fetchCandidates(g,r).then(v=>v.filter(m=>!this._candidateIsExcluded(d.snappingSource,m,i.excludeFeature))))}const o=(await xi(s)).flat();return this._addRightAngleCandidates(o,e,a,i),pt(r),Bt(e,o),o}_addRightAngleCandidates(e,t,i,r){var d,p,g,v,m,_,x,ge;const s=r.vertexHandle!=null?(p=(d=r.vertexHandle.rightEdge)==null?void 0:d.rightVertex)==null?void 0:p.pos:r.editGeometryOperations!=null&&r.editGeometryOperations.data.type==="polygon"?(v=(g=r.editGeometryOperations.data.components[0])==null?void 0:g.getFirstVertex())==null?void 0:v.pos:null,a=r.vertexHandle!=null?(_=(m=r.vertexHandle.leftEdge)==null?void 0:m.leftVertex)==null?void 0:_.pos:r.editGeometryOperations!=null?(ge=(x=r.editGeometryOperations.data.components[0])==null?void 0:x.getLastVertex())==null?void 0:ge.pos:null,{view:o}=this,l=L(s,o,r),c=L(a,o,r),u=e.length;for(let A=0;A<u;A++)this._addRightAngleCandidate(e[A],c,t,i,e),this._addRightAngleCandidate(e[A],l,t,i,e)}_addRightAngleCandidate(e,t,i,r,s){if(t==null||!Jr(e))return;const a=e.constraint.closestTo(t),o=(a[0]-i[0])/r.x,l=(a[1]-i[1])/r.y,{start:c,end:u}=e.constraint;if(o*o+l*l<=1){const d=me(a,c)>me(a,u)?c:u,p=new Xt({targetPoint:de(a),otherVertex:t,otherVertexType:$e.NEXT,previousVertex:d,constraint:new Zn(t,a),objectId:e.objectId,isDraped:e.isDraped,domain:$.FEATURE});s.push(p)}}_computeScreenSizeDistanceParameters(e,t){let i=this.options!=null?this.options.distance*(t.pointer==="touch"?this.options.touchSensitivityMultiplier:1):0;return this.view==null?{x:i,y:i,z:i,distance:i}:this.view.type==="2d"?(i*=this.view.resolution,{x:i,y:i,z:i,distance:i}):this._computeScreenSizeDistanceParameters3D(e,i,this.view,t)}_computeScreenSizeDistanceParameters3D(e,t,i,r){const{spatialReference:s}=r;i.renderCoordsHelper.toRenderCoords(e,s,hn);const a=i.state.camera.computeScreenPixelSizeAt(hn),o=a*i.renderCoordsHelper.unitInMeters,l=o/_n(s),c=o/bi(s),u=t*l,d=t*c,p=N(e,s,b,i),g=p?vt(p,e,l,0,0,i,r):0,v=p?vt(p,e,0,l,0,i,r):0,m=p?vt(p,e,0,0,c,i,r):0;return{x:g===0?0:u/g,y:v===0?0:u/v,z:m===0?0:d/m,distance:a*t}}_candidateIsExcluded(e,t,i){if(i==null)return!1;const r=this._getCandidateObjectId(t);if(r==null)return!1;const s=e.layerSource.layer;return s.type==="graphics"?i.uid===r:i.sourceLayer===s&&!(!i.attributes||!("objectIdField"in s))&&i.attributes[s.objectIdField]===r}_getCandidateObjectId(e){return e instanceof Yt?e.objectId:null}async _createSourceInfo(e,t){const i=e.layer;i.loaded||(await i.load(),pt(t));const{view:r}=this,s=await this._createFeatureSnappingSourceType(e);return pt(t),new F(s==null?{}:{snappingSource:s,view:r,layer:i})}async _createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"oriented-imagery":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e);case"map-notes":return this._createFeatureSnappingSourceMapNotesLayer(e);case"scene":case"building-scene":return this._createFeatureSnappingSourceSceneLayer(e)}return null}async _createFeatureSnappingSourceSceneLayer(e){const{view:t}=this;return t==null||t.type!=="3d"?null:new(await this._getSourceModule("scene")).SceneLayerSnappingSource({layerSource:e,view:t})}async _createFeatureSnappingSourceFeatureLayer(e){var t;switch((t=e.layer.source)==null?void 0:t.type){case"feature-layer":case"oriented-imagery":return new(await this._getSourceModule("featureService")).FeatureServiceSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e});case"memory":case"csv":case"geojson":case"wfs":return e.layer.geometryType==="mesh"?null:new(await this._getSourceModule("featureCollection")).FeatureCollectionSnappingSource({layerSource:e,view:this.view})}return null}async _createFeatureSnappingSourceGraphicsLayer(e){return new(await this._getSourceModule("graphics")).GraphicsSnappingSource({getGraphicsLayers:()=>[e.layer],spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _createFeatureSnappingSourceMapNotesLayer(e){return new(await this._getSourceModule("notes")).GraphicsSnappingSource({getGraphicsLayers:()=>{var t;return((t=e.layer.sublayers)==null?void 0:t.toArray())??[]},spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _getSourceModule(e){const t=this._sourceModules[e];if(t.loader==null){const i=this._loadSourceModule(e),r={module:null,loader:i};this._sourceModules[e]=r;const s=await i,a={module:s,loader:i};return this._sourceModules[e]=a,s}return t.module==null?t.loader:t.module}_loadSourceModule(e){const t=this._updatingHandles;switch(e){case"featureService":return t.addPromise(je(()=>import("./FeatureServiceSnappingSource-B6rEpCAs.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41])));case"featureCollection":return t.addPromise(je(()=>import("./FeatureCollectionSnappingSource-BBAUqTpn.js"),__vite__mapDeps([42,1,2,3,5,18,19,20,43,23,24,27,4,13,28,9,10,11,12,14,8,29,30,31,32,33,34,16,35,36,37,38,39,40,41])));case"graphics":case"notes":return t.addPromise(je(()=>import("./GraphicsSnappingSource-Dt-aiCHP.js"),__vite__mapDeps([44,1,2,3,4,45,46,47,48,49,50,51,52,53,54,39,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,32,26,5,74,75,18,19,20,43,23,24,27,13,28,9,10,11,12,14,8,29,30,31,33,34,16,35,36,37,38,40,41])));case"scene":return t.addPromise(je(()=>import("./SceneLayerSnappingSource-BlAASW2P.js"),__vite__mapDeps([76,1,2,4,77,22,78,79,80,27,81,82,13,83,84,85,86,87,88,89,90,8,9,10,11,12,14,19,20,5,23,24,28,29,30,31,32,33,34,16,35,36,37,38,39,40,41])))}}get test(){}};function Jr(n){return(n instanceof ti||n instanceof ei)&&!Kr(n)}function Kr({constraint:{start:n,end:e}}){const t=Be(n,e),i=me(n,e);return t<be()||i/t<es}function vt(n,e,t,i,r,s,{spatialReference:a}){const o=nt(Qr,e);o[0]+=t,o[1]+=i,o[2]+=r;const l=N(o,a,b,s);return l?Ur(l,n):1/0}h([f({constructOnly:!0})],ce.prototype,"spatialReference",void 0),h([f({constructOnly:!0})],ce.prototype,"view",void 0),h([f()],ce.prototype,"options",void 0),h([f({readOnly:!0})],ce.prototype,"updating",null),h([f()],ce.prototype,"_snappingSources",void 0),ce=h([fe("esri.views.interactive.snapping.FeatureSnappingEngine")],ce);const hn=y(),Qr=y(),es=1e-4;class ut{constructor(e,t){this.view=e,this.options=t,this.squaredShortLineThreshold=se.shortLineThreshold*se.shortLineThreshold}snap(e,t){return t.vertexHandle!=null?t.vertexHandle.type!=="vertex"?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold(L(e.leftVertex.pos,this.view,t),L(e.rightVertex.pos,this.view,t),t)}exceedsShortLineThreshold(e,t,{spatialReference:i}){return this.squaredShortLineThreshold===0||Se(N(t,i,b,this.view),N(e,i,b,this.view))>this.squaredShortLineThreshold}isVertical(e,t,{spatialReference:i}){const r=_n(i);return At(e,t)*r<se.verticalLineThresholdMeters}squaredProximityThreshold(e){return e==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}}let ni=class extends Re{constructor({lineStart:e,lineEnd:t,targetPoint:i,isDraped:r}){super(i,new Wn(e,t),r,$.SELF),this._referenceLineHint=new J(D.REFERENCE_EXTENSION,e,t,r,this.domain)}get hints(){return[this._referenceLineHint,new J(D.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}};class ts extends ut{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],r=i.edges.length,s=[];if(r<1)return s;const{spatialReference:a}=t,o=N(e,a,b,this.view),{view:l}=this,c=i.edges[r-1];let u=c;do{if(this.edgeExceedsShortLineThreshold(u,t)){const d=tt(u,l,t);this._processCandidateProposal(d.left,d.right,e,o,t,s)}u=u.leftVertex.leftEdge}while(u&&u!==c);return s}snapExistingVertex(e,t){const i=[],r=t.vertexHandle,s=r.component;if(s.edges.length<2)return i;const{view:a}=this,{spatialReference:o}=t,l=N(e,o,b,a),c=r.leftEdge,u=r.rightEdge;c&&u&&this.edgeExceedsShortLineThreshold(c,t)&&this.edgeExceedsShortLineThreshold(u,t)&&this._processCandidateProposal(L(c.leftVertex.pos,a,t),L(u.rightVertex.pos,a,t),e,l,t,i);const d=s.edges[0];let p=d;do{if(p!==r.leftEdge&&p!==r.rightEdge&&this.edgeExceedsShortLineThreshold(p,t)){const g=tt(p,a,t);this._processCandidateProposal(g.left,g.right,e,l,t,i)}p=p.rightVertex.rightEdge}while(p&&p!==d);return i}_processCandidateProposal(e,t,i,r,s,a){var d;const{spatialReference:o,pointer:l}=s,c=y();ns(c,e,t,i,s);const u=de(c);Se(r,N(u,o,b,this.view))<this.squaredProximityThreshold(l)&&a.push(new ni({lineStart:e,lineEnd:t,targetPoint:u,isDraped:((d=s.elevationInfo)==null?void 0:d.mode)==="on-the-ground"}))}}function ns(n,e,t,i,r){is(n,e,t,i,r)||rs(n,i,e,t)}function is(n,e,t,i,{spatialReference:r}){const s=Ve(e,t,r,r);if(s==null)return!1;const a=Ve(t,i,r,r);if(a==null)return!1;const o=Tn(t,i,r);if(o==null)return!1;const l=Math.abs(tr.shortestSignedDiff(s,a))>Math.PI/2?Pn.normalize(s+Math.PI):s;return Jn(n,t,r,Rn(o,"meters"),_e(l,"radians","geographic"),"geodesic"),n[2]=i[2],!0}function rs(n,e,t,i){Ot(e,{start:t,end:i,type:P.LINE},n),n[2]=e[2]}let ii=class extends Re{constructor({referenceLine:e,lineStart:t,targetPoint:i,isDraped:r}){const s=pe(t),{left:a,right:o}=e;Ce(s,Li(s,s,o),a),super(i,new Wn(t,s),r,$.SELF),this._referenceLines=[{edge:e,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new J(D.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new rr(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(e=>new J(D.REFERENCE,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(i=>{w(e.right,i.edge.left)&&(i.fadeLeft=!1,t.fadeRight=!1),w(e.right,i.edge.right)&&(i.fadeRight=!1,t.fadeRight=!1),w(e.left,i.edge.right)&&(i.fadeRight=!1,t.fadeLeft=!1),w(e.left,i.edge.left)&&(i.fadeLeft=!1,t.fadeLeft=!1)}),this._referenceLines.push(t)}},ss=class extends ut{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],r=i.edges.length,s=i.vertices.length,a=[];if(r<2)return a;const{view:o}=this,l=N(e,t.spatialReference,b,o),c=L(i.vertices[s-1].pos,o,t),u=L(i.vertices[0].pos,o,t),d=i.edges[r-1];let p=d;do{if(this.edgeExceedsShortLineThreshold(p,t)){const g=tt(p,o,t);this._checkEdgeForParallelLines(g,c,e,l,t,a),this._checkEdgeForParallelLines(g,u,e,l,t,a)}p=p.leftVertex.leftEdge}while(p&&p!==d);return a}snapExistingVertex(e,t){const i=[],r=t.vertexHandle,s=r.component;if(s.edges.length<3)return i;const{view:a}=this,o=N(e,t.spatialReference,b,a),l=r.leftEdge,c=r.rightEdge,u=s.vertices[0],d=L(u.pos,a,t),p=s.vertices.length,g=s.vertices[p-1],v=L(g.pos,a,t),m=s.edges[0];let _=m;do{if(_!==l&&_!==c&&this.edgeExceedsShortLineThreshold(_,t)){const x=tt(_,a,t);l&&this._checkEdgeForParallelLines(x,L(l.leftVertex.pos,a,t),e,o,t,i),c&&this._checkEdgeForParallelLines(x,L(c.rightVertex.pos,a,t),e,o,t,i),r===u?this._checkEdgeForParallelLines(x,v,e,o,t,i):r===g&&this._checkEdgeForParallelLines(x,d,e,o,t,i)}_=_.rightVertex.rightEdge}while(_&&_!==m);return i}_checkEdgeForParallelLines(e,t,i,r,s,a){var p;const o=e.left,l=e.right;if(Lt(ye,t,o,l),me(ye,t)<se.parallelLineThreshold)return;Lt(ye,i,o,l,t);const{spatialReference:c,pointer:u}=s,d=de(Z(ye[0],ye[1],i[2]));if(Se(r,N(d,c,b,this.view))<this.squaredProximityThreshold(u)){if(this.isVertical(d,t,s)||this.isVertical(o,l,s)||os(e,a))return;a.push(new ii({referenceLine:e,lineStart:t,targetPoint:d,isDraped:((p=s.elevationInfo)==null?void 0:p.mode)==="on-the-ground"}))}}};function os(n,e){const t=n.left,i=n.right;for(const r of e)if(Lt(ye,i,r.constraint.start,r.constraint.end,t),me(ye,i)<se.parallelLineThreshold)return r.addReferenceLine(n),!0;return!1}const ye=G();class as extends ut{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],r=[];if(i.vertices.length<2)return r;const{view:s}=this,a=N(e,t.spatialReference,b,s),o=i.vertices.at(-1);this._checkForSnappingCandidate(ue.LastVertex,r,o.leftEdge,o,o.leftEdge.leftVertex,e,a,t);const l=i.vertices[0];return this._checkForSnappingCandidate(ue.FirstVertex,r,l.rightEdge,l,l.rightEdge.rightVertex,e,a,t),r}snapExistingVertex(e,t){const i=[],r=t.vertexHandle;if(r.component.vertices.length<3)return i;const{view:s}=this,a=N(e,t.spatialReference,b,s),o=r.leftEdge,l=r.rightEdge;if(o!=null&&o.leftVertex.leftEdge){const c=o.leftVertex.leftEdge;this._checkForSnappingCandidate(ue.ExistingEdge,i,c,c.rightVertex,c.leftVertex,e,a,t)}if(l!=null&&l.rightVertex.rightEdge){const c=l.rightVertex.rightEdge;this._checkForSnappingCandidate(ue.ExistingEdge,i,c,c.leftVertex,c.rightVertex,e,a,t)}return i}_checkForSnappingCandidate(e,t,i,r,s,a,o,l){if(!this.edgeExceedsShortLineThreshold(i,l))return;const c=this.view,u=L(r.pos,c,l),d=L(s.pos,c,l);ls(pn,d,u,a,l),this._checkForSnappingCandidateAlongProjectedRay(e,t,d,u,pn,a,o,l)}_checkForSnappingCandidateAlongProjectedRay(e,t,i,r,s,a,o,l){var _;const{spatialReference:c,pointer:u}=l,d=oe(Rt,a,r),p=Ie(s,d)/Fe(s),g=Ae(Rt,r,s,p),v=de(Z(g[0],g[1],a[2]));if(Se(o,N(v,c,b,this.view))>this.squaredProximityThreshold(u)||this.isVertical(v,r,l)||this.isVertical(r,i,l))return;const m=T(y(),r,s,Math.sign(p));t.push(new Xt({targetPoint:v,constraint:new Zn(r,m),previousVertex:i,otherVertex:r,otherVertexType:$e.CENTER,selfSnappingType:e,isDraped:((_=l.elevationInfo)==null?void 0:_.mode)==="on-the-ground"}))}}function ls(n,e,t,i,r){cs(n,e,t,i,r)||us(n,e,t)}function cs(n,e,t,i,{spatialReference:r}){const s=Ve(e,t,r,r);if(s==null)return!1;const a=Ve(t,i,r,r);if(a==null)return!1;const o=Math.sign(Pn.shortestSignedDiff(s,a))*Math.PI*.5,l=_e(s+o,"radians","geographic"),c=y(),u=Tn(t,i,r);return u!=null&&(Jn(c,t,r,Rn(u,"meters"),l,"geodesic"),Ce(n,c,t),!0)}function us(n,e,t){const i=oe(Rt,t,e);U(n,i[1],-i[0],0)}const Rt=G(),pn=y();class ri extends Re{constructor({targetPoint:e,point1:t,point2:i,isDraped:r}){super(e,new Un($i(y(),t,i,.5),.5*At(t,i)),r,$.SELF),this._p1=t,this._p2=i}get hints(){return[new J(D.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new J(D.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new ot(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}}let ds=class extends ut{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],r=[],s=i.vertices.length;if(t.editGeometryOperations.data.type!=="polygon"||s<2)return r;const{view:a}=this,o=i.vertices[0],l=i.vertices[s-1],c=L(o.pos,a,t),u=L(l.pos,a,t);return this._processCandidateProposal(c,u,e,t,r),r}snapExistingVertex(e,t){const i=[],r=t.vertexHandle,s=r.component;if(s.edges.length<2||t.editGeometryOperations.data.type==="polyline"&&(r.index===0||r.index===s.vertices.length-1))return i;const{view:a}=this,o=L(r.leftEdge.leftVertex.pos,a,t),l=L(r.rightEdge.rightVertex.pos,a,t);return this._processCandidateProposal(o,l,e,t,i),i}_processCandidateProposal(e,t,i,r,s){var g;if(!this.exceedsShortLineThreshold(e,t,r))return;const a=Sn(fn,e,t,.5),o=.5*At(e,t),l=Bi(fn,i,a,o),c=de(Z(l[0],l[1],i[2])),{spatialReference:u,pointer:d}=r,p=N(i,u,b,this.view);if(Se(p,N(c,u,b,this.view))<this.squaredProximityThreshold(d)){if(this.isVertical(e,c,r)||this.isVertical(c,t,r))return;s.push(new ri({targetPoint:c,point1:e,point2:t,isDraped:((g=r.elevationInfo)==null?void 0:g.mode)==="on-the-ground"}))}}};const fn=G();let we=class extends Te{constructor(n){super(n),this.updating=!1,this._snappers=new xe,this._domain=$.SELF}initialize(){this._snappers.push(new ss(this.view,this.options),new ts(this.view,this.options),new as(this.view,this.options),new ds(this.view,this.options))}set options(n){this._set("options",n);for(const e of this._snappers)e.options=n}async fetchCandidates(n,e,t){if(!(e&this._domain&&this.options.effectiveSelfEnabled))return[];const i=[];for(const r of this._snappers.items)for(const s of r.snap(n,t))i.push(s);return Bt(n,i),i}};h([f({readOnly:!0})],we.prototype,"updating",void 0),h([f({constructOnly:!0})],we.prototype,"view",void 0),h([f()],we.prototype,"options",null),we=h([fe("esri.views.interactive.snapping.SelfSnappingEngine")],we);function hs(n,e){return[new we({view:n,options:e}),new ce({view:n,options:e,spatialReference:n.spatialReference})]}class Ge extends Re{constructor(e,t,i,r){super(e,new Pe(e),r,$.ALL),this.first=t,this.second=i}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new ir(this.targetPoint,this.isDraped,this.domain)]}}let Q=class extends Ti.EventedMixin(Te){constructor(n){super(n),this.options=new Wr,this.snappingEnginesFactory=hs,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=re.MAIN}initialize(){this.addHandles([ve(()=>{const{effectiveFeatureEnabled:n,effectiveSelfEnabled:e,touchSensitivityMultiplier:t,distance:i}=this.options;return{effectiveFeatureEnabled:n,effectiveSelfEnabled:e,touchSensitivityMultiplier:t,distance:i}},()=>{this.doneSnapping(),this.emit("changed")},wt),ve(()=>this.options,n=>{for(const e of this._engines)e.options=n},wt),ve(()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory}),({viewReady:n,snappingEnginesFactory:e})=>this._recreateEngines(n,e),Ye)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some(n=>n.updating)}_recreateEngines(n,e){if(this._destroyEngines(),!n)return;const{view:t,options:i}=this;this._engines=e(t,i)}_destroyEngines(){for(const n of this._engines)n.destroy();this._engines=[]}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:n,touchSensitivityMultiplier:e}=this.options,t=n*e;return t*t}snap(n){return gs(n)?this._snapMultiPoint(n):this._snapSinglePoint(n)}update(n){const{point:e,context:t}=n;this._removeVisualization();const i=this._currentMainCandidate;if(i==null)return e;const r=this._selectUpdateInput(n);if(r==null)return e;const{spatialReference:s}=t,a=Jt(r,s);if(a==null)return e;const{view:o}=this,{elevationInfo:l,visualizer:c}=t,u=[],d=Me(a,o,l),p=i.constraint.closestTo(d);if(!this._arePointsWithinScreenThreshold(d,p,t)||!_t(i,t.drawConstraints))return this._resetSnappingState(),e;i.targetPoint=de(p),u.push(...i.hints);for(const g of this._currentOtherActiveCandidates)_t(g,t.drawConstraints)&&(g.targetPoint=de(p),u.push(...g.hints));return c!=null&&this.addHandles(c.draw(u,{spatialReference:s,elevationInfo:ys(t),view:o,selfSnappingZ:t.selfSnappingZ}),mt),en(p,o,e,t)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:n,scenePoint:e}){switch(this._currentSnappedType){case re.MAIN:return n;case re.SCENE:return e}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=re.MAIN}_removeVisualization(){this.removeHandles(mt)}async _snapSinglePoint({point:n,context:e,signal:t}){const{view:i}=this,{elevationInfo:r}=e,s=Me(n,i,r),a=await this._fetchCandidates(s,$.ALL,e,t);return this._createSnapResult(s,re.MAIN,a,i,n,e,t)}async _snapMultiPoint({point:n,scenePoint:e,context:t,signal:i}){const{view:r}=this,{coordinateHelper:s,elevationInfo:a,spatialReference:o}=t;await Pi(e.spatialReference,o);const l=Jt(e,o),c=Me(l,r,a),u=await this._fetchCandidates(c,$.FEATURE,t,i);if(u.length>0){const g=await this._fetchCandidates(c,$.SELF,t,i);return this._createSnapResult(c,re.SCENE,[...u,...g],r,l,t,i)}const d=Me(n,r,a),p=await this._fetchCandidates(d,$.SELF,t,i);return this._createSnapResult(d,re.MAIN,p,r,{z:s.hasZ()&&n.hasZ?n.z??0:void 0,m:s.hasM()&&n.hasM?n.m??0:void 0},t,i)}async _fetchCandidates(n,e,t,i){return(await Promise.all(this._engines.map(r=>r.fetchCandidates(n,e,t,i)))).flat()}_createSnapResult(n,e,t,i,r,s,a){return{get valid(){return!Ri(a)},apply:()=>{const{spatialReference:o}=s,{snappedPoint:l,hints:c}=this._processCandidates(n,e,t,s);return this._removeVisualization(),s.visualizer!=null&&this.addHandles(s.visualizer.draw(c,{spatialReference:o,elevationInfo:b,view:i,selfSnappingZ:s.selfSnappingZ}),mt),en(l,i,r,s)}}}_processCandidates(n,e,t,i){if(t.length<1)return this.doneSnapping(),{snappedPoint:n,hints:[]};this._currentSnappedType!==e&&this._resetSnappingState(),Bt(n,t);const r=this._currentMainCandidate;if(r!=null){const s=fs(r,t);if(s>=0){if(!(t[s]instanceof Ge))return this._intersectWithOtherCandidates(s,t,n,e,i);if(this._arePointsWithinScreenThreshold(n,r.targetPoint,i))return this._updateSnappingCandidate(r,e,t,i)}}return this._intersectWithOtherCandidates(0,t,n,e,i)}_intersectWithOtherCandidates(n,e,t,i,r){const{coordinateHelper:s}=r,a=e[n],o=[];for(let l=0;l<e.length;++l){if(l===n)continue;const c=e[l],u=a.constraint.intersect(c.constraint);if(u)for(const d of u.closestPoints(a.targetPoint))o.push([new Ge(de(d),a,c,c.isDraped),this._squaredScreenDistance(t,d,s)])}return o.length>0&&(o.sort((l,c)=>l[1]-c[1]),o[0][1]<this._squaredPointProximityThreshold(r.pointer))?this._updateSnappingCandidate(o[0][0],i,e,r):_t(a,r.drawConstraints)?this._updateSnappingCandidate(a,i,e,r):{snappedPoint:t,hints:[]}}_updateSnappingCandidate(n,e,t,i){this.doneSnapping(),this._currentMainCandidate=n,this._currentSnappedType=e;const r=this._currentMainCandidate.targetPoint,s=[];s.push(...n.hints);for(const a of t){if(n instanceof Ge){if(a.constraint.equals(n.first.constraint)||a.constraint.equals(n.second.constraint))continue}else if(a.constraint.equals(n.constraint))continue;const o=a.constraint.closestTo(r);this._squaredScreenDistance(o,r,i.coordinateHelper)<ps()&&(a.targetPoint=r,this._currentOtherActiveCandidates.push(a),s.push(...a.hints))}return{snappedPoint:r,hints:s}}_squaredPointProximityThreshold(n){return n==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(n,e,t){return this._squaredScreenDistance(n,e,t.coordinateHelper)<this._squaredPointProximityThreshold(t.pointer)}_squaredScreenDistance(n,e,t){return Se(this._toScreen(n,t),this._toScreen(e,t))}_toScreen(n,e){return N(n,e.spatialReference,b,this.view)}get test(){}};var re;h([f({constructOnly:!0})],Q.prototype,"view",void 0),h([f()],Q.prototype,"options",void 0),h([f({readOnly:!0})],Q.prototype,"updating",null),h([f()],Q.prototype,"snappingEnginesFactory",void 0),h([f()],Q.prototype,"_engines",void 0),h([f()],Q.prototype,"_squaredMouseProximityThreshold",null),h([f()],Q.prototype,"_squaredTouchProximityThreshold",null),Q=h([fe("esri.views.interactive.snapping.SnappingManager")],Q),function(n){n[n.MAIN=0]="MAIN",n[n.SCENE=1]="SCENE"}(re||(re={}));const mt="visualization-handle";function ps(){return se.satisfiesConstraintScreenThreshold*se.satisfiesConstraintScreenThreshold}function _t(n,e){return!e||e.direction==null&&e.distance==null||!(n instanceof ei||n instanceof ti||n instanceof ni||n instanceof ii||n instanceof ri)&&(!(n instanceof Xt)||e.direction==null&&n.selfSnappingType===ue.LastVertex)}function fs(n,e){return n instanceof Ge?Et(e,n.first)>=0&&Et(e,n.second)>=0?0:-1:Et(e,n)}function Et(n,e){let t=-1;for(let i=0;i<n.length;++i)if(e.constraint.equals(n[i].constraint)){t=i;break}return t}function gs(n){return n.scenePoint!=null}function ys({coordinateHelper:n,elevationInfo:e}){return n.hasZ()?b:e}export{et as A,j as B,Wt as C,fr as D,$ as E,Zn as F,_r as G,un as H,Q as I,jr as J,an as K,q as L,Jn as M,Bs as N,Gs as O,ce as P,qr as R,zs as T,Us as U,mr as Z,ot as a,st as b,de as c,ei as d,ti as e,Z as f,Yt as g,Pe as h,Bt as i,Ws as j,Wr as k,Qn as l,Ds as m,J as n,ir as o,se as p,qs as q,rr as r,Os as s,D as t,Is as u,Me as v,I as w,en as x,Zs as y,Un as z};
