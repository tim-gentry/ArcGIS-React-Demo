const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FeatureLayer-Bb5mf85J.js","assets/index-DX0rcHuW.js","assets/index-B2yzeq1w.css","assets/FeatureLayerBase-uK0oK06Z.js","assets/inputs-Due4QVtL.js","assets/formUtils-Dni92j4V.js","assets/HeightModelInfo-DaJXTLDg.js","assets/arcgisLayerUrl-BpJodxxk.js","assets/LayerFloorInfo-D-bXPB8b.js","assets/Relationship-Clp_49iY.js","assets/serviceCapabilitiesUtils-CIgEASrL.js","assets/editsZScale-BDLbHb5e.js","assets/queryZScale-B1r3mH-Y.js","assets/APIKeyMixin-DSbft86T.js","assets/ArcGISService-CVVnFG2B.js","assets/EditBusLayer-Brt5ASt_.js","assets/uuid-fwrPAdZb.js","assets/FeatureType-Bb4KOLCq.js","assets/versionUtils-DlHqsQBg.js","assets/styleUtils-CxRaW7Jr.js","assets/TopFeaturesQuery-B-wHLSqs.js","assets/interfaces-CL2NbQte.js","assets/MapImageLayer-B2Kn4KAv.js","assets/loadAll-8MiqgLTH.js","assets/scaleUtils-ClqQrarK.js","assets/SublayersOwner-D6ZOAJLX.js","assets/CollectionFlattener-Be8YW6oV.js","assets/QueryTask-BEsi-5Fi.js","assets/infoFor3D-CxOdoily.js","assets/utils-nzDIu46v.js","assets/executeForIds-BJu0fyay.js","assets/query-95tcIPsI.js","assets/normalizeUtils-CzEkgn6d.js","assets/normalizeUtilsCommon-DXRtgGFh.js","assets/utils-D67OULxu.js","assets/pbfQueryUtils-B33F7Io8.js","assets/pbf-9I_px9lQ.js","assets/OptimizedGeometry-vU5jWBvU.js","assets/OptimizedFeature-7juV2tZm.js","assets/OptimizedFeatureSet-Blu9Ckm7.js","assets/executeQueryJSON-_Gsxb9pi.js","assets/executeQueryPBF-Ds4PRVlt.js","assets/featureConversionUtils-C8uvc1AG.js","assets/sublayerUtils-BdOfNgEy.js","assets/ExportImageParameters-C0dqlx0B.js","assets/floorFilterUtils-DZ5C6FQv.js","assets/imageBitmapUtils-Cem1rTGf.js","assets/calcite-action-BQdWHUTy.js","assets/action-BdLH7y4R.js","assets/jsxFactory-DmHi7Kb2.js","assets/dom-Dv5tDaqe.js","assets/interactive-CM5F_5Ay.js","assets/loadable-BpL5xwNx.js","assets/locale-jvDArz_C.js","assets/key-D5DPfjW0.js","assets/observers-CLdbMMrh.js","assets/component-ByvC-PUv.js","assets/t9n-Bv5oqD69.js","assets/icon-CWAu07D3.js","assets/loader-CQvnYTBN.js","assets/calcite-block-qdFeD75E.js","assets/conditionalSlot-CqkDrxC7.js","assets/Heading-DiaW_And.js","assets/openCloseComponent-BcNBZQe2.js","assets/action-menu-D84YVNtM.js","assets/array-DofFqflK.js","assets/popover-Zk0D1hdH.js","assets/floating-ui-CVXgJmXk.js","assets/debounce-C5YDvsuO.js","assets/focusTrapComponent-CklV4nIL.js","assets/FloatingArrow-Cy8j4zsH.js","assets/handle-BKDOnSwp.js","assets/scrim-CLRFMMcr.js","assets/calcite-button-B3dK3J4O.js","assets/button-D77aSY9T.js","assets/form-DT0Txu1X.js","assets/label-CcvHzygA.js","assets/calcite-checkbox-B3jaud22.js","assets/calcite-combobox-CFk50a9E.js","assets/combobox-71NFiN9k.js","assets/core-2D-WamSI.js","assets/filter-BHzLPuAd.js","assets/Validation-BmSC9xQN.js","assets/utils2-C9ILKKiq.js","assets/chip-Dw2wHkeW.js","assets/combobox-item-COrIQXYO.js","assets/input-message-D42H2lMx.js","assets/calcite-combobox-item-CebKWX2e.js","assets/calcite-flow-DRMo8BV0.js","assets/calcite-flow-item-C1dz4xH2.js","assets/panel-DPpK0hDp.js","assets/calcite-icon-W-AdNGRC.js","assets/calcite-input-UxOKjIHa.js","assets/input2-Dot_SaOW.js","assets/input-Dt5r39B0.js","assets/progress-Cn98mWq-.js","assets/calcite-label-75nr6He8.js","assets/calcite-list-Dnyd1Dz_.js","assets/resources4-CT6dxwoZ.js","assets/utils3-DHpXCuCx.js","assets/calcite-list-item-DvRwTdOl.js","assets/calcite-loader-DWyhLzpy.js","assets/calcite-switch-CWeNlSSv.js","assets/switch-DGXW061d.js","assets/calcite-chip-JRnHjMcm.js"])))=>i.map(i=>d[i]);
import{b2 as Y,ac as s,ad as u,ag as V,bh as pe,bY as ee,fa as ft,f as Ae,aL as Je,dv as Bt,al as Q,b3 as Ee,U as Z,f9 as Ne,ct as Ht,_ as A,ai as zt,cy as Wt,cA as ot,cC as qt,eC as Kt,eD as lt,g9 as Zt,D as xe,t as re,gO as Yt,aJ as Qt,or as Xt,dL as fe,dG as bt,o as ea,aT as ve,eB as nt,V as gt,E as vt,a3 as ta,a as Oe,s as K,os as wt,ot as rt,ap as aa,b6 as st,dY as pt,bA as ut,dc as ia,dT as oa,aG as la,aZ as na,jj as ra,aF as ct,hu as sa,dr as pa}from"./index-DX0rcHuW.js";import{b as ua}from"./unitFormatUtils-BYvkXWcg.js";import{s as ca,f as oe,i as da,u as Se}from"./utils-nzDIu46v.js";import{n as d,e as De,B as ma,r as ha,q as ya,k as fa}from"./jsxFactory-DmHi7Kb2.js";import{s as ba}from"./ReactiveMap-r-vujrh9.js";import{R as ga}from"./normalizeUtils-CzEkgn6d.js";import{t as va,s as wa}from"./networkEnums-DshobRbj.js";import{a as _t}from"./GPMessage-Dkbt7Y2k.js";import{o as _a}from"./floorFilterUtils-DZ5C6FQv.js";import{c as Ta}from"./layerViewUtils-D2JqIDZ8.js";import{_ as Ia}from"./viewpointUtils-BG1_rfM2.js";import{_ as dt}from"./InputManager-abOXR3ru.js";import{e as ue}from"./globalCss-CZa70j6i.js";import{e as xa}from"./Heading-BI51LCyX.js";import{i as Oa}from"./legacyIcon-CtsJ0OTG.js";import"./ByteSizeUnit-BsxeN7wM.js";import"./Cyclical-CEj-eenM.js";import"./quantityUtils-DSpmykXR.js";import"./uuid-fwrPAdZb.js";import"./normalizeUtilsCommon-DXRtgGFh.js";import"./utils-D67OULxu.js";import"./Viewpoint-sw4jiA6m.js";import"./mat2d-CXMJJ9G6.js";import"./mat2df64-CBKYtunK.js";import"./vec2-C-4tM9Uv.js";import"./vec2f64-Diu2Kaa8.js";import"./signal-CpmfLcHB.js";const $e=new Y({PDF:"pdf",PNG32:"png32",PNG8:"png8",JPG:"jpg",GIF:"gif",EPS:"eps",SVG:"svg",SVGZ:"svgz"}),we=$e.fromJSON.bind($e),Tt=$e.toJSON.bind($e);let j=class extends pe{constructor(t){super(t),this.state="pending",this.url=""}initialize(){this.addHandles(ee(()=>[this.extension,this.name],()=>this._setFormattedFileName(),ft))}_setFormattedFileName(){this.name&&this.extension&&(this.formattedName=this.count?`${this.name}(${this.count})${this.extension}`:`${this.name}.${this.extension}`)}};s([u()],j.prototype,"count",void 0),s([u()],j.prototype,"error",void 0),s([u()],j.prototype,"extension",void 0),s([u()],j.prototype,"formattedName",void 0),s([u()],j.prototype,"name",void 0),s([u()],j.prototype,"state",void 0),s([u()],j.prototype,"url",void 0),j=s([V("esri.widgets.Print.FileLink")],j);const It=j;var Ve;let J=Ve=class extends pe{constructor(e){super(e),this.outSpatialReference=null,this.processExtent=null,this.processSpatialReference=null,this.returnColumnName=!1,this.returnFeatureCollection=!1,this.returnM=!1,this.returnZ=!1}static from(e){return Bt(Ve,e)}};s([u({type:Ae})],J.prototype,"outSpatialReference",void 0),s([u({type:Je})],J.prototype,"processExtent",void 0),s([u({type:Ae})],J.prototype,"processSpatialReference",void 0),s([u({nonNullable:!0})],J.prototype,"returnColumnName",void 0),s([u({nonNullable:!0})],J.prototype,"returnFeatureCollection",void 0),s([u({nonNullable:!0})],J.prototype,"returnM",void 0),s([u({nonNullable:!0})],J.prototype,"returnZ",void 0),J=Ve=s([V("esri.rest.geoprocessor.GPOptions")],J);const Ge=J;let U=class extends Q{constructor(){super(...arguments),this.extent=null,this.height=null,this.href=null,this.opacity=1,this.rotation=0,this.scale=null,this.visible=!0,this.width=null}};s([u({type:Je})],U.prototype,"extent",void 0),s([u()],U.prototype,"height",void 0),s([u()],U.prototype,"href",void 0),s([u()],U.prototype,"opacity",void 0),s([u()],U.prototype,"rotation",void 0),s([u()],U.prototype,"scale",void 0),s([u()],U.prototype,"visible",void 0),s([u()],U.prototype,"width",void 0),U=s([V("esri.layers.support.MapImage")],U);const Sa=U;let ce=class extends Q{constructor(t){super(t),this.area=0,this.units=null}};s([u({json:{write:!0}})],ce.prototype,"area",void 0),s([Ee(va)],ce.prototype,"units",void 0),ce=s([V("esri.rest.support.ArealUnit")],ce);const $a=ce;let de=class extends Q{constructor(t){super(t),this.itemId=null,this.url=null}};s([u({type:String,json:{read:{source:"itemID"},write:{target:"itemID"}}})],de.prototype,"itemId",void 0),s([u({type:String,json:{write:!0}})],de.prototype,"url",void 0),de=s([V("esri.rest.support.DataFile")],de);const Me=de;let me=class extends Q{constructor(t){super(t),this.distance=0,this.units=null}};s([u({json:{write:!0}})],me.prototype,"distance",void 0),s([Ee(wa)],me.prototype,"units",void 0),me=s([V("esri.rest.support.LinearUnit")],me);const La=me,N="multi-value-",Be=new Y({GPArealUnit:"areal-unit",GPBoolean:"boolean",GPComposite:"composite",GPDataFile:"data-file",GPDate:"date",GPDouble:"double",GPFeatureRecordSetLayer:"feature-record-set-layer",Field:"field",GPLinearUnit:"linear-unit",GPLong:"long",GPRasterData:"raster-data",GPRasterDataLayer:"raster-data-layer",GPRecordSet:"record-set",GPString:"string",GPValueTable:"value-table","GPMultiValue:GPArealUnit":`${N}areal-unit`,"GPMultiValue:GPBoolean":`${N}boolean`,"GPMultiValue:GPComposite":`${N}composite`,"GPMultiValue:GPDataFile":`${N}data-file`,"GPMultiValue:GPDate":`${N}date`,"GPMultiValue:GPDouble":`${N}double`,"GPMultiValue:GPFeatureRecordSetLayer":`${N}feature-record-set-layer`,"GPMultiValue:Field":`${N}field`,"GPMultiValue:GPLinearUnit":`${N}linear-unit`,"GPMultiValue:GPLong":`${N}long`,"GPMultiValue:GPRasterData":`${N}raster-data`,"GPMultiValue:GPRasterDataLayer":`${N}raster-data-layer`,"GPMultiValue:GPRecordSet":`${N}record-set`,"GPMultiValue:GPString":`${N}string`});let le=class extends Q{constructor(t){super(t),this.dataType=null,this.paramName=null,this.value=null}};s([Ee(Be,{ignoreUnknown:!1})],le.prototype,"dataType",void 0),s([u()],le.prototype,"paramName",void 0),s([u()],le.prototype,"value",void 0),le=s([V("esri.rest.support.ParameterValue")],le);const Pa=le;let ne=class extends Q{constructor(t){super(t),this.format=null,this.itemId=null,this.url=null}};s([u()],ne.prototype,"format",void 0),s([u({json:{read:{source:"itemID"},write:{target:"itemID"}}})],ne.prototype,"itemId",void 0),s([u()],ne.prototype,"url",void 0),ne=s([V("esri.rest.support.RasterData")],ne);const Ca=ne;async function xt(e,t,i,a,o){const l={},r={},c=[];return ka(a,c,l),ga(c).then(p=>{const{outSpatialReference:n,processExtent:m,processSpatialReference:h,returnColumnName:w,returnFeatureCollection:O,returnM:b,returnZ:y}=i,{path:f}=oe(e);for(const T in l){const[$,F]=l[T];r[T]=p.slice($,F)}const g=n?n.wkid||n:null,I=h?h.wkid||h:null,S=t==="execute"?{returnColumnName:w||void 0,returnFeatureCollection:O||void 0,returnM:b||void 0,returnZ:y||void 0}:null,P=Le({...m?{context:{extent:m,outSR:g,processSR:I}}:{"env:outSR":g,"env:processSR":I},...a,...S,f:"json"},null,r),L={...o,query:P};return Z(`${f}/${t}`,L)})}function ka(e,t,i){for(const a in e){const o=e[a];if(o&&typeof o=="object"&&o instanceof Ne){const{features:l}=o;i[a]=[t.length,t.length+l.length],l.forEach(r=>{t.push(r.geometry)})}}}async function Re(e,t){switch(e){case"areal-unit":return $a.fromJSON(t);case"boolean":case"double":case"long":case"string":case"value-table":return t;case"date":return new Date(t);case"data-file":return Me.fromJSON(t);case"linear-unit":return La.fromJSON(t);case"feature-record-set-layer":if("url"in t)return Me.fromJSON(t);if("layerDefinition"in t){const i=new(await A(async()=>{const{default:l}=await import("./FeatureLayer-Bb5mf85J.js");return{default:l}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]))).default,{layerDefinition:a,featureSet:o}=t;return i.read({layerDefinition:a,featureSet:o},{origin:"portal-item"}),i.spatialReference=Ae.fromJSON(o.spatialReference??a.spatialReference??a.extent.spatialReference),i}return Ne.fromJSON(t);case"record-set":return"url"in t?Me.fromJSON(t):Ne.fromJSON(t);case"raster-data":case"raster-data-layer":return"mapImage"in t?Sa.fromJSON(t.mapImage):Ca.fromJSON(t);case"field":return Ht.fromJSON(t)}}function Ea(e){return e.startsWith(N)}function Da(e){return e.replace(N,"")}async function Ma(e,t){const i=Da(e),a=i==="composite"?t.map(o=>Re(Be.fromJSON(o.dataType),o.value)):t.map(o=>Re(i,o));return Promise.all(a)}async function Ue(e){const t=Be.fromJSON(e.dataType),{paramName:i}=e,a=Ea(t)?await Ma(t,e.value):await Re(t,e.value);return new Pa({dataType:t,paramName:i,value:a})}function Le(e,t,i){for(const a in e){const o=e[a];Array.isArray(o)?e[a]=JSON.stringify(o.map(l=>Le({item:l},!0).item)):o instanceof Date&&(e[a]=o.getTime())}return ca(e,t,i)}async function Ot(e,t,i,a){return i=Ge.from(i||{}),xt(e,"execute",i,t??{},a).then(async({data:o})=>{var l,r;return{results:await Promise.all(((l=o.results)==null?void 0:l.map(Ue))??[]),messages:((r=o.messages)==null?void 0:r.map(c=>_t.fromJSON(c)))??[]}})}var _e;const Fa=zt()({esriJobCancelled:"job-cancelled",esriJobCancelling:"job-cancelling",esriJobDeleted:"job-deleted",esriJobDeleting:"job-deleting",esriJobTimedOut:"job-timed-out",esriJobExecuting:"job-executing",esriJobFailed:"job-failed",esriJobNew:"job-new",esriJobSubmitted:"job-submitted",esriJobSucceeded:"job-succeeded",esriJobWaiting:"job-waiting"},{ignoreUnknown:!1});let W=_e=class extends Q{constructor(e){super(e),this.jobId=null,this.jobStatus=null,this.messages=null,this.progress=null,this.requestOptions=null,this.sourceUrl=null,this._timer=void 0}async cancelJob(e){const{jobId:t,sourceUrl:i}=this,{path:a}=oe(i),o={...this.requestOptions,...e,query:{f:"json"}};this._clearTimer();const l=`${a}/jobs/${t}/cancel`,{data:r}=await Z(l,o),{messages:c,jobStatus:p,progress:n}=_e.fromJSON(r);return this.set({messages:c,jobStatus:p,progress:n}),this}destroy(){clearInterval(this._timer)}async checkJobStatus(e){const{path:t}=oe(this.sourceUrl),i={...this.requestOptions,...e,query:{f:"json"}},a=`${t}/jobs/${this.jobId}`,{data:o}=await Z(a,i),{messages:l,jobStatus:r,progress:c}=_e.fromJSON(o);return this.set({messages:l,jobStatus:r,progress:c}),this}async fetchResultData(e,t,i){t=Ge.from(t||{});const{returnColumnName:a,returnFeatureCollection:o,returnM:l,returnZ:r,outSpatialReference:c}=t,{path:p}=oe(this.sourceUrl),n=Le({returnColumnName:a||null,returnFeatureCollection:o||null,returnM:l||null,returnZ:r||null,outSR:c,returnType:"data",f:"json"},null),m={...this.requestOptions,...i,query:n},h=`${p}/jobs/${this.jobId}/results/${e}`,{data:w}=await Z(h,m);return Ue(w)}async fetchResultImage(e,t,i){const{path:a}=oe(this.sourceUrl),o={...t.toJSON(),f:"json"},l=Le(o),r={...this.requestOptions,...i,query:l},c=`${a}/jobs/${this.jobId}/results/${e}`,{data:p}=await Z(c,r);return Ue(p)}async fetchResultMapImageLayer(){const{path:e}=oe(this.sourceUrl),t=e.indexOf("/GPServer/"),i=`${e.substring(0,t)}/MapServer/jobs/${this.jobId}`;return new(await A(async()=>{const{default:a}=await import("./MapImageLayer-B2Kn4KAv.js");return{default:a}},__vite__mapDeps([22,1,2,23,24,13,25,7,26,27,28,29,30,31,32,33,34,35,36,37,38,39,12,40,41,42,17,8,9,10,43,14,44,45,46,18]))).default({url:i})}async waitForJobCompletion(e={}){const{interval:t=1e3,signal:i,statusCallback:a}=e;return new Promise((o,l)=>{Wt(i,()=>{this._clearTimer(),l(ot())}),this._clearTimer();const r=setInterval(()=>{this._timer||l(ot()),this.checkJobStatus(this.requestOptions).then(c=>{const{jobStatus:p}=c;switch(this.jobStatus=p,p){case"job-succeeded":this._clearTimer(),o(this);break;case"job-submitted":case"job-executing":case"job-waiting":case"job-new":a&&a(this);break;case"job-cancelled":case"job-cancelling":case"job-deleted":case"job-deleting":case"job-timed-out":case"job-failed":this._clearTimer(),l(this)}})},t);this._timer=r})}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};s([u()],W.prototype,"jobId",void 0),s([Ee(Fa,{ignoreUnknown:!1})],W.prototype,"jobStatus",void 0),s([u({type:[_t]})],W.prototype,"messages",void 0),s([u()],W.prototype,"progress",void 0),s([u()],W.prototype,"requestOptions",void 0),s([u({json:{write:!0}})],W.prototype,"sourceUrl",void 0),W=_e=s([V("esri.rest.support.JobInfo")],W);const Aa=W;async function St(e,t,i,a){return i=Ge.from(i||{}),xt(e,"submitJob",i,t??{},a).then(({data:o})=>{const l=Aa.fromJSON(o);return l.sourceUrl=e,l})}const Pe=new Y({MAP_ONLY:"map-only","A3 Landscape":"a3-landscape","A3 Portrait":"a3-portrait","A4 Landscape":"a4-landscape","A4 Portrait":"a4-portrait","Letter ANSI A Landscape":"letter-ansi-a-landscape","Letter ANSI A Portrait":"letter-ansi-a-portrait","Tabloid ANSI B Landscape":"tabloid-ansi-b-landscape","Tabloid ANSI B Portrait":"tabloid-ansi-b-portrait"}),he=Pe.fromJSON.bind(Pe),Na=Pe.toJSON.bind(Pe);function Va(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}}}function Ra(){return{layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}}}function mt(){return{layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}}function Ua(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}}}function ja(e,t=15){const i=e.canvas.width,a=e.canvas.height,o=e.getImageData(0,0,i,a).data;let l,r,c,p,n,m;e:for(r=a;r--;)for(l=i;l--;)if(o[4*(i*r+l)+3]>t){m=r;break e}if(!m)return null;e:for(l=i;l--;)for(r=m+1;r--;)if(o[4*(i*r+l)+3]>t){n=l;break e}e:for(l=0;l<=n;++l)for(r=m+1;r--;)if(o[4*(i*r+l)+3]>t){c=l;break e}e:for(r=0;r<=m;++r)for(l=c;l<=n;++l)if(o[4*(i*r+l)+3]>t){p=r;break e}return{x:c,y:p,width:n-c,height:m-p}}function Ja(e,t){var o,l;const i=((o=t.color)==null?void 0:o.clone())??new qt([0,255,255]),a=((l=t.haloColor)==null?void 0:l.clone())??i.clone();switch(e){case"envelope":case"polygon":return i.a*=t.fillOpacity??.25,new Zt({color:i,outline:new lt({color:a}),style:"solid"});case"polyline":return new lt({color:a});default:return a.a=1,new Kt({color:a,outline:null})}}function Ga(e,t){const i=e.allLayerViews.items;if(t===e.scale)return i.filter(o=>!o.suspended);const a=new Array;for(const o of i){const l=o.parent;l&&l!==o.view&&(za(l)||Wa(l))&&!a.includes(l)||o.visible&&o.visibleAtCurrentTimeExtent&&Ta(o.layer.effectiveScaleRange,t)&&a.push(o)}return a}function Ba(e){return(e==null?void 0:e.type)==="bing-maps"}function $t(e){return e&&"blendMode"in e&&"effect"in e}function Ha(e){return(e==null?void 0:e.type)==="csv"}function za(e){return e.layer.type==="catalog"}function Wa(e){return e.layer.type==="group"}function qa(e){const t=e.layer;if($t(t)){const i=t.blendMode;if((!i||i==="normal")&&(t.effect||"featureEffect"in e&&e.featureEffect))return!0}return!1}let M=class extends pe{constructor(t){super(t),this.attributionVisible=!0,this.exportOptions={width:800,height:1100,dpi:96},this.forceFeatureAttributes=!1,this.format="png32",this.includeCharts=!1,this.includeTables=!1,this.label=null,this.layout="map-only",this.layoutItem=null,this.layoutOptions=null,this.outScale=0,this.report=null,this.reportItem=null,this.reportOptions=null,this.scalePreserved=!0,this.showLabels=!0}};s([u()],M.prototype,"attributionVisible",void 0),s([u()],M.prototype,"exportOptions",void 0),s([u()],M.prototype,"forceFeatureAttributes",void 0),s([u()],M.prototype,"format",void 0),s([u()],M.prototype,"includeCharts",void 0),s([u()],M.prototype,"includeTables",void 0),s([u()],M.prototype,"label",void 0),s([u()],M.prototype,"layout",void 0),s([u({type:xe})],M.prototype,"layoutItem",void 0),s([u()],M.prototype,"layoutOptions",void 0),s([u()],M.prototype,"outScale",void 0),s([u()],M.prototype,"report",void 0),s([u({type:xe})],M.prototype,"reportItem",void 0),s([u()],M.prototype,"reportOptions",void 0),s([u()],M.prototype,"scalePreserved",void 0),s([u()],M.prototype,"showLabels",void 0),M=s([V("esri.rest.support.PrintTemplate")],M);const Lt=M,Ce=new Y({"Attribute List Letter ANSI A Landscape":"attribute-list-letter-ansi-a-landscape","Attribute List Letter ANSI A Portrait":"attribute-list-letter-ansi-a-portrait","Attribute List With Group Letter ANSI A Landscape":"attribute-list-with-group-letter-ansi-a-landscape","Attribute List With Group Letter ANSI A Portrait":"attribute-list-with-group-letter-ansi-a-portrait","Page per Feature Letter ANSI A Landscape":"page-per-feature-letter-ansi-a-landscape","Page per Feature Letter ANSI A Portrait":"page-per-feature-letter-ansi-a-portrait"});Ce.fromJSON.bind(Ce);const Ka=Ce.toJSON.bind(Ce),ht={Feet:"ft",Kilometers:"km",Meters:"m",Miles:"mi"},yt=new Y({esriFeet:"Feet",esriKilometers:"Kilometers",esriMeters:"Meters",esriMiles:"Miles"}),Za=new Y({esriExecutionTypeSynchronous:"sync",esriExecutionTypeAsynchronous:"async"}),je=new Map;async function Ya(e,t,i){var c;const a=await He(e,i),o=await Xa(t,a);if(await Pt(e,i)==="sync"){const{results:p}=await Ot(e,o,void 0,i);return(c=p==null?void 0:p[0])==null?void 0:c.value}const l=await St(e,o,void 0,i);await l.waitForJobCompletion({interval:t.updateDelay});const{value:r}=await l.fetchResultData("Output_File",null,i);return r}async function He(e,t){const i=ti(e),a=je.get(i)??{gpServerUrl:i,legendLayerNameMap:{},legendLayers:[]};return a.gpMetadata??(a.gpMetadata=(await Z(i,da({f:"json"},t))).data),a.cimVersion=a.gpMetadata.cimVersion,je.set(i,a),a}async function Pt(e,t){return Ti(await He(e,t))}async function Qa(e,t){return(await He(e,t)).gpMetadata.tasks}async function Xa(e,t){var h,w,O,b,y;t=t||{is11xService:!1,legendLayerNameMap:{},legendLayers:[]};const i=e.template||new Lt;i.showLabels==null&&(i.showLabels=!0);const a=i.exportOptions;let o;const l=Na(i.layout);if(a&&(o={dpi:a.dpi},l.toLowerCase()==="map_only"||l==="")){const f=a.width,g=a.height;o.outputSize=f!=null&&g!=null?[f,g]:void 0}const r=i.layoutOptions;let c;if(r){let f,g;r.scalebarUnit==="Miles"||r.scalebarUnit==="Kilometers"?(f="Kilometers",g="Miles"):r.scalebarUnit!=="Meters"&&r.scalebarUnit!=="Feet"||(f="Meters",g="Feet"),c={titleText:r.titleText,authorText:r.authorText,copyrightText:r.copyrightText,customTextElements:r.customTextElements,elementOverrides:r.elementOverrides,scaleBarOptions:{metricUnit:yt.toJSON(f),metricLabel:f?ht[f]:void 0,nonMetricUnit:yt.toJSON(g),nonMetricLabel:g?ht[g]:void 0}}}let p=null;r!=null&&r.legendLayers&&(p=r.legendLayers.map(f=>{const g=f.layerId;t.legendLayerNameMap[g]=f.title;const I={id:g};return f.subLayerIds&&(I.subLayerIds=f.subLayerIds),I}));const n=await ei(e,i,t);if(n.operationalLayers){const f=new RegExp("[\\u4E00-\\u9FFF\\u0E00-\\u0E7F\\u0900-\\u097F\\u3040-\\u309F\\u30A0-\\u30FF\\u31F0-\\u31FF]"),g=/[\u0600-\u06FF]/,I=S=>{var $;const P=S.text,L=S.font,T=($=L==null?void 0:L.family)==null?void 0:$.toLowerCase();P&&L&&(T==="arial"||T==="arial unicode ms")&&(L.family=f.test(P)?"Arial Unicode MS":"Arial",L.style!=="normal"&&g.test(P)&&(L.family="Arial Unicode MS"))};for(const S of n.operationalLayers)if((h=S.featureCollection)!=null&&h.layers)for(const P of S.featureCollection.layers){if((b=(O=(w=P.layerDefinition)==null?void 0:w.drawingInfo)==null?void 0:O.renderer)!=null&&b.symbol){const L=P.layerDefinition.drawingInfo.renderer;L.symbol.type==="esriTS"&&I(L.symbol)}if((y=P.featureSet)!=null&&y.features)for(const L of P.featureSet.features)L.symbol&&L.symbol.type==="esriTS"&&I(L.symbol)}}e.outSpatialReference&&(n.mapOptions.spatialReference=e.outSpatialReference.toJSON()),Object.assign(n,{exportOptions:o,layoutOptions:c||{}}),Object.assign(n.layoutOptions,{legendOptions:{operationalLayers:p??t.legendLayers.slice()}}),t.legendLayers.length=0,je.set(t.gpServerUrl,t);const m={Web_Map_as_JSON:JSON.stringify(n),Format:Tt(i.format),Layout_Template:l,Layout_Item_ID:void 0,Report_Template:Ka(i.report),Report_Item_ID:void 0};if(i.layoutItem){delete m.Layout_Template;const f=i.layoutItem;await f.load(),f.access!=="public"&&re&&await re.getCredential(t.gpServerUrl),m.Layout_Item_ID=JSON.stringify({id:f.id})}if(i.reportItem){delete m.Report_Template;const f=i.reportItem;await f.load(),f.access!=="public"&&re&&await re.getCredential(t.gpServerUrl),m.Report_Item_ID=JSON.stringify({id:f.id})}return e.extraParameters&&Object.assign(m,e.extraParameters),m}async function ei(e,t,i){const a=e.view;let o=a.spatialReference;const l={operationalLayers:await ai(a,t,i)};t.includeTables&&(l.tables=await fi(a));let r=e.extent||i.ssExtent||a.extent;if(o!=null&&o.isWrappable&&(r=r.clone()._normalize(!0),o=r.spatialReference),l.mapOptions={extent:r&&r.toJSON(),spatialReference:o&&o.toJSON(),showAttribution:t.attributionVisible},i.ssExtent=null,a.background&&(l.background=a.background.toJSON()),a.rotation&&(l.mapOptions.rotation=-a.rotation),t.scalePreserved&&(l.mapOptions.scale=t.outScale||a.scale),a.timeExtent!=null){const c=a.timeExtent.start!=null?a.timeExtent.start.getTime():null,p=a.timeExtent.end!=null?a.timeExtent.end.getTime():null;l.mapOptions.time=[c,p]}return t.reportOptions&&(l.reportOptions=t.reportOptions),l}function ti(e){let t=e;const i=t.lastIndexOf("/GPServer/");return i>0&&(t=t.slice(0,i+9)),t}async function ai(e,t,i){var c;const a=[],o={layerView:null,printTemplate:t,view:e};let l=0;t.scalePreserved&&(l=t.outScale||e.scale);const r=Ga(e,l);for(const p of r){const n=p.layer;if(!n.loaded||"layers"in n)continue;let m;o.layerView=p,m=qa(p)?await se(n,o,i):Ba(n)?ii(n):Ha(n)?await li(n,o,i):(n==null?void 0:n.type)==="catalog-footprint"?await oi(n,o,i):(n==null?void 0:n.type)==="feature"?await ni(n,o,i):(n==null?void 0:n.type)==="geojson"?await ri(n,o,i):(n==null?void 0:n.type)==="graphics"?await si(n,o,i):(n==null?void 0:n.type)==="imagery"?pi(n,i):(n==null?void 0:n.type)==="imagery-tile"?await ui(n,o,i):(n==null?void 0:n.type)==="kml"?await ci(n,o,i):(n==null?void 0:n.type)==="map-image"?di(n,o,i):(n==null?void 0:n.type)==="map-notes"?await mi(o,i):(n==null?void 0:n.type)==="open-street-map"?hi():(n==null?void 0:n.type)==="stream"?await yi(n,o,i):(n==null?void 0:n.type)==="tile"?bi(n,i):(n==null?void 0:n.type)==="vector-tile"?await gi(n,o,i):(n==null?void 0:n.type)==="web-tile"?vi(n):(n==null?void 0:n.type)==="wms"?wi(n,i):(n==null?void 0:n.type)==="wmts"?_i(n):await se(n,o,i),m&&(Array.isArray(m)?a.push(...m):(m.id=n.id,m.title=i.legendLayerNameMap[n.id]||n.title,m.opacity=p.fullOpacity,m.minScale=n.minScale||0,m.maxScale=n.maxScale||0,$t(n)&&n.blendMode&&n.blendMode!=="normal"&&(m.blendMode=n.blendMode),a.push(m)))}if(l)for(const p of a)p.minScale=0,p.maxScale=0;if((c=e.graphics)!=null&&c.length){const p=await B(null,e.graphics,t,i);p&&a.push(p)}return a}function ii(e){return{culture:e.culture,key:e.key,type:"BingMaps"+(e.style==="aerial"?"Aerial":e.style==="hybrid"?"Hybrid":"Road")}}async function oi(e,{layerView:t,printTemplate:i},a){if(parseFloat(a.cimVersion)<3.1)return B(e,await be(t),i,a);const o=e.parent,l={id:(r=H(o,"web-map")).id,url:r.url,layerType:r.layerType,customParameters:r.customParameters,dynamicGroupLayer:{visibility:!1},footprintLayer:r.footprintLayer,layerDefinition:r.layerDefinition};var r;return te(l,o),l}async function li(e,t,i){e.legendEnabled&&i.legendLayers.push({id:e.id});const a=t.layerView,o=t.printTemplate;if(!(a.filter||e.portalItem&&e.portalItem.access!=="public")){const l=H(e,"web-map");return l.type="CSV",delete l.popupInfo,delete l.layerType,l.showLabels=o.showLabels&&e.labelsVisible,l}return B(e,await be(a),o,i)}async function B(e,t,i,a){var f,g,I,S,P,L;let o;const l=Ra(),r=Ua(),c=mt(),p=Va(),n=mt();if(n.layerDefinition.name="textLayer",delete n.layerDefinition.drawingInfo,e){if(e.declaredClass==="esri.layers.FeatureLayer"||e.declaredClass==="esri.layers.StreamLayer"?l.layerDefinition.name=r.layerDefinition.name=c.layerDefinition.name=p.layerDefinition.name=a.legendLayerNameMap[e.id]||e.get("arcgisProps.title")||e.title:e.declaredClass==="esri.layers.GraphicsLayer"&&(t=e.graphics.items),e.renderer){const T=e.renderer.toJSON(),$=l.layerDefinition.drawingInfo;$&&($.renderer=T);const F=r.layerDefinition.drawingInfo;F&&(F.renderer=T);const R=c.layerDefinition.drawingInfo;R&&(R.renderer=T);const X=p.layerDefinition.drawingInfo;X&&(X.renderer=T)}if(i.showLabels&&e.labelsVisible&&typeof e.write=="function"){const T=H(e,"web-map"),$=(g=(f=T.layerDefinition)==null?void 0:f.drawingInfo)==null?void 0:g.labelingInfo;if($){o=!0;const F=l.layerDefinition.drawingInfo;F&&(F.labelingInfo=$);const R=r.layerDefinition.drawingInfo;R&&(R.labelingInfo=$);const X=c.layerDefinition.drawingInfo;X&&(X.labelingInfo=$);const ge=p.layerDefinition.drawingInfo;ge&&(ge.labelingInfo=$)}}}let m;e!=null&&e.renderer||o||(delete l.layerDefinition.drawingInfo,delete r.layerDefinition.drawingInfo,delete c.layerDefinition.drawingInfo,delete p.layerDefinition.drawingInfo);const h=e==null?void 0:e.fieldsIndex,w=e==null?void 0:e.renderer;if(h){const T=new Set;o&&await Yt(T,e),w&&typeof w.collectRequiredFields=="function"&&await w.collectRequiredFields(T,h),m=Array.from(T);const $=h.fields.map(F=>F.toJSON());l.layerDefinition.fields=$,r.layerDefinition.fields=$,c.layerDefinition.fields=$,p.layerDefinition.fields=$}const O=t==null?void 0:t.length;let b;for(let T=0;T<O;T++){const $=t[T]||t.at(T);if($.visible!==!1&&$.geometry){if(b=$.toJSON(),b.hasOwnProperty("popupTemplate")&&delete b.popupTemplate,(I=b.geometry)!=null&&I.z&&delete b.geometry.z,b.symbol&&(b.symbol.angle||delete b.symbol.angle,Ie(b.symbol)?b.symbol=await Te(b.symbol,a):b.symbol.text&&delete b.attributes),(!i||!i.forceFeatureAttributes)&&(m==null?void 0:m.length)){const F={};for(const R of m)(S=b.attributes)!=null&&S.hasOwnProperty(R)&&(F[R]=b.attributes[R]);b.attributes=F}$.geometry.type==="polygon"?l.featureSet.features.push(b):$.geometry.type==="polyline"?r.featureSet.features.push(b):$.geometry.type==="point"?(P=b.symbol)!=null&&P.text?n.featureSet.features.push(b):c.featureSet.features.push(b):$.geometry.type==="multipoint"?p.featureSet.features.push(b):$.geometry.type==="extent"&&(b.geometry=Qt.fromExtent($.geometry).toJSON(),l.featureSet.features.push(b))}}const y=[l,r,p,c,n].filter(T=>T.featureSet.features.length>0);for(const T of y){const $=T.featureSet.features.every(F=>F.symbol);if($&&(!i||!i.forceFeatureAttributes))for(const F of T.featureSet.features)delete F.attributes;$&&delete T.layerDefinition.drawingInfo,(L=T.layerDefinition.drawingInfo)!=null&&L.renderer&&await Ct(T.layerDefinition.drawingInfo.renderer,a)}return y.length?{featureCollection:{layers:y},showLabels:o}:null}async function ni(e,t,i){var h,w,O,b,y,f,g;let a;const o=e.renderer,l=parseFloat(i.cimVersion);if(((h=e.featureReduction)==null?void 0:h.type)==="binning"||((w=e.featureReduction)==null?void 0:w.type)==="cluster"&&l<2.9||(o==null?void 0:o.type)==="pie-chart"||(o==null?void 0:o.type)==="dot-density"&&l<2.6)return se(e,t,i);e.legendEnabled&&i.legendLayers.push({id:e.id});const r=t.layerView,{printTemplate:c,view:p}=t,n=((O=e.source)==null?void 0:O.type)!=="feature-layer"&&((b=e.source)==null?void 0:b.type)!=="ogc-feature";if(r.filter||n||!o||"field"in o&&o.field!=null&&!e.getField(o.field)){const I=await be(r);a=await B(e,I,c,i)}else{if(a={id:(m=H(e)).id,title:m.title,url:m.url,layerType:m.layerType,customParameters:m.customParameters,layerDefinition:m.layerDefinition,charts:c.includeCharts?m.charts:void 0},a.showLabels=c.showLabels&&e.labelsVisible,te(a,e),((f=(y=a.layerDefinition)==null?void 0:y.drawingInfo)==null?void 0:f.renderer)&&(delete a.layerDefinition.minScale,delete a.layerDefinition.maxScale,await Ct(a.layerDefinition.drawingInfo.renderer,i),"visualVariables"in o&&o.visualVariables&&o.visualVariables[0])){const S=o.visualVariables[0];if(S.type==="size"&&S.maxSize&&typeof S.maxSize!="number"&&S.minSize&&typeof S.minSize!="number"){const P=Xt(S,p.scale);a.layerDefinition.drawingInfo.renderer.visualVariables[0].minSize=P.minSize,a.layerDefinition.drawingInfo.renderer.visualVariables[0].maxSize=P.maxSize}}const I=_a(r);if(I&&(a.layerDefinition??(a.layerDefinition={}),a.layerDefinition.definitionExpression=a.layerDefinition.definitionExpression?`(${a.layerDefinition.definitionExpression}) AND (${I})`:I),e.gdbVersion&&(a.layerDefinition??(a.layerDefinition={}),a.layerDefinition.gdbVersion=e.gdbVersion),((g=r.hasHighlight)==null?void 0:g.call(r))&&"getHighlightIds"in r){const S=r;a.selectionObjectIds=S.getHighlightIds(),a.selectionSymbol=Ja(e.geometryType,S.highlightOptions??p.highlightOptions)}}var m;return a}async function ri(e,t,i){var a,o;return((a=e.featureReduction)==null?void 0:a.type)==="binning"||((o=e.featureReduction)==null?void 0:o.type)==="cluster"?se(e,t,i):(e.legendEnabled&&i.legendLayers.push({id:e.id}),B(e,await be(t.layerView),t.printTemplate,i))}async function si(e,{printTemplate:t},i){return B(e,null,t,i)}function pi(e,t){var o;e.legendEnabled&&t.legendLayers.push({id:e.id});const i={layerType:(a=H(e)).layerType,customParameters:a.customParameters};var a;return i.bandIds=e.bandIds,i.compressionQuality=e.compressionQuality,i.format=e.format,i.interpolation=e.interpolation,(e.mosaicRule||e.definitionExpression)&&(i.mosaicRule=e.exportImageServiceParameters.mosaicRule.toJSON()),e.rasterFunction&&(i.renderingRule=e.rasterFunction.toJSON()),e.renderer&&(i.layerDefinition??(i.layerDefinition={}),(o=i.layerDefinition).drawingInfo??(o.drawingInfo={}),i.layerDefinition.drawingInfo.renderer=e.renderer.toJSON()),te(i,e),i}async function ui(e,t,i){var l;if(((l=e.renderer)==null?void 0:l.type)==="flow")return se(e,t,i);e.legendEnabled&&i.legendLayers.push({id:e.id});const a={bandIds:(o=H(e)).bandIds,customParameters:o.customParameters,interpolation:o.interpolation,layerDefinition:o.layerDefinition};var o;return a.layerType="ArcGISImageServiceLayer",te(a,e),a}async function ci(e,t,i){const a=t.printTemplate;if(!e.portalItem||e.portalItem.access==="public"){const p=H(e,"web-map");return p.type="kml",delete p.layerType,p.url=fe(e.url),p}const o=[],l=t.layerView;l.allVisibleMapImages.forEach((p,n)=>{const m={id:`${e.id}_image${n}`,type:"image",title:e.id,minScale:e.minScale||0,maxScale:e.maxScale||0,opacity:l.fullOpacity,extent:p.extent};p.href.substr(0,22)==="data:image/png;base64,"?m.imageData=p.href.substr(22):m.url=p.href,o.push(m)});const r=[...l.allVisiblePoints.items,...l.allVisiblePolylines.items,...l.allVisiblePolygons.items],c={id:e.id,...await B(null,r,a,i)};return o.push(c),o}function di(e,{view:t},i){var n,m;let a;const o={id:e.id,subLayerIds:[]};let l=[];const r=t.scale,c=h=>{const w=r===0,O=h.minScale===0||r<=h.minScale,b=h.maxScale===0||r>=h.maxScale;if(h.visible&&(w||O&&b))if(h.sublayers)h.sublayers.forEach(c);else{const y=h.toExportImageJSON(),f={id:h.id,name:h.title,layerDefinition:{drawingInfo:y.drawingInfo,definitionExpression:y.definitionExpression,source:y.source}};l.unshift(f),o.subLayerIds.push(h.id)}};var p;return e.sublayers&&e.sublayers.forEach(c),l.length&&(l=l.map(({id:h,name:w,layerDefinition:O})=>({id:h,name:w,layerDefinition:O})),a={layerType:(p=H(e)).layerType,customParameters:p.customParameters},a.layers=l,a.visibleLayers=(m=(n=e.capabilities)==null?void 0:n.exportMap)!=null&&m.supportsDynamicLayers?void 0:o.subLayerIds,e.gdbVersion&&(a.gdbVersion=e.gdbVersion),te(a,e),e.legendEnabled&&i.legendLayers.push(o)),a}async function mi({layerView:e,printTemplate:t},i){const a=[],o=e.layer;if(o.featureCollections!=null)for(const l of o.featureCollections){const r=await B(l,l.source,t,i);r&&a.push(...r.featureCollection.layers)}else if(o.sublayers!=null)for(const l of o.sublayers){const r=await B(null,l.graphics,t,i);r&&a.push(...r.featureCollection.layers)}return{featureCollection:{layers:a}}}function hi(){return{type:"OpenStreetMap"}}async function se(e,{printTemplate:t,view:i},a){var h;const o={type:"image"},l={format:"png",ignoreBackground:!0,ignorePadding:!0,layers:[e]};i.rotation!==0&&(l.rotation=0);const r=a.ssExtent||i.state.extent.clone();let c=96,p=!0,n=!0;if(t.exportOptions){const w=t.exportOptions;w.dpi!=null&&w.dpi>0&&(c=w.dpi),w.width!=null&&w.width>0&&(p=w.width%2==i.width%2),w.height!=null&&w.height>0&&(n=w.height%2==i.height%2)}if(t.layout==="map-only"&&t.scalePreserved&&(!t.outScale||t.outScale===i.scale)&&c===96&&(!p||!n)&&i.state.extent.equals(i.extent)&&(l.area={x:0,y:0,width:i.width,height:i.height},p||(l.area.width-=1),n||(l.area.height-=1),!a.ssExtent)){const w=i.toMap(bt(l.area.width,l.area.height));r.ymin=w.y,r.xmax=w.x,a.ssExtent=r}o.extent=r.clone()._normalize(!0).toJSON();const m=await i.takeScreenshot(l);return o.imageData=(h=ea(m.dataUrl))==null?void 0:h.data,o}async function yi(e,{layerView:t,printTemplate:i},a){return e.legendEnabled&&a.legendLayers.push({id:e.id}),B(e,await be(t),i,a)}async function fi(e){var o,l;const t=[],i=[];for(const r of e.map.allTables)r.type!=="feature"||r.loaded||i.push(r.load());i.length&&await Promise.allSettled(i);for(const r of e.map.allTables)if(r.type==="feature"&&r.loaded&&r.isTable&&((o=r.source)==null?void 0:o.type)==="feature-layer"){const c={id:(a=H(r)).id,title:a.title,customParameters:a.customParameters,layerDefinition:{definitionExpression:(l=a.layerDefinition)==null?void 0:l.definitionExpression},url:a.url};te(c,r),t.push(c)}var a;return t.length?t:void 0}function bi(e,t){e.legendEnabled&&t.legendLayers.push({id:e.id});const i={layerType:(a=H(e)).layerType,customParameters:a.customParameters};var a;return te(i,e),i}async function gi(e,t,i){if(e.serviceUrl&&e.styleUrl){const a=Se(e.styleUrl,e.apiKey),o=Se(e.serviceUrl,e.apiKey);if(!a&&!o||i.cimVersion!=="2.1.0"){const l={type:"VectorTileLayer"};return l.styleUrl=fe(e.styleUrl),l.token=a,o!==a&&(l.additionalTokens=[{url:e.serviceUrl,token:o}]),l}}return se(e,t,i)}function vi(e){var a;const t=(a=e.urlTemplate)==null?void 0:a.replace(/\${/g,"{"),i={type:"WebTiledLayer",urlTemplate:t,credits:e.copyright};return e.subDomains&&e.subDomains.length>0&&(i.subDomains=e.subDomains),i}function wi(e,t){let i;const a=[],o=l=>{l.visible&&(l.sublayers?l.sublayers.forEach(o):l.name&&a.unshift(l.name))};return e.sublayers&&e.sublayers.forEach(o),a.length&&(e.legendEnabled&&t.legendLayers.push({id:e.id,subLayerIds:a}),i={type:"wms",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,transparentBackground:e.imageTransparency,visibleLayers:a,url:fe(e.url),version:e.version}),i}function _i(e){const t=e.activeLayer;return{type:"wmts",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,format:t.imageFormat,layer:t.id,style:t.styleId,tileMatrixSet:t.tileMatrixSetId,url:fe(e.url)}}function te(e,t){t.url&&(e.url=fe(e.url||t.url),e.token=Se(e.url,t.apiKey))}async function Te(e,t){var r;t.canvas||(t.canvas=document.createElement("canvas"));const i=1024;t.canvas.width=i,t.canvas.height=i;const a=t.canvas.getContext("2d");let o,l;if(e.path){const c=new Path2D(e.path);c.closePath(),a.fillStyle=Array.isArray(e.color)?`rgba(${e.color[0]},${e.color[1]},${e.color[2]},${e.color[3]/255})`:"rgb(0,0,0)",a.fill(c);const p=ja(a);if(!p)return null;a.clearRect(0,0,i,i);const n=ve(e.size)/Math.max(p.width,p.height);a.scale(n,n);const m=i/n,h=m/2-p.width/2-p.x,w=m/2-p.height/2-p.y;if(a.translate(h,w),Array.isArray(e.color)&&a.fill(c),((r=e.outline)==null?void 0:r.width)&&Array.isArray(e.outline.color)){const b=e.outline;a.lineWidth=ve(b.width)/n,a.lineJoin="round",a.strokeStyle=`rgba(${b.color[0]},${b.color[1]},${b.color[2]},${b.color[3]/255})`,a.stroke(c),p.width+=a.lineWidth,p.height+=a.lineWidth}p.width*=n,p.height*=n;const O=a.getImageData(i/2-p.width/2,i/2-p.height/2,Math.ceil(p.width),Math.ceil(p.height));o=O.width,l=O.height,a.canvas.width=o,a.canvas.height=l,a.putImageData(O,0,0)}else{const c=e.contentType==="image/svg+xml"?"data:image/svg+xml;base64,"+e.imageData:e.url,p=(await Z(c,{responseType:"image"})).data;o=ve(e.width),l=ve(e.height),a.canvas.width=o,a.canvas.height=l,a.drawImage(p,0,0,a.canvas.width,a.canvas.height)}return{type:"esriPMS",imageData:a.canvas.toDataURL("image/png").substr(22),angle:e.angle,contentType:"image/png",height:nt(l),width:nt(o),xoffset:e.xoffset,yoffset:e.yoffset}}async function Ct(e,t){const i=e.type;if(i==="simple"&&Ie(e.symbol))e.symbol=await Te(e.symbol,t);else if(i==="uniqueValue"||i==="classBreaks"){Ie(e.defaultSymbol)&&(e.defaultSymbol=await Te(e.defaultSymbol,t));const a=e[i==="uniqueValue"?"uniqueValueInfos":"classBreakInfos"];if(a)for(const o of a)Ie(o.symbol)&&(o.symbol=await Te(o.symbol,t))}}async function be(e){return e.queryFeatures(e.createQuery()).then(t=>t.features)}function H(e,t){return e.write({},{ignorePersistenceEnabled:!0,origin:t})??{}}function Ti(e){var t;return(t=e.gpMetadata)!=null&&t.executionType?Za.fromJSON(e.gpMetadata.executionType):"sync"}function Ie(e){var t;return e&&(e.path||e.contentType==="image/svg+xml"||((t=e.url)==null?void 0:t.endsWith(".svg")))}let q=class extends pe{constructor(t){super(t),this.extent=null,this.extraParameters=null,this.outSpatialReference=null,this.template=null,this.updateDelay=1e3,this.view=null}};s([u()],q.prototype,"extent",void 0),s([u()],q.prototype,"extraParameters",void 0),s([u()],q.prototype,"outSpatialReference",void 0),s([u()],q.prototype,"template",void 0),s([u()],q.prototype,"updateDelay",void 0),s([u()],q.prototype,"view",void 0),q=s([V("esri.rest.support.PrintParameters")],q);const Ii=q;let E=class extends pe{constructor(t){super(t),this.strokeDash=[],this.strokeWidth=2,this.strokeColor=[0,0,0,1],this.strokeBackgroundColor=[0,0,0,0],this.fillColor=[0,0,0,0],this.backgroundFillColor=[0,0,0,.5],this.visible=!0,this.isDecoration=!1,this.boxWidth=0,this.boxHeight=0,this.backgroundWidth=0,this.backgroundHeight=0,this.padding={left:0,top:0,right:0,bottom:0}}get _strokeStyle(){return`rgba(${this.strokeColor.join()})`}get _strokeBackgroundStyle(){return`rgba(${this.strokeBackgroundColor.join()})`}get _fillStyle(){return`rgba(${this.fillColor.join()})`}get _backgroundFillStyle(){return`rgba(${this.backgroundFillColor.join()})`}render(){const{backgroundWidth:t,backgroundHeight:i,boxWidth:a,boxHeight:o,padding:l}=this,r=l.left,c=l.top,p=this.x??r+t/2-a/2,n=this.y??c+i/2-o/2,m=p+a,h=n+o;return d("div",{classes:{"esri-box-overlay-item":!0},styles:{left:"0px",top:"0px",width:"100%",height:"100%",visibility:this.visible?"visible":"hidden"}},d("svg",{styles:{width:"100%",height:"100%"}},d("path",{d:`M ${r} ${c} L ${t+r} ${c} L ${t+r} ${i+c} L ${r} ${i+c} Z M ${p} ${n} L ${p} ${h} L ${m} ${h} L ${m} ${n} Z`,fill:this._backgroundFillStyle,stroke:this._strokeBackgroundStyle,"stroke-width":this.strokeWidth}),d("rect",{fill:this._fillStyle,height:o,stroke:this._strokeStyle,"stroke-dasharray":this.strokeDash.join(" ")||void 0,"stroke-width":this.strokeWidth,width:a,x:p,y:n})))}renderCanvas(){}};s([u()],E.prototype,"strokeDash",void 0),s([u()],E.prototype,"strokeWidth",void 0),s([u()],E.prototype,"strokeColor",void 0),s([u()],E.prototype,"strokeBackgroundColor",void 0),s([u()],E.prototype,"fillColor",void 0),s([u()],E.prototype,"backgroundFillColor",void 0),s([u()],E.prototype,"visible",void 0),s([u()],E.prototype,"isDecoration",void 0),s([u()],E.prototype,"boxWidth",void 0),s([u()],E.prototype,"boxHeight",void 0),s([u()],E.prototype,"backgroundWidth",void 0),s([u()],E.prototype,"backgroundHeight",void 0),s([u()],E.prototype,"x",void 0),s([u()],E.prototype,"y",void 0),s([u()],E.prototype,"padding",void 0),s([u({readOnly:!0})],E.prototype,"_strokeStyle",null),s([u({readOnly:!0})],E.prototype,"_strokeBackgroundStyle",null),s([u({readOnly:!0})],E.prototype,"_fillStyle",null),s([u({readOnly:!0})],E.prototype,"_backgroundFillStyle",null),E=s([V("esri.views.overlay.BoxOverlayItem")],E);const xi=E;let G=class extends Q{constructor(e){super(e),this.description=null,this.format=null,this.label=null,this.layout=null,this.layoutItem=null,this.layoutOptions=null,this.layoutTemplateInfo=null}};s([u()],G.prototype,"description",void 0),s([u({json:{read:we}})],G.prototype,"format",void 0),s([u()],G.prototype,"label",void 0),s([u({json:{read:he}})],G.prototype,"layout",void 0),s([u({type:xe})],G.prototype,"layoutItem",void 0),s([u()],G.prototype,"layoutOptions",void 0),s([u()],G.prototype,"layoutTemplateInfo",void 0),G=s([V("esri.widgets.Print.CustomTemplate")],G);const ye=G;let D=class extends pe{constructor(e){super(e),this.attributionEnabled=!0,this.author=null,this.copyright=null,this.customTextElements=null,this.dpi=96,this.fileName=null,this.forceFeatureAttributes=!1,this.format="pdf",this.height=null,this.includeTables=!0,this.layout="letter-ansi-a-landscape",this.layoutItem=null,this.legendEnabled=!0,this.northArrowEnabled=!1,this.scale=null,this.scaleEnabled=!1,this.title=null,this.width=null}};s([u()],D.prototype,"attributionEnabled",void 0),s([u()],D.prototype,"author",void 0),s([u()],D.prototype,"copyright",void 0),s([u()],D.prototype,"customTextElements",void 0),s([u()],D.prototype,"dpi",void 0),s([u()],D.prototype,"fileName",void 0),s([u()],D.prototype,"forceFeatureAttributes",void 0),s([u()],D.prototype,"format",void 0),s([u()],D.prototype,"height",void 0),s([u()],D.prototype,"includeTables",void 0),s([u()],D.prototype,"layout",void 0),s([u({type:xe})],D.prototype,"layoutItem",void 0),s([u()],D.prototype,"legendEnabled",void 0),s([u()],D.prototype,"northArrowEnabled",void 0),s([u()],D.prototype,"scale",void 0),s([u()],D.prototype,"scaleEnabled",void 0),s([u()],D.prototype,"title",void 0),s([u()],D.prototype,"width",void 0),D=s([V("esri.widgets.Print.TemplateOptions")],D);const kt=D,Oi=new Set(["GISProfessionalStdUT","GISProfessionalAdvUT"]),Si=/(\/GPServer\/).+/i,$i=new Y({inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers"}),ke=gt.ofType(ye);function Li(e){var i;e.layoutOptions??(e.layoutOptions={}),(i=e.layoutOptions).customTextElements??(i.customTextElements=[]);const t="date";if(!e.layoutOptions.customTextElements.find(a=>t in a)){const{customTextElements:a}=e.layoutOptions;let o=la(Date.now(),na("short-date"));ra()==="ar"&&(o="â€"+o),a.push({date:o})}}let C=class extends ta{constructor(e){super(e),this._serviceTemplateCustomTextElements=null,this._layoutToTemplateInfo=new ba,this._isFreeHand=!1,this._freeHandWidth=0,this._freehandHeight=0,this._asyncPrintTaskUrl=null,this._layoutInfoTaskUrl=null,this.allowedFormats="all",this.allowedLayouts="all",this.browseTemplates=new ke,this.defaultTemplates=new ke,this.error=null,this.extraParameters=null,this.includeDefaultTemplates=!0,this.portal=vt.getDefault(),this.portalTemplateIds=[],this.showPrintAreaEnabled=!1,this.printServiceUrl=null,this.printTimeout=12e4,this.templatesInfo=null,this.updateDelay=1e3,this.view=null,this.templateCustomTextElements=null,this.templateOptions=new kt}initialize(){this.addHandles(ee(()=>this.showPrintAreaEnabled,e=>{var t,i;e?this._enablePrintPreview():(this.removeHandles("overlay-handler"),(i=(t=this.view)==null?void 0:t.overlay)==null||i.removeItem(this._getOverlayItem()))}))}destroy(){var e;this.removeHandles("overlay-handler"),this.view&&(this._overlayItem&&((e=this.view.overlay)==null||e.removeItem(this._overlayItem),this._overlayItem.destroy(),this._overlayItem=null),this.view=null)}get effectivePrintServiceUrl(){return this.printServiceUrl??null}get effectiveTemplateCustomTextElements(){if(!this._serviceTemplateCustomTextElements)return{};const e=Oe(this._serviceTemplateCustomTextElements);return this.templateCustomTextElements&&Object.keys(this.templateCustomTextElements).forEach(t=>{var a;const i=e[t];if(i){const o=(a=this.templateCustomTextElements)==null?void 0:a[t];i.forEach(l=>{const[r]=Object.entries(l)[0];o==null||o.forEach(c=>{const[p,n]=Object.entries(c)[0];r===p&&(l[r]=n)})})}}),Object.freeze(e)}get layoutTemplateInfo(){var t;const e=((t=this.templateOptions.layoutItem)==null?void 0:t.id)??this.templateOptions.layout;return e?this._layoutToTemplateInfo.get(e):null}get state(){var e;return this.loadStatus==="loading"?"initializing":this.loadStatus==="failed"||this.error?"error":this.loadStatus==="loaded"&&((e=this.view)!=null&&e.ready)?"ready":"disabled"}get layoutTemplateNorthArrowInfo(){var e,t;return(t=(e=this.layoutTemplateInfo)==null?void 0:e.layoutOptions)!=null&&t.mapSurroundInfos?this.layoutTemplateInfo.layoutOptions.mapSurroundInfos.find(i=>i.type==="CIMMarkerNorthArrow"):null}async load(e){return this.addResolvingPromise(this._loadResources(e).catch(t=>this.error=t)),this}async print(e){var c;const{view:t,extraParameters:i,updateDelay:a}=this;if(!t)throw new K("print:view-required","view is not set");Li(e);const o=this._getOverlayItem(),l=e.scalePreserved||!this.showPrintAreaEnabled?void 0:Ia(new Je,t.viewpoint,e.layout==="MAP_ONLY"?[e.exportOptions.width,e.exportOptions.height]:[o.boxWidth,o.boxHeight]),r=new Ii({view:t,template:e,extent:l,extraParameters:i,updateDelay:a});try{const p=!!((c=e.layoutItem)!=null&&c.id)&&(this.portalTemplateIds.includes(e.layoutItem.id)||this.browseTemplates.some(n=>{var m,h;return((m=n.layoutItem)==null?void 0:m.id)===((h=e.layoutItem)==null?void 0:h.id)}));return await Ya(p&&this._asyncPrintTaskUrl?this._asyncPrintTaskUrl:this.effectivePrintServiceUrl,r,{timeout:this.printTimeout})}catch(p){throw new K("print:export-error","An error occurred while exporting the web map.",{error:p})}}toPrintTemplate({attributionEnabled:e,author:t,copyright:i,customTextElements:a,dpi:o,forceFeatureAttributes:l,format:r,height:c,includeTables:p,layout:n,layoutItem:m,legendEnabled:h,northArrowEnabled:w,scale:O,scaleEnabled:b,title:y,width:f}){if(!n)throw new K("print:layout-required","layout is not set");const g=new Lt({attributionVisible:e,forceFeatureAttributes:l,format:r,includeTables:p,layout:n,layoutItem:m,layoutOptions:{authorText:t||"",copyrightText:i||"",customTextElements:a,titleText:y||""},outScale:O??0,scalePreserved:b});f&&(g.exportOptions.width=f),c&&(g.exportOptions.height=c),o&&(g.exportOptions.dpi=o),!h&&g.layoutOptions&&(g.layoutOptions.legendLayers=[]);const I=this.layoutTemplateNorthArrowInfo;return I&&I.visible!==w&&g.layoutOptions&&(g.layoutOptions.elementOverrides={[I.name]:{visible:w}}),g}async fetchLayoutTemplateInfo(e,t){var p;if(!((p=e.layoutItem)!=null&&p.id))return;const i=await this._fetchPortalLayoutTemplateInfo(e.layoutItem,t);this._layoutToTemplateInfo.set(e.layoutItem.id,i),e.layoutTemplateInfo=i;const{hasLegend:a,mapSurroundInfos:o,customTextElements:l}=i.layoutOptions,r=o.some(({type:n,visible:m})=>n==="CIMMarkerNorthArrow"&&m);e.layoutOptions={legend:a,northArrow:r};const c=Oe(this._serviceTemplateCustomTextElements)??{};c[e.layoutItem.id]=l,this._serviceTemplateCustomTextElements=Object.freeze(c)}getLayoutTemplateInfo(e){return this._layoutToTemplateInfo.get(e)}async addPortalTemplate(e){const t=new ye({label:e.title,layoutItem:e});this.browseTemplates.add(t)}removePortalTemplate(e){var t,i,a,o;(t=e.layoutItem)!=null&&t.id&&((i=this.templateOptions.layoutItem)==null?void 0:i.id)===e.layoutItem.id&&(this.templateOptions.layout=this.defaultTemplates.length||this.browseTemplates.length?null:(o=(a=this.templatesInfo)==null?void 0:a.layout)==null?void 0:o.defaultValue,this.templateOptions.layoutItem=null),this._layoutToTemplateInfo.delete(e.layoutItem.id),this.browseTemplates.remove(e)}async _loadResources(e){var r,c,p;let t=[];if(this.printServiceUrl)this._set("effectivePrintServiceUrl",this.printServiceUrl),await this._updateLayoutInfoTaskUrl(this.effectivePrintServiceUrl);else{if(this.destroyed)return;try{await this.portal.load(e)}catch(n){throw new K("print:could-not-load-portal","Cannot load print resource information from portal",{error:n,url:this.effectivePrintServiceUrl})}if(this.portal.helperServices){const{asyncPrintTask:n,layoutInfoTask:m,printTask:h}=this.portal.helperServices;h&&(this._set("effectivePrintServiceUrl",h.url),t=((r=h.templates)==null?void 0:r.map(w=>ye.fromJSON(w)))??[]),this._asyncPrintTaskUrl=n==null?void 0:n.url,await this._updateLayoutInfoTaskUrl((m==null?void 0:m.url)||this.effectivePrintServiceUrl)}}this.defaultTemplates.addMany(t);const i=(c=this.effectivePrintServiceUrl)==null?void 0:c.toLowerCase().split("/");if(!(i!=null&&i.includes("gpserver")))throw new K("print:invalid-print-service-url","Can't fetch print templates information from provided URL",{url:this.effectivePrintServiceUrl});const[a,o,l]=await Promise.all([this._getPrintServiceLayouts(e),this._getPrintServiceTemplates(e),this._getPortalCustomTemplates(e)]);if(this._processPrintServiceLayouts(a),this._processPrintServiceTemplates(o),this._processPortalTemplates(l),(p=this.templateOptions.layoutItem)==null?void 0:p.id){const n=this.templateOptions.layoutItem.id;let m=this.defaultTemplates.find(h=>{var w;return((w=h.layoutItem)==null?void 0:w.id)===n});m||(m=new ye({label:this.templateOptions.layoutItem.title,layoutItem:this.templateOptions.layoutItem})),await this.fetchLayoutTemplateInfo(m,e),this.templateOptions.layout=n}this._updateOverLayItem()}async _updateLayoutInfoTaskUrl(e,t){if(!e)return;const i=(await Qa(e,t)).find(a=>a.includes("Get Layout Templates Info"));i&&(this._layoutInfoTaskUrl=e.replace(Si,`$1${encodeURI(i)}`))}async _getPortalCustomTemplates(e){if(this.printServiceUrl||!this.portal)return[];const{layoutGroupQuery:t,user:i}=this.portal,a=wt.test(this.portal.url),o=i==null?void 0:i.userLicenseTypeId,l=o&&Oi.has(o);if(!t||a&&!l)return[];const r=new rt({query:t,disableExtraQuery:!0}),c=await this.portal.queryGroups(r,e);if(!c.total)return[];const p=c.results[0],n=new rt({num:100,query:"type:Layout",sortField:p.sortField,sortOrder:p.sortOrder??void 0}),m=(await p.queryItems(n,e)).results;return m.length?m.map(h=>new ye({label:h.title,layoutItem:h})):[]}async _fetchPortalLayoutTemplateInfo(e,t){const{id:i}=e,a=this._layoutInfoTaskUrl;if(!a)throw new K("print:invalid-layout-info-task-url","Can't fetch layout template info",{url:a});e.access!=="public"&&re&&await re.getCredential(a);const o={Layout_Item_ID:JSON.stringify({id:i})};return(await this._fetchLayoutTemplateInfos(o,t))[0]}async _fetchLayoutTemplateInfos(e,t){const i=this._layoutInfoTaskUrl;if(!i)throw new K("print:invalid-layout-info-task-url","Can't fetch layout template info",{url:i});if(await Pt(i)==="async"){const a=await St(i,e,void 0,t||void 0);return await a.waitForJobCompletion({interval:1e3}),(await a.fetchResultData("Output_JSON")).value}return(await Ot(i,e,null,t)).results[0].value}_processPortalTemplates(e){var t;if(e){this.defaultTemplates.addMany(e);for(const i of e)(t=i.layoutItem)!=null&&t.id&&this.portalTemplateIds.push(i.layoutItem.id)}}_processPrintServiceTemplates(e){this._set("templatesInfo",e)}async _getPrintServiceLayouts(e){let t=[];try{t=await this._fetchLayoutTemplateInfos(void 0,e)}catch{}return t}_processPrintServiceLayouts(e){const t={};for(const i of e){const{layoutTemplate:a,layoutOptions:o}=i,l=he(a);this._layoutToTemplateInfo.set(l,i),t[l]=o.customTextElements}this._serviceTemplateCustomTextElements=Object.freeze(t)}async _getPrintServiceTemplates(e){let t;try{({data:t}=await Z(this.effectivePrintServiceUrl,{...e,query:{f:"json"},timeout:this.printTimeout}))}catch(l){throw aa(l)?l:new K("print:unavailable-service-info","Can't fetch templates info from service",{error:l})}const{parameters:i}=t,a=i.find(({name:l})=>l==="Format"),o=i.find(({name:l})=>l==="Layout_Template");return{format:this._getFormat(a),layout:this._getLayout(o)}}_getFormat(e){const t=this.allowedFormats==="all"?e.choiceList:e.choiceList.filter(l=>this.allowedFormats.includes(we(l))),i=(t.length?t:e.choiceList).map(we).filter(st),a=we(e.defaultValue),o=i.includes(a)?a:i[0];return{choiceList:i,defaultValue:o}}_getLayout(e){const t=e.choiceList.filter(r=>r.toLowerCase()!=="map_only"),i=this.allowedLayouts==="all"?t:t.filter(r=>this.allowedLayouts.includes(he(r))),a=(i.length?i:t).map(he).filter(st),o=he(e.defaultValue),l=a.includes(o)?o:a.find(r=>/(?=.*letter)(?=.*landscape)/i.test(r))??a.find(r=>/(?=.*a4)(?=.*landscape)/i.test(r))??a[0];return{choiceList:a,defaultValue:l}}_getOverlayItem(){return this._overlayItem||(this._overlayItem=new xi({strokeDash:[5],strokeWidth:2,strokeColor:[30,144,255,255]})),this._overlayItem}_enablePrintPreview(){var i,a,o;if(!((i=this.view)!=null&&i.overlay))return;const e=this.templateOptions,t=this._getOverlayItem();this.addHandles([ee(()=>{var l,r,c,p;return[e.width,e.height,e.scaleEnabled,e.scale,e.layout,e.layoutItem,(l=this.view)==null?void 0:l.scale,(r=this.view)==null?void 0:r.size,(c=this.view)==null?void 0:c.state.paddedViewState.size,(p=this.view)==null?void 0:p.state.padding]},()=>this._updateOverLayItem(),ft),(a=this.view)==null?void 0:a.on("drag",["Shift"],l=>this._handleDrag(l),dt.WIDGET),(o=this.view)==null?void 0:o.on("key-down",["Escape"],()=>this._resetDrag(),dt.WIDGET)],"overlay-handler"),this.view.overlay.addItem(t)}_updateOverLayItem(){var O;if(!this.view)return;const e=this.templateOptions,t=this._getOverlayItem(),i=((O=e.layoutItem)==null?void 0:O.id)??e.layout,a=this.view,o=a.spatialReference,[l,r]=a.state.paddedViewState.size,c=a.state.padding;let p=0,n=0;if(i==="MAP_ONLY")e.width!=null&&e.height!=null&&(p=e.width,n=e.height);else if(i){const{webMapFrameSize:b,pageUnits:y}=this._layoutToTemplateInfo.get(i)??{};let f=!1;if(b&&y)if(this._isFreeHand){const g=b[0]/b[1];p=this._freeHandWidth,n=this._freehandHeight,p>n?n=p/g:p=n*g}else{const g=$i.fromJSON(y.toLowerCase()),I=o.unit;pt(g)===pt(I)?(p=ut(b[0],g,I),n=ut(b[1],g,I)):(f=!0,p=b[0],n=b[1])}if(!this._isFreeHand)if(e.scaleEnabled&&e.scale){const g=f?Math.min(l/p,r/n):ia(o)*oa*e.dpi;p*=g,n*=g}else if(p===0||n===0)p=l,n=r;else{const g=(l-.1*l)/p,I=(r-.1*r)/n,S=Math.min(g,I);p*=S,n*=S}}const{scaleEnabled:m,scale:h}=e,w=m&&h?h/this.view.scale:1;t.boxWidth=p*w||l,t.boxHeight=n*w||r,c&&(t.padding=c),t.backgroundWidth=l??0,t.backgroundHeight=r??0}_resetDrag(){this._isFreeHand=!1,this._updateOverLayItem()}_handleDrag(e){switch(e.action){case"start":this._start();break;case"update":this._update(e);break;case"end":this._end()}e.stopPropagation()}_start(){this._isFreeHand=!0}_update(e){const t=this._getOverlayItem(),{x:i,y:a}=e,{x:o,y:l}=e.origin;i>o?(t.x=o,t.boxWidth=i-o):(t.x=i,t.boxWidth=o-i),a>l?(t.y=l,t.boxHeight=a-l):(t.y=a,t.boxHeight=l-a)}_end(){const e=this._getOverlayItem();if(!this.view||e.x==null||e.y==null)return;const t=this.view,i=t.toMap(bt(e.x+.5*e.boxWidth,e.y+.5*e.boxHeight));e.x=null,e.y=null,t.goTo({center:i}),this._freeHandWidth=e.boxWidth,this._freehandHeight=e.boxHeight,this.templateOptions.layout==="MAP_ONLY"&&(this.templateOptions.width=this._freeHandWidth,this.templateOptions.height=this._freehandHeight),this.templateOptions.scale=this.view.scale,this._updateOverLayItem()}};s([u()],C.prototype,"_serviceTemplateCustomTextElements",void 0),s([u()],C.prototype,"_layoutToTemplateInfo",void 0),s([u()],C.prototype,"allowedFormats",void 0),s([u()],C.prototype,"allowedLayouts",void 0),s([u({type:ke})],C.prototype,"browseTemplates",void 0),s([u({type:ke})],C.prototype,"defaultTemplates",void 0),s([u()],C.prototype,"error",void 0),s([u()],C.prototype,"extraParameters",void 0),s([u()],C.prototype,"includeDefaultTemplates",void 0),s([u({readOnly:!0})],C.prototype,"effectivePrintServiceUrl",null),s([u()],C.prototype,"effectiveTemplateCustomTextElements",null),s([u()],C.prototype,"layoutTemplateInfo",null),s([u({type:vt})],C.prototype,"portal",void 0),s([u()],C.prototype,"portalTemplateIds",void 0),s([u()],C.prototype,"showPrintAreaEnabled",void 0),s([u()],C.prototype,"printServiceUrl",void 0),s([u()],C.prototype,"printTimeout",void 0),s([u({readOnly:!0})],C.prototype,"state",null),s([u({readOnly:!0})],C.prototype,"templatesInfo",void 0),s([u()],C.prototype,"updateDelay",void 0),s([u()],C.prototype,"view",void 0),s([u()],C.prototype,"templateCustomTextElements",void 0),s([u({type:kt})],C.prototype,"templateOptions",void 0),s([u()],C.prototype,"layoutTemplateNorthArrowInfo",null),C=s([V("esri.widgets.Print.PrintViewModel")],C);const Et=C,Dt=gt.ofType(It),Mt="MAP_ONLY";var x;(function(e){e.layout="layoutTab",e.mapOnly="mapOnlyTab",e.export="exportTab"})(x||(x={}));const _="esri-print",ae=`${_}__advanced-options-button`,v={base:_,headerTitle:`${_}__header-title`,layoutTabList:`${_}__layout-tab-list`,layoutTab:`${_}__layout-tab`,layoutSection:`${_}__layout-section`,mapOnlySection:`${_}__map-only-section`,panelItemsCentered:`${_}__panel-items--centered`,loader:`${_}__loader`,advancedOptionsButton:ae,advancedOptionsButtonContainer:`${ae}-container`,advancedOptionsButtonTitle:`${ae}-title`,advancedOptionsButtonIconOpened:`${ae}-icon--opened`,advancedOptionsButtonIconClosed:`${ae}-icon--closed`,advancedOptionsButtonIconClosed_RTL:`${ae}-icon--closed-rtl`,swapButton:`${_}__swap-button`,printButton:`${_}__export-button`,templateSelectContainer:`${_}__template-select-container`,templateSelectBlock:`${_}__template-select-block`,templateSelectIcon:`${_}__template-select-icon`,formSectionContainer:`${_}__form-section-container`,formCheckboxLabel:`${_}__form-checkbox-label`,advancedOptionsSection:`${_}__advanced-options-section`,advancedOptionsContainer:`${_}__advanced-options-container`,browseTemplateButtonContainer:`${_}__browse-template-button-container`,exportedFilesContainer:`${_}__export-panel-container`,exportedFilesTitle:`${_}__export-title`,exportedFile:`${_}__exported-file`,exportedFileLink:`${_}__exported-file-link`,exportedFileLinkTitle:`${_}__exported-file-link-title`,exportedFilesEmpty:`${_}__exported-files-empty`,printWidgetContainer:`${_}__container`,content:`${_}__content`,panelContainer:`${_}__panel-container`,scaleInfoContainer:`${_}__scale-info-container`,scaleInputContainer:`${_}__scale-input-container`,scaleInput:`${_}__scale-input`,sizeContainer:`${_}__size-container`,panelError:`${_}__panel--error`,exportedFileError:`${_}__exported-file--error`,exportedFileLoader:`${_}__exported-file--loader`,exportSection:`${_}__export-section`,exportSectionCentered:`${_}__export-section--centered`,templateButtonContainer:`${_}__template-button-container`,templateDoneButton:`${_}__template-done-button`,templateSelectFlowItemContainer:`${_}__template-select-flow-item-container`,templateSelectFlowItemContent:`${_}__template-select-flow-item-content`,templateSelectFlowItemListHeading:`${_}__template-select-flow-item-list-heading`};function Pi(e,t,i,a){const o=i/t,l=a/t;return{width:Math.round(e*o),height:Math.round(e*l)}}function Ci(e){return!isNaN(e)&&e>0}function Fe(e){return(e==null?void 0:e.toUpperCase())===Mt}function ki(e){var a;const{state:t,extension:i}=e;switch(t){case"pending":return"spinner";case"error":return"exclamation-mark-circle";default:return(a=i==null?void 0:i.toLowerCase())!=null&&a.includes("pdf")?"file-pdf":"file"}}function ie(e,t){return!!t&&e.some(i=>{var a;return((a=i.layoutItem)==null?void 0:a.id)===t||i.layout===t})}const Ei=new Y({inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers"});let k=class extends ma{constructor(e,t){super(e,t),this._activeTabFocusRequested=!1,this._awaitingServerResponse=!1,this._exportedFileNameMap={},this._selectedTab=x.layout,this._pendingExportScroll=!1,this._rootNode=null,this._selectedLayout=null,this._abortController=null,this._showTemplates=!1,this.browseTemplateButtonOnClick=null,this.exportedLinks=new Dt,this.headingLevel=3,this.messagesCommon=null,this.messagesUnits=null,this.viewModel=new Et,this._onInput=i=>{this._selectedTab===x.layout?this.templateOptions.title=i.target.value:this._selectedTab===x.mapOnly&&(this.templateOptions.fileName=i.target.value)},this._removeLink=i=>{const a=i.currentTarget["data-item"];a&&this.exportedLinks.remove(a)},this._handleLinkClick=i=>{const a=i.currentTarget["data-item"];if(!a||a.state!=="ready"||!a.url)return;const o=Se(this.viewModel.effectivePrintServiceUrl),l=a.url,r=document.createElement("a");if(r.target="_blank",r.href=l,r.rel="noreferrer",r.download=a.formattedName??"",!o)return r.click(),void i.stopPropagation();i.preventDefault();const c=new URL(l);c.searchParams.set("token",o),r.href=c.href,r.click(),r.href=l},this._focusOnTabChange=this._focusOnTabChange.bind(this)}initialize(){this.addHandles([ee(()=>{var a;return[this.templateOptions.format,(a=this.viewModel.templatesInfo)==null?void 0:a.format.defaultValue]},([a,o])=>{if(o&&!a)return void(this.templateOptions.format=o);if(!a||!o||!this.viewModel.templatesInfo||this.viewModel.templatesInfo.format.choiceList.includes(a))return;const l=this.viewModel.templatesInfo.format.choiceList.find(r=>r.toUpperCase().includes(`(${a.toUpperCase()})`));this.templateOptions.format=l??o}),ee(()=>{var a;return[this.templateOptions.layout,(a=this.viewModel.templatesInfo)==null?void 0:a.layout.defaultValue]},async([a,o])=>{if(this._selectedTab=Fe(a)?x.mapOnly:x.layout,this._selectedTab!==x.layout)return;const{includeDefaultTemplates:l,viewModel:r,_selectedLayout:c}=this,{portalTemplateIds:p,browseTemplates:n,templatesInfo:m}=r,h=r.defaultTemplates.filter(({layoutItem:y})=>p.includes(y==null?void 0:y.id)),w=r.defaultTemplates.filter(({layoutItem:y})=>!p.includes(y==null?void 0:y.id)),O=l&&w.length;a?(O?ie(w,a):m!=null&&m.layout.choiceList.includes(a))||ie(h,a)||ie(n,a)||(this.templateOptions.layout=null,this.templateOptions.layoutItem=null):(c&&((O?ie(w,c):m!=null&&m.layout.choiceList.includes(c))||ie(h,c)||ie(n,c))?await this._applyTemplate(c):(this.templateOptions.layout=null,this.templateOptions.layoutItem=null),this.templateOptions.layout||O||!o||await this._applyTemplate(o)),this._selectedLayout=this.templateOptions.layout;const b=!!this.templateOptions.layout&&this.viewModel.effectiveTemplateCustomTextElements[this.templateOptions.layout];this.templateOptions.customTextElements=b?Oe(b):null}),ee(()=>this.templateOptions.dpi,a=>{a<=0&&(this.templateOptions.dpi=1)}),ee(()=>{var a;return(a=this.viewModel.view)==null?void 0:a.scale},a=>{!a||this.templateOptions.scaleEnabled&&this.templateOptions.scale||(this.templateOptions.scale=a)})]);const{height:e,width:t}=this.templateOptions;this.templateOptions.width=t||800,this.templateOptions.height=e||1100;const i=setTimeout(()=>{this._awaitingServerResponse=!0,this.scheduleRender()},500);this.viewModel.load().then(()=>{clearTimeout(i),this._awaitingServerResponse=!1})}loadDependencies(){return ha({action:()=>A(()=>import("./calcite-action-BQdWHUTy.js"),__vite__mapDeps([47,48,49,1,2,16,50,51,52,53,54,55,56,57,58,59])),block:()=>A(()=>import("./calcite-block-qdFeD75E.js"),__vite__mapDeps([60,49,1,2,16,61,55,50,51,53,54,57,62,52,63,48,56,58,59,64,65,66,67,68,69,70,71,72])),button:()=>A(()=>import("./calcite-button-B3dK3J4O.js"),__vite__mapDeps([73,74,49,1,2,16,75,50,51,76,56,52,53,54,55,57,58,59])),checkbox:()=>A(()=>import("./calcite-checkbox-B3jaud22.js"),__vite__mapDeps([77,49,1,2,16,50,75,51,54,76,56,52])),combobox:()=>A(()=>import("./calcite-combobox-CFk50a9E.js"),__vite__mapDeps([78,79,49,1,2,16,80,81,68,50,67,75,51,76,56,52,53,54,55,63,57,82,83,84,58,85,61,86])),"combobox-item":()=>A(()=>import("./calcite-combobox-item-CebKWX2e.js"),__vite__mapDeps([87,85,49,1,2,16,61,55,50,51,83,56,58])),flow:()=>A(()=>import("./calcite-flow-DRMo8BV0.js"),__vite__mapDeps([88,49,1,2,16,55,52])),"flow-item":()=>A(()=>import("./calcite-flow-item-C1dz4xH2.js"),__vite__mapDeps([89,49,1,2,16,50,51,52,53,54,55,57,90,64,65,48,56,58,59,66,67,68,69,63,62,70,72])),icon:()=>A(()=>import("./calcite-icon-W-AdNGRC.js"),__vite__mapDeps([91,58,49,1,2,16,50,55])),input:()=>A(()=>import("./calcite-input-UxOKjIHa.js"),__vite__mapDeps([92,93,49,1,2,16,50,75,51,54,76,56,52,53,55,57,82,94,58,86,95])),label:()=>A(()=>import("./calcite-label-75nr6He8.js"),__vite__mapDeps([96,49,1,2,16,76,50,56])),list:()=>A(()=>import("./calcite-list-Dnyd1Dz_.js"),__vite__mapDeps([97,49,1,2,16,50,51,55,98,99,52,57,53,54,81,68,58,93,75,76,56,82,94,86,95,59,72])),"list-item":()=>A(()=>import("./calcite-list-item-DvRwTdOl.js"),__vite__mapDeps([100,49,1,2,16,50,51,53,54,55,57,52,99,98,48,56,58,59,71])),loader:()=>A(()=>import("./calcite-loader-DWyhLzpy.js"),__vite__mapDeps([101,59,49,1,2,16,50,53,54,55])),switch:()=>A(()=>import("./calcite-switch-CWeNlSSv.js"),__vite__mapDeps([102,103,49,1,2,16,50,75,51,54,76,56,52])),chip:()=>A(()=>import("./calcite-chip-JRnHjMcm.js"),__vite__mapDeps([104,84,49,1,2,16,50,52,57,53,54,55,51,56,58]))})}destroy(){this.viewModel.destroy()}get allowedFormats(){return this.viewModel.allowedFormats}set allowedFormats(e){this.viewModel.allowedFormats=e}get allowedLayouts(){return this.viewModel.allowedLayouts}set allowedLayouts(e){this.viewModel.allowedLayouts=e}get error(){return this.viewModel.error}get extraParameters(){return this.viewModel.extraParameters}set extraParameters(e){this.viewModel.extraParameters=e}get icon(){return"print"}set icon(e){this._overrideIfSome("icon",e)}get includeDefaultTemplates(){return this.viewModel.includeDefaultTemplates}set includeDefaultTemplates(e){this.viewModel.includeDefaultTemplates=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get portal(){return this.viewModel.portal}set portal(e){this.viewModel.portal=e}get showPrintAreaEnabled(){return this.viewModel.showPrintAreaEnabled}set showPrintAreaEnabled(e){this.viewModel.showPrintAreaEnabled=e}get printServiceUrl(){return this.viewModel.printServiceUrl}set printServiceUrl(e){this.viewModel.printServiceUrl=e}get templateCustomTextElements(){return this.viewModel.templateCustomTextElements}set templateCustomTextElements(e){this.viewModel.templateCustomTextElements=e}get templateOptions(){return this.viewModel.templateOptions}set templateOptions(e){this.viewModel.templateOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){var qe,Ke,Ze,Ye,Qe,Xe,et,tt,at,it;const{messages:e,templateOptions:t,viewModel:i,view:a}=this,{attributionEnabled:o,author:l,copyright:r,dpi:c,format:p,height:n,layout:m,legendEnabled:h,northArrowEnabled:w,scaleEnabled:O,scale:b,width:y}=t,f=i.state!=="ready"||this._awaitingServerResponse||!m,g=this._renderTitleOrFileNameSection(),I=d("div",{class:v.formSectionContainer},d("calcite-label",null,e.fileFormatTitle,d("calcite-combobox",{clearDisabled:!0,label:e.formatDefaultOption,maxItems:6,placeholder:e.formatDefaultOption,selectionMode:"single-persist",onCalciteComboboxChange:({target:z})=>{this.templateOptions.format=z.selectedItems[0].value}},(Ke=(qe=i.templatesInfo)==null?void 0:qe.format)==null?void 0:Ke.choiceList.sort().map((z,Gt)=>d("calcite-combobox-item",{key:`file-format-${Gt}`,selected:z===this.templateOptions.format,textLabel:Tt(z),value:z}))))),S=d("calcite-label",{layout:"inline"},d("calcite-switch",{checked:this.showPrintAreaEnabled,onCalciteSwitchChange:z=>{this.showPrintAreaEnabled=!!z.target.checked}}),e.printPreview),P=d("div",null,d("div",{class:v.formSectionContainer},d("calcite-label",null,e.template,d("div",{class:v.templateSelectContainer,onclick:()=>{this._showTemplates=!0}},d("calcite-block",{class:v.templateSelectBlock,description:this._getPageSizeLabel(m),heading:this._getTemplateLabel()}),d("calcite-icon",{class:v.templateSelectIcon,icon:ya()?"chevron-left":"chevron-right",scale:"s"})))),S),L=d("div",{class:v.formSectionContainer},d("calcite-label",null,e.dpi,d("calcite-input",{bind:this,"data-input-name":"dpi",min:1,tabIndex:0,type:"number",value:`${c}`,onCalciteInputInput:this._handleDPIChange}))),T=d("div",{class:this.classes(v.scaleInfoContainer,v.formSectionContainer)},d("calcite-label",{layout:"inline"},d("calcite-checkbox",{bind:this,checked:O,"data-option-name":"scaleEnabled",tabIndex:0,onCalciteCheckboxChange:this._toggleInputValue}),e.scale),d("div",{class:v.scaleInputContainer},d("calcite-input",{"aria-label":e.scaleLabel,"aria-valuenow":`${b}`,bind:this,class:v.scaleInput,"data-input-name":"scale",disabled:!O,tabIndex:0,type:"number",value:`${b}`,onCalciteInputInput:this._updateInputValue}),d("calcite-button",{appearance:"outline","aria-label":e.reset,bind:this,disabled:!O,iconStart:"refresh",kind:"neutral",onclick:this._resetToCurrentScale,tabIndex:0}))),$=d("div",{"aria-labelledby":`${this.id}__advancedOptionsForLayout`,class:v.advancedOptionsContainer,key:"advanced-section-for-layout"},T,((Ye=(Ze=this.viewModel.layoutTemplateInfo)==null?void 0:Ze.layoutOptions)==null?void 0:Ye.hasAuthorText)??1?d("div",{class:v.formSectionContainer,key:"author-info"},d("calcite-label",null,e.author,d("calcite-input",{bind:this,"data-input-name":"author",tabIndex:0,value:l??"",onCalciteInputInput:this._updateInputValue}))):null,((Xe=(Qe=this.viewModel.layoutTemplateInfo)==null?void 0:Qe.layoutOptions)==null?void 0:Xe.hasCopyrightText)??1?d("div",{class:v.formSectionContainer,key:"copyright-text"},d("calcite-label",null,e.copyright,d("calcite-input",{bind:this,"data-input-name":"copyright",tabIndex:0,value:r??"",onCalciteInputInput:this._updateInputValue}))):null,L,this._renderCustomTextElementSection(),((tt=(et=this.viewModel.layoutTemplateInfo)==null?void 0:et.layoutOptions)==null?void 0:tt.hasLegend)??1?d("div",{class:v.formSectionContainer,key:"legend-info"},d("calcite-label",{layout:"inline"},d("calcite-checkbox",{bind:this,checked:h,"data-option-name":"legendEnabled",tabIndex:0,onCalciteCheckboxChange:this._toggleInputValue}),e.legend)):null,this.viewModel.layoutTemplateNorthArrowInfo?d("div",{class:v.formSectionContainer,key:"north-arrow"},d("calcite-label",{layout:"inline"},d("calcite-checkbox",{bind:this,checked:w,"data-option-name":"northArrowEnabled",tabIndex:0,onCalciteCheckboxChange:this._toggleInputValue}),e.northArrow)):null),F=d("div",{"aria-labelledby":`${this.id}__advancedOptionsForMapOnly`,class:v.advancedOptionsContainer},T,L,d("div",{class:v.formSectionContainer},d("calcite-label",{layout:"inline"},d("calcite-checkbox",{bind:this,checked:o,"data-option-name":"attributionEnabled",tabIndex:0,onCalciteCheckboxChange:this._toggleInputValue}),e.attribution)),this._renderCustomTextElementSection()),R=this.exportedLinks.toArray(),X=this._renderExportedLink(R),ge={[v.exportSectionCentered]:!R.length},Ft=this._selectedTab===x.layout?d("section",{"aria-labelledby":`${this.id}__layoutTab`,class:v.layoutSection,id:`${this.id}__layoutContent`,key:"esri-print__layoutContent",role:"tabpanel"},d("div",{class:v.panelContainer},((it=(at=this.viewModel.layoutTemplateInfo)==null?void 0:at.layoutOptions)==null?void 0:it.hasTitleText)??1?g:null,P,this._selectedTab===x.layout?I:null,d("calcite-block",{"aria-label":e.advancedOptions,class:this.classes(v.panelContainer,v.advancedOptionsSection),collapsible:!0,disabled:!m,heading:e.advancedOptions,id:"advancedOptionsForLayout",key:"advanced-options-for-layout"},$))):this._selectedTab===x.mapOnly?d("section",{"aria-labelledby":`${this.id}__mapOnlyTab`,class:v.mapOnlySection,id:`${this.id}__mapOnlyContent`,key:"esri-print__mapOnlyContent",role:"tabpanel"},d("div",{class:v.panelContainer},g,I,d("div",null,d("div",{class:this.classes(v.sizeContainer,v.formSectionContainer)},d("calcite-label",null,e.width,d("calcite-input",{bind:this,"data-input-name":"width",tabIndex:0,type:"number",value:`${y}`,onCalciteInputInput:this._updateInputValue})),d("calcite-label",null,e.height,d("calcite-input",{bind:this,"data-input-name":"height",tabIndex:0,type:"number",value:`${n}`,onCalciteInputInput:this._updateInputValue})),d("button",{"aria-label":e.swap,bind:this,class:this.classes(ue.widgetButton,v.swapButton,Oa.swap),onclick:this._switchInput,tabIndex:0,type:"button"})),S),d("calcite-block",{"aria-label":e.advancedOptions,class:this.classes(v.panelContainer,v.advancedOptionsSection),collapsible:!0,heading:e.advancedOptions,id:"advancedOptionsForMapOnly",key:"advanced-options-for-map-only"},F))):d("section",{"aria-labelledby":`${this.id}__exportTab`,class:this.classes(v.exportSection,ge),id:`${this.id}__exportContent`,key:"esri-print__exportContent",role:"tabpanel"},d("div",{class:v.panelContainer},d("div",{afterUpdate:this._scrollExportIntoView,bind:this,class:v.exportedFilesContainer},R.length===0?d("div",{class:v.exportedFilesEmpty},d("calcite-icon",{icon:"file",scale:"l"}),d("div",null,d(xa,{class:v.exportedFilesTitle,level:this.headingLevel},e.noExportedFiles),d("div",null,e.exportHint))):X))),At={[ue.buttonDisabled]:f||!m&&!p},ze=!a||a.type!=="2d",Nt=d("div",{class:v.panelError},ze?e.sceneViewError:e.serviceError),Vt=R.some(({state:z})=>z==="pending"),Rt=d("div",{class:v.content,key:"panel"},d("div",null,d("ul",{bind:this,class:v.layoutTabList,onclick:this._toggleLayoutPanel,onkeydown:this._handleLayoutPanelKeyDown,role:"tablist"},d("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${this._selectedTab===x.layout}`,class:v.layoutTab,"data-tab-id":x.layout,id:`${this.id}__layoutTab`,role:"tab",tabIndex:0},e.layoutTab),d("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${this._selectedTab===x.mapOnly}`,class:v.layoutTab,"data-tab-id":x.mapOnly,id:`${this.id}__mapOnlyTab`,role:"tab",tabIndex:0},e.mapOnlyTab),d("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${this._selectedTab===x.export}`,class:v.layoutTab,"data-tab-id":x.export,id:`${this.id}__exportedFilesTab`,role:"tab",tabIndex:0},Vt?d("calcite-loader",{inline:!0,label:"loading",scale:"s"}):null,e.exportsTab)),Ft),this._selectedTab!==x.export?d("button",{"aria-label":e.exportDescription,bind:this,class:this.classes(v.printButton,ue.button,At),disabled:f,onclick:this._handlePrintMap,tabIndex:0,type:"button"},e.export):null),Ut=d("calcite-flow",{key:"root-flow"},d("calcite-flow-item",{bind:this,key:"root-flow-item"},d("div",{class:v.printWidgetContainer},d("header",{class:v.headerTitle},e.export),this.error||ze||!a?Nt:Rt)),this._renderChooseTemplateFlowItem()),We=i.state==="initializing",jt=We?this._renderLoader():Ut,Jt={[v.panelItemsCentered]:We};return d("div",{bind:this,class:this.classes(v.base,ue.widget,ue.panel,Jt)},jt)}_getPageSizeLabel(e){if(!e)return;const t=this.viewModel.getLayoutTemplateInfo(e);if(!t)return;const i=Ei.fromJSON(t.pageUnits.toLowerCase());return`${ct(t.pageSize[0])} x ${ct(t.pageSize[1])} ${ua(this.messagesUnits,i,"abbr")}`}_getTemplateLabel(){var r;const{messages:e,includeDefaultTemplates:t,templateOptions:i,viewModel:a}=this,{layout:o}=i,l=o?(t?a.defaultTemplates.find(({layoutItem:c,layout:p})=>o===(c==null?void 0:c.id)||o===p):null)??a.browseTemplates.find(({layoutItem:c})=>o===(c==null?void 0:c.id)):null;return((r=l==null?void 0:l.label)==null?void 0:r.replaceAll("_"," "))??e[o]??(o==null?void 0:o.replaceAll("_"," "))??e.selectTemplate}_renderChooseTemplateFlowItem(){var O,b;if(!this._showTemplates)return null;const{includeDefaultTemplates:e,messages:t,viewModel:i}=this,{defaultTemplates:a,templatesInfo:o,browseTemplates:l,portalTemplateIds:r}=i,c=wt.test((O=this.portal)==null?void 0:O.url),p=l.length?l.toArray().sort((y,f)=>(y.label??"")>(f.label??"")?1:-1).map((y,f)=>{var P,L,T;const g=((P=y.layoutItem)==null?void 0:P.id)??y.layout,I=this._getPageSizeLabel(g),S=g===this.templateOptions.layout;return d("calcite-list-item",{description:I,key:`browse-template-${f}`,label:((L=y==null?void 0:y.label)==null?void 0:L.replaceAll("_"," "))??t.untitled,selected:S,title:y.description??"",value:g},!I&&S&&((T=y.layoutItem)!=null&&T.id)?d("calcite-loader",{inline:!0,key:`browse-template-loader-${f}`,label:"loading",scale:"s",slot:"content-end"}):null,d("calcite-action",{icon:"trash",onclick:()=>i.removePortalTemplate(y),slot:"actions-end",text:"delete"}))}):null,n=a.length&&e?a.toArray().filter(({label:y,layoutItem:f})=>!Fe(y)&&r.includes(f==null?void 0:f.id)).map((y,f)=>{var P,L,T;const g=((P=y.layoutItem)==null?void 0:P.id)??y.layout,I=this._getPageSizeLabel(g),S=g===this.templateOptions.layout;return d("calcite-list-item",{description:I,key:`portal-template-${g}-${S}`,label:((L=y==null?void 0:y.label)==null?void 0:L.replaceAll("_"," "))??t.untitled,selected:S,title:y.description??"",value:g},!I&&S&&((T=y.layoutItem)!=null&&T.id)?d("calcite-loader",{inline:!0,key:`portal-template-loader-${f}`,label:"loading",scale:"s",slot:"content-end"}):null)}):null,m=a.length&&e?a.toArray().filter(({label:y,layoutItem:f})=>!Fe(y)&&!r.includes(f==null?void 0:f.id)).sort((y,f)=>(y.label??"")>(f.label??"")?1:-1).map((y,f)=>{var P,L,T;const g=((P=y.layoutItem)==null?void 0:P.id)??y.layout,I=this._getPageSizeLabel(g),S=g===this.templateOptions.layout;return d("calcite-list-item",{description:I,key:`default-template-${f}`,label:((L=y==null?void 0:y.label)==null?void 0:L.replaceAll("_"," "))??t.untitled,selected:S,title:y.description??"",value:g},!I&&S&&((T=y.layoutItem)!=null&&T.id)?d("calcite-loader",{inline:!0,key:`default-template-loader-${f}`,label:"loading",scale:"s",slot:"content-end"}):null)}):null,h=!((b=o==null?void 0:o.layout)!=null&&b.choiceList.length)||e&&(m!=null&&m.length)?null:o.layout.choiceList.map(y=>({label:t[y]??y.replaceAll("_"," "),value:y})).sort((y,f)=>y.label>f.label?1:0).map(({label:y,value:f},g)=>d("calcite-list-item",{description:this._getPageSizeLabel(f),key:`service-template-${g}`,label:y,selected:f===this.templateOptions.layout,value:f})),w=((p==null?void 0:p.length)??0)+((n==null?void 0:n.length)??0)+((m==null?void 0:m.length)??0)+((h==null?void 0:h.length)??0)>15;return d("calcite-flow-item",{bind:this,closable:!1,heading:t.chooseTemplate,key:"template-flow-item",onCalciteFlowItemBack:y=>{y.preventDefault(),this._showTemplates=!1}},d("div",{class:v.templateSelectFlowItemContainer},d("div",{class:v.templateSelectFlowItemContent},this.browseTemplateButtonOnClick?d("calcite-button",{appearance:"outline",class:v.browseTemplateButtonContainer,key:"browse-template-button",onclick:this.browseTemplateButtonOnClick},"Browse Templates"):null,d("calcite-list",{filterEnabled:w,key:"template-list",selectionMode:"single-persist",onCalciteListChange:({target:y})=>this._applyTemplate(y.selectedItems[0].value)},p!=null&&p.length?d("div",{key:"my-templates"},d("div",{class:v.templateSelectFlowItemListHeading},t.myTemplates,d("calcite-chip",{appearance:"outline",kind:"neutral",scale:"s",value:t.beta},t.beta)),p):null,n!=null&&n.length?d("div",{key:"org-templates"},d("div",{class:v.templateSelectFlowItemListHeading},t.organizationTemplates,c?d("calcite-chip",{appearance:"outline",kind:"neutral",scale:"s",value:t.beta},t.beta):null),n):null,p!=null&&p.length||n!=null&&n.length?m!=null&&m.length?d("div",{key:"default-templates"},d("div",{class:v.templateSelectFlowItemListHeading},t.defaultTemplates),m):null:m,p!=null&&p.length||n!=null&&n.length?h!=null&&h.length?d("div",{key:"service-templates"},d("div",{class:v.templateSelectFlowItemListHeading},t.defaultTemplates),h):null:h)),d("div",{class:v.templateButtonContainer},d("calcite-button",{class:v.templateDoneButton,onclick:()=>this._showTemplates=!1},this.messagesCommon.done))))}_renderCustomTextElementSection(){const{customTextElements:e}=this.templateOptions;return e?d("div",{class:v.formSectionContainer,key:"custom-text-elements"},e.map((t,i)=>{const[a,o]=Object.entries(t)[0];return a==="date"?null:d("calcite-label",{key:`custom-text-elements-${a}-${i}`},a,d("calcite-input",{bind:this,"data-input-custom":!0,"data-input-name":a,value:o??"",onCalciteInputInput:this._updateInputValue}))})):null}async _applyTemplate(e){var n,m;if(this._abortController&&(this._abortController.abort(),this._abortController=null),!e)return;const t=this.viewModel.defaultTemplates.find(({layoutItem:h})=>e===(h==null?void 0:h.id))??this.viewModel.browseTemplates.find(({layoutItem:h})=>e===(h==null?void 0:h.id));if(!t)return this.templateOptions.layout=e,void(this.templateOptions.layoutItem=null);const{layoutItem:i}=t,a=t.format??this.templateOptions.format,o=(i==null?void 0:i.id)??t.layout??this.templateOptions.layout;if(this.templateOptions.layout=o,!t.layoutOptions)try{this._abortController=new AbortController,await this.viewModel.fetchLayoutTemplateInfo(t,{signal:this._abortController.signal})}catch{return}finally{this._abortController=null}const l=((n=t.layoutOptions)==null?void 0:n.legend)??this.templateOptions.legendEnabled,r=((m=t.layoutOptions)==null?void 0:m.northArrow)??this.templateOptions.northArrowEnabled,c=o?this.viewModel.effectiveTemplateCustomTextElements[o]:null,p=c?Oe(c):null;this.templateOptions.set({customTextElements:p,format:a,layout:o,layoutItem:i,legendEnabled:l,northArrowEnabled:r})}_renderTitleOrFileNameSection(){const{title:e,fileName:t,titlePlaceHolder:i,fileNamePlaceHolder:a}=this.messages,o=this._selectedTab===x.layout?e:t,l=this._selectedTab===x.layout?i:a,r=this._selectedTab===x.layout?this.templateOptions.title:this.templateOptions.fileName;return d("div",{class:v.formSectionContainer,key:o},d("calcite-label",null,o,d("calcite-input",{placeholder:l,value:r??"",onCalciteInputInput:this._onInput})))}_focusOnTabChange(e){if(!this._activeTabFocusRequested)return;const t=e.getAttribute("data-tab-id");(t==="layoutTab"&&this._selectedTab===x.layout||t==="mapOnlyTab"&&this._selectedTab===x.mapOnly||t==="exportTab"&&this._selectedTab===x.export)&&(e.focus(),this._activeTabFocusRequested=!1)}_renderLoader(){const e={[v.loader]:this._awaitingServerResponse};return d("div",{class:this.classes(e),key:"loader"})}_createFileLink(e,t){const i=t||this.messages.untitled,a=e.format.toLowerCase(),o=a.includes("png")?"png":a,l=i+o;return this._exportedFileNameMap[l]!==void 0?this._exportedFileNameMap[l]++:this._exportedFileNameMap[l]=0,new It({name:i,extension:o,count:this._exportedFileNameMap[l]})}_resetToCurrentScale(){var e;this.templateOptions.scale=(e=this.viewModel.view)==null?void 0:e.scale}_updateCustomTextElementValue(e,t,i){e.find(a=>{const[o]=Object.entries(a)[0];return o===t})[t]=i}_updateInputValue(e){const t=e.target,i=t.getAttribute("data-input-name"),a=!!t["data-input-custom"],{templateOptions:o}=this;if(a)return void this._updateCustomTextElementValue(o.customTextElements,i,t.value);let l;if(t.type==="number"){const r=Number(t.value);if(!Ci(r)){const c=o[i];return void(t.value=`${c}`)}l=r}else l=t.value;o[i]=l}_handleDPIChange(e){const{templateOptions:t}=this,i=t.dpi;this._updateInputValue(e);const a=t.dpi,{height:o,width:l}=Pi(a,i,t.width,t.height);t.height=o,t.width=l}_handlePrintMap(){var o;this._pendingExportScroll=!0;const{templateOptions:e}=this,t=this.viewModel.toPrintTemplate(e),i=this._selectedTab===x.layout?(o=t.layoutOptions)==null?void 0:o.titleText:e.fileName,a=this._createFileLink(t,i);this.exportedLinks.add(a),this.emit("submit",{link:a}),this._selectedTab=x.export,this.viewModel.print(t).then(l=>{a.set({url:l&&l.url,state:"ready"})}).catch(l=>{a.set({error:l,state:"error"})}).then(()=>{this.emit("complete",{link:a}),this.scheduleRender()})}_switchInput(){[this.templateOptions.width,this.templateOptions.height]=[this.templateOptions.height,this.templateOptions.width]}_scrollExportIntoView(){if(!this._pendingExportScroll)return;this._pendingExportScroll=!1;const e=this._rootNode;if(!e)return;const{clientHeight:t,scrollHeight:i}=e,a=i-t;a>0&&(e.scrollTop=a)}_toggleInputValue(e){const t=e.target,i=t.getAttribute("data-option-name");this.templateOptions[i]=t.checked,i==="scaleEnabled"&&this._resetToCurrentScale()}_renderExportedLink(e){const t=this.messages,i=e.map(a=>{const{error:o,url:l,state:r}=a,c=a.formattedName??"",p=r==="error",n=r==="pending",m=r==="ready";let h=l||null;h&&(h=sa(h));const w=pa(l,location.href);let O;O=n?t.pending:m?t.ready:t.errorMessage;const b=p?(o==null?void 0:o.name)==="print-task:cim-symbol-unsupported"?t.exportWebMapCIMError:t.exportWebMapError:"";return d("calcite-list-item",{"aria-label":O,class:v.exportedFile,"data-item":a,description:n?t.generatingExport:b||(w?t.ready:t.linkReady),key:c,label:c,title:b,onCalciteListItemSelect:this._handleLinkClick},n?d("calcite-loader",{class:v.exportedFileLoader,inline:!0,key:`${c}-loader`,label:t.generatingExport,scale:"m",slot:"content-start"}):d("calcite-icon",{icon:ki(a),key:`${c}-start-icon`,scale:"s",slot:"content-start"}),m?d("calcite-icon",{"aria-label":`${c}. ${t.linkReady}`,icon:w?"download-to":"launch",key:`${c}-end-icon`,scale:"s",slot:"content-end"}):null,n?null:d("calcite-action",{"aria-label":`${b}`,"data-item":a,icon:"x",key:`${c}-action`,onclick:this._removeLink,slot:"actions-end",text:`${b}`}))});return d("calcite-list",{filterEnabled:(e==null?void 0:e.length)>10},i)}_toggleLayoutPanel(e){const t=e.target;this._toggleTab(t.getAttribute("data-tab-id"))}_toggleTab(e,t=!0){var i,a;if(this._selectedTab=e,this._selectedTab===x.mapOnly)this.templateOptions.layout=Mt,this.templateOptions.layoutItem=null,this.templateOptions.customTextElements=null;else if(this._selectedTab===x.layout){const o=this._selectedLayout??(this.includeDefaultTemplates&&this.viewModel.defaultTemplates.length?null:(a=(i=this.viewModel.templatesInfo)==null?void 0:i.layout)==null?void 0:a.defaultValue);o?this._applyTemplate(o):(this.templateOptions.layout=null,this.templateOptions.layoutItem=null,this.templateOptions.customTextElements=null)}t&&(this._activeTabFocusRequested=!0)}_handleLayoutPanelKeyDown(e){const{key:t}=e,i=e.target.getAttribute("data-tab-id");if(fa(t))return this._toggleTab(i),e.preventDefault(),void e.stopPropagation();if(t==="ArrowLeft"||t==="ArrowRight"){switch(i){case x.layout:this._toggleTab(t==="ArrowLeft"?x.export:x.mapOnly);break;case x.mapOnly:this._toggleTab(t==="ArrowLeft"?x.layout:x.export);break;case x.export:this._toggleTab(t==="ArrowLeft"?x.mapOnly:x.layout)}e.preventDefault(),e.stopPropagation()}}};s([u()],k.prototype,"_showTemplates",void 0),s([u()],k.prototype,"allowedFormats",null),s([u()],k.prototype,"allowedLayouts",null),s([u()],k.prototype,"browseTemplateButtonOnClick",void 0),s([u()],k.prototype,"error",null),s([u({type:Dt})],k.prototype,"exportedLinks",void 0),s([u()],k.prototype,"extraParameters",null),s([u()],k.prototype,"headingLevel",void 0),s([u()],k.prototype,"icon",null),s([u()],k.prototype,"includeDefaultTemplates",null),s([u()],k.prototype,"label",null),s([u(),De("esri/widgets/Print/t9n/Print")],k.prototype,"messages",void 0),s([u(),De("esri/t9n/common")],k.prototype,"messagesCommon",void 0),s([u(),De("esri/core/t9n/Units")],k.prototype,"messagesUnits",void 0),s([u()],k.prototype,"portal",null),s([u()],k.prototype,"showPrintAreaEnabled",null),s([u()],k.prototype,"printServiceUrl",null),s([u()],k.prototype,"templateCustomTextElements",null),s([u()],k.prototype,"templateOptions",null),s([u()],k.prototype,"view",null),s([u({type:Et})],k.prototype,"viewModel",void 0),k=s([V("esri.widgets.Print")],k);const bo=k;export{bo as default};
