import{aI as M,f as _,b8 as R,A as B,m9 as U,bQ as N,bX as w,aL as Q,dU as H,ma as X,s as h,dc as J,cj as K,mb as Y,bU as Z,bV as ee,C as te,bT as V,lH as ie,mc as ne,fc as le,bp as $,dk as re,bB as I,c$ as C,d5 as se,d6 as oe,h8 as ae,V as ce,hR as ue}from"./index-DX0rcHuW.js";import{l as A}from"./ViewingMode-Dodu7ZZk.js";import{z as y,p as O}from"./TileInfo-DuivnO5H.js";const fe=12;let x=class p{constructor(t){const i=p.checkUnsupported(t);if(i!=null)throw i;const n=t;this.spatialReference=n.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=B(this.spatialReference),this.origin=[n.origin.x,n.origin.y],this.pixelSize=n.size[0],this.dpi=n.dpi;const l=n.lods.reduce((c,f)=>(f.level<c.minLod.level&&(c.minLod=f),c.max=Math.max(c.max,f.level),c),{minLod:n.lods[0],max:-1/0}),r=l.minLod,o=2**r.level;let a=r.resolution*o,u=r.scale*o;this.levels=new Array(l.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:u,tileSize:[a*n.size[0],a*n.size[1]]},a/=2,u/=2}clone(){return new p(this.toTileInfo())}toTileInfo(){return new y({dpi:this.dpi,origin:new M({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((t,i)=>new O({level:i,scale:t.scale,resolution:t.resolution}))})}getExtent(t,i,n,l){const r=this.levels[t],o=r.tileSize[0],a=r.tileSize[1];l[0]=this.origin[0]+n*o,l[2]=this.origin[0]+(n+1)*o,l[3]=this.origin[1]-i*a,l[1]=this.origin[1]-(i+1)*a}convertExtentToRadians(t,i){this._isWebMercator?(i[0]=U(t[0]),i[1]=N(t[1]),i[2]=U(t[2]),i[3]=N(t[3])):this._isGCS&&(i[0]=w(t[0]),i[1]=w(t[1]),i[2]=w(t[2]),i[3]=w(t[3]))}getExtentGeometry(t,i,n,l=new Q){return this.getExtent(t,i,n,g),l.spatialReference=this.spatialReference,l.xmin=g[0],l.ymin=g[1],l.xmax=g[2],l.ymax=g[3],l.zmin=void 0,l.zmax=void 0,l}ensureMaxLod(t){if(t==null)return!1;let i=!1;for(;this.levels.length<=t;){const{resolution:n,scale:l}=this.levels[this.levels.length-1],r=n/2*this.pixelSize;this.levels.push({resolution:n/2,scale:l/2,tileSize:[r,r]}),i=!0}return i}capMaxLod(t){this.levels.length>t+1&&(this.levels.length=t+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(t){return this.levels[0].scale/2**t}levelAtScale(t){const i=this.levels[0].scale;return t>=i?0:Math.log(i/t)*Math.LOG2E}resolutionAtLevel(t){return this.levels[0].resolution/2**t}compatibleWith(t,i=1/0){if(p.checkUnsupported(t))return!1;const n=new p(t);if(!n.spatialReference.equals(this.spatialReference)||n.pixelSize!==this.pixelSize)return!1;const l=Math.min(this.levels.length-1,n.levels.length-1,i),r=this.levels[l].resolution;let o=.5*r;return!H(n.origin[0],this.origin[0],o)||!H(n.origin[1],this.origin[1],o)?!1:(o=.5*r/2**l/this.pixelSize*fe,H(r,n.levels[l].resolution,o))}rootTilesInExtent(t,i=null,n=1/0){const l=new Array,r=this.levels[0].tileSize;if(t==null||r[0]===0||r[1]===0)return l;p.computeRowColExtent(t,r,this.origin,g);let o=g[1],a=g[3],u=g[0],c=g[2];const f=c-u,d=a-o;if(f*d>n){const m=Math.floor(Math.sqrt(n));d>m&&(o=o+Math.floor(.5*d)-Math.floor(.5*m),a=o+m),f>m&&(u=u+Math.floor(.5*f)-Math.floor(.5*m),c=u+m)}for(let m=o;m<a;m++)for(let W=u;W<c;W++)l.push([0,m,W]);return i!=null&&(i[0]=this.origin[0]+u*r[0],i[1]=this.origin[1]-a*r[1],i[2]=this.origin[0]+c*r[0],i[3]=this.origin[1]-o*r[1]),l}static computeRowColExtent(t,i,n,l){const r=.001*(t[2]-t[0]+(t[3]-t[1]));l[0]=Math.max(0,Math.floor((t[0]+r-n[0])/i[0])),l[2]=Math.max(0,Math.ceil((t[2]-r-n[0])/i[0])),l[1]=Math.max(0,Math.floor((n[1]-t[3]+r)/i[1])),l[3]=Math.max(0,Math.ceil((n[1]-t[1]-r)/i[1]))}static isPowerOfTwo(t){const i=t.lods,n=i[0].resolution*2**i[0].level;return!i.some(l=>!X(l.resolution,n/2**l.level))}static hasGapInLevels(t){const i=t.lods.map(n=>n.level);i.sort((n,l)=>n-l);for(let n=1;n<i.length;n++)if(i[n]!==i[0]+n)return!0;return!1}static tileSizeSupported(t){const i=t.size[1];return i===t.size[0]&&!(i&i-1)&&i>=128&&i<=512}static hasOriginPerLODs(t){const i=t.origin;return t.lods.some(n=>n.origin!=null&&(n.origin[0]!==i.x||n.origin[1]!==i.y))}static getMissingTileInfoError(){return new h("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(t){return t==null?z():t.lods.length<1?new h("tilingscheme:generic","Tiling scheme must have at least one level"):p.isPowerOfTwo(t)?p.hasGapInLevels(t)?new h("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):p.tileSizeSupported(t)?p.hasOriginPerLODs(t)?new h("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new h("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new h("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(t,i){const n=t[2]-t[0],l=t[3]-t[1],r=J(i),o=1.2*Math.max(n,l),a=256,u=o/a,c=u*r*(96/.0254),f=new p(new y({size:[a,a],origin:new M({x:t[0]-.5*(o-n),y:t[3]+.5*(o-l)}),lods:[new O({level:0,resolution:u,scale:c})],spatialReference:i}));return f.ensureMaxLod(20),f}static makeWebMercatorAuxiliarySphere(t){const i=new p(p.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(t),i}static makeGCSWithTileSize(t,i=256,n=16){const l=256/i,r=new p(new y({size:[i,i],origin:new M({x:-180,y:90,spatialReference:t}),spatialReference:t,lods:[new O({level:0,resolution:.703125*l,scale:295497598570834e-6*l})]}));return r.ensureMaxLod(n),r}get test(){}};function z(){return new h("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}x.WebMercatorAuxiliarySphereTileInfo=new y({size:[256,256],origin:new M({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:_.WebMercator}),spatialReference:_.WebMercator,lods:[new O({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),x.WebMercatorAuxiliarySphere=x.makeWebMercatorAuxiliarySphere(19);const g=R(),G=64,ke=512,Ve=2.5,Pe=K(Y/10),je=2,he=R();x.WebMercatorAuxiliarySphere.getExtent(0,0,0,he);const qe=R([-180,-90,180,90]),Fe="Cannot extend surface to encompass all layers because it would result in too many root tiles.",De="Surface extent is too large for tile resolution at level 0.",Be=4;function pe(e){return e!=null&&"type"in e&&e.type==="vector-tile"}function me(e){return e!=null&&"type"in e&&e.type==="raster-tile"}function ge(e){return e!=null&&"type"in e&&e.type==="tile-texture"}function Se(e){return e!=null&&"type"in e&&e.type==="image+type"}var s;(function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"})(s||(s={}));function Te(e){return P(e)||Z(e)||ee(e)}function P(e){return te(e)||V(e)}const E=$(),xe=$(),S=$(),T=$();function de(e,t,i=0){const n=e.extent;if(n==null)return!1;if(i===0)return ie(n,t);const l=Math.min(n[2]-n[0],n[3]-n[1]);return ne(n,t,i*l)}function v(e,t,i,n){re(E,i),E[n]=t[n];const l=I(E,E,t),r=I(xe,e,t),o=C(r,l),a=C(l,l);let u;u=o<=0?t:a<=o?i:se(E,t,oe(l,l,o/a));const c=I(E,e,u);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function Ee(e,t,i){const n=e.extent;if(n==null)return 0;S[0]=n[0],S[1]=n[1],S[2]=i,T[0]=n[2],T[1]=n[3],T[2]=i;let l=1/0,r=1/0;return t[0]<S[0]?l=v(t,S,T,0):t[0]>T[0]&&(l=v(t,T,S,0)),t[1]<S[1]?r=v(t,S,T,1):t[1]>T[1]&&(r=v(t,T,S,1)),Math.min(l,r)}function we(e,t,i,n){if(e==null)return z();const l=e.spatialReference;if(l.isGeographic&&!P(l))return new h("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const r=x.checkUnsupported(e);return r??(i==null?new h("tilingscheme:extent-not-exist","The layer does not provide a layer extent."):ve(e,i)||(t==null||l.equals(t)||t.isWGS84&&l.isWebMercator?null:new h("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")))}function ve(e,t){const i=e.lods,n=i[0].resolution*2**i[0].level,l=[n*e.size[0],n*e.size[1]],r=[e.origin.x,e.origin.y],o=le(t),a=R();x.computeRowColExtent(o,l,r,a);const u=(a[2]-a[0])*(a[3]-a[1]);if(u>G){const c=i[0].scale*2**i[0].level;let f=Math.max((o[3]-o[1])/e.size[1],(o[2]-o[0])/e.size[0])*c/n;const d=Math.floor(Math.log(f)/Math.log(10));return f=Math.ceil(f/10**d)*10**d,new h("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+f.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:f,requiredNumRootTiles:u,allowedNumRootTiles:G})}return null}const Me=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:we,isInsideExtent:de,tiltToExtentEdge:Ee},Symbol.toStringTag,{value:"Module"}));function ye(){return!0}function Oe(){return 0}function be(e,t,i,n){if(e==null)return z();const l=(e==null?void 0:e.lods.length)-1,r=e.spatialReference;if(r.isWebMercator){if(!x.makeWebMercatorAuxiliarySphere(l).compatibleWith(e,n))return new h("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!Te(r))return new h("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!x.makeGCSWithTileSize(e.spatialReference,e.size[0],l).compatibleWith(e,n))return e.spatialReference.isWGS84?new h("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new h("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return t==null||e.spatialReference.equals(t)?null:new h("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const Re=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:be,isInsideExtent:ye,tiltToExtentEdge:Oe},Symbol.toStringTag,{value:"Module"})),$e={[A.Global]:Re,[A.Local]:Me};function Qe(e,t){e||console.warn("Terrain: "+t)}let b=!1,We=!1;function Xe(e){We=e,b=b||e}function Je(e){b=e}function Ke(e,t){var i;if(b&&!e){const n=(i=new Error().stack)==null?void 0:i.slice(5);throw console.warn("Terrain internal: "+(t??"")+" at "+n),new Error("Assertion failed"+(t?": "+t:""))}}function Ye(e){return L(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function k(e){return(e==null?void 0:e.type)==="imagery-tile"||(e==null?void 0:e.type)==="wcs"}function L(e){return(e==null?void 0:e.type)==="imagery-tile-3d"}function j(e){return(e==null?void 0:e.type)==="tile-3d"}function q(e){return(e==null?void 0:e.type)==="vector-tile-3d"}function F(e){return(e==null?void 0:e.type)==="wmts-3d"}function He(e){return(e==null?void 0:e.type)==="elevation-3d"}function Ze(e){return(e==null?void 0:e.type)==="group"}function et(e){return e&&(j(e)||F(e)||L(e)||q(e))}function Ie(e){return e&&(j(e)||L(e)||q(e)||F(e))}function tt(e){return Ie(e)||He(e)}function it(e){var t;return me((t=e==null?void 0:e.sourceLayerInfo)==null?void 0:t.data)}function nt(e){return Ae(e==null?void 0:e.sourceLayerInfo)||!!(e!=null&&e.isVTLBackground)}function lt(e){var t;return ge((t=e==null?void 0:e.sourceLayerInfo)==null?void 0:t.data)}function rt(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return Se(t)||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData}function Ae(e){return pe(e==null?void 0:e.data)}function st(e){return e!=null&&"release"in e&&e.release(),null}function ot(e){return e.fetchTile&&e.hasOverriddenFetchTile!==!1}function D(e,t,i,n,l){return $e[n].checkIfTileInfoSupportedForViewSR(e,i,t,l)}function at(e,t,i){var o;let n=null,l=null;if((e==null?void 0:e.type)==="wmts"){const a=ze(e,t,i);n=a.tileInfo,l=a.fullExtent}else{l=k(e)?e.getCompatibleFullExtent(t):e.fullExtent;const a=i===A.Local;k(e)?n=e.getCompatibleTileInfo(t,l,a):(e==null?void 0:e.type)==="vector-tile"?n=a&&!Le(t)||_e.force512VTL?e.tileInfo:e.tileInfo.getCompatibleForVTL(256):n=e.tileInfo}const r="tilemapCache"in e?(o=e.tilemapCache)==null?void 0:o.effectiveMaxLOD:void 0;return n!=null&&l!=null&&D(n,l,t,i,r)==null?{tileInfo:n,fullExtent:l}:null}function ze(e,t,i){const n=ae(e);if(n!=null){if(!ce.isCollection(n))return{tileInfo:n.tileInfo,fullExtent:n.fullExtent};{const l=n.find(r=>D(r.tileInfo,r.fullExtent,t,i)==null);if(l)return{tileInfo:l.tileInfo,fullExtent:l.fullExtent}}}return{tileInfo:null,fullExtent:null}}function Le(e){return e.isWGS84||e.isWebMercator||V(e)||!ue(e)}const _e={force512VTL:!1};function ct(e){return"["+e[0]+","+e[1]+","+e[2]+"]"}function ut(e){return"("+e[0]+","+e[1]+","+e[2]+")"}function ft(e,t,i=Ue){return Math.abs(e-t)<i}function ht(e){return e===s.NORTH_EAST?s.SOUTH_WEST:e===s.NORTH_WEST?s.SOUTH_EAST:e===s.SOUTH_WEST?s.NORTH_EAST:s.NORTH_WEST}function pt(e){return e===s.NORTH?s.SOUTH:e===s.EAST?s.WEST:e===s.SOUTH?s.NORTH:s.EAST}function mt(e){return e===s.NORTH_WEST||e===s.SOUTH_WEST}function gt(e){return e===s.NORTH_WEST||e===s.NORTH_EAST}function St(e){return e===s.NORTH_WEST||e===s.WEST||e===s.SOUTH_WEST}function Tt(e){return e===s.NORTH_EAST||e===s.EAST||e===s.SOUTH_EAST}function xt(e){return e===s.SOUTH_EAST||e===s.SOUTH||e===s.SOUTH_WEST}function dt(e){return e===s.NORTH_EAST||e===s.NORTH||e===s.NORTH_WEST}const Et=[s.NORTH,s.EAST,s.SOUTH,s.WEST],wt=[s.NORTH_EAST,s.SOUTH_EAST,s.SOUTH_WEST,s.NORTH_WEST],Ue=1e-5;export{dt as $,et as A,ct as B,lt as C,Le as D,b as E,ze as F,_e as G,G as H,Fe as I,pt as J,mt as K,De as L,ot as M,Ve as N,Ke as O,ut as P,gt as Q,tt as R,Qe as S,s as T,Ze as U,D as V,Ie as W,St as X,Tt as Y,xt as Z,k as _,ke as a,He as a0,Je as a1,Xe as a2,st as b,qe as c,ge as d,me as e,x as f,Et as g,wt as h,We as i,Be as j,at as k,Pe as l,he as m,je as n,q as o,it as p,ft as q,Se as r,rt as s,pe as t,P as u,Ae as v,nt as w,Te as x,Ye as y,ht as z};
